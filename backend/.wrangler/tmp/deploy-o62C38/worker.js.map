{
  "version": 3,
  "sources": ["file:///C:/Users/shrey/AppData/Roaming/npm/node_modules/wrangler/node_modules/unenv/dist/runtime/_internal/utils.mjs", "file:///C:/Users/shrey/AppData/Roaming/npm/node_modules/wrangler/node_modules/unenv/dist/runtime/node/internal/perf_hooks/performance.mjs", "file:///C:/Users/shrey/AppData/Roaming/npm/node_modules/wrangler/node_modules/@cloudflare/unenv-preset/dist/runtime/polyfill/performance.mjs", "file:///C:/Users/shrey/AppData/Roaming/npm/node_modules/wrangler/node_modules/unenv/dist/runtime/node/internal/process/hrtime.mjs", "file:///C:/Users/shrey/AppData/Roaming/npm/node_modules/wrangler/node_modules/unenv/dist/runtime/node/internal/process/process.mjs", "file:///C:/Users/shrey/AppData/Roaming/npm/node_modules/wrangler/node_modules/unenv/dist/runtime/node/internal/tty/read-stream.mjs", "file:///C:/Users/shrey/AppData/Roaming/npm/node_modules/wrangler/node_modules/unenv/dist/runtime/node/internal/tty/write-stream.mjs", "file:///C:/Users/shrey/AppData/Roaming/npm/node_modules/wrangler/node_modules/unenv/dist/runtime/node/internal/process/node-version.mjs", "file:///C:/Users/shrey/AppData/Roaming/npm/node_modules/wrangler/node_modules/@cloudflare/unenv-preset/dist/runtime/node/process.mjs", "file:///C:/Users/shrey/AppData/Roaming/npm/node_modules/wrangler/_virtual_unenv_global_polyfill-@cloudflare-unenv-preset-node-process", "../../../worker.ts"],
  "sourceRoot": "H:\\App\\App\\backend\\.wrangler\\tmp\\deploy-o62C38",
  "sourcesContent": ["/* @__NO_SIDE_EFFECTS__ */\nexport function rawHeaders(headers) {\n\tconst rawHeaders = [];\n\tfor (const key in headers) {\n\t\tif (Array.isArray(headers[key])) {\n\t\t\tfor (const h of headers[key]) {\n\t\t\t\trawHeaders.push(key, h);\n\t\t\t}\n\t\t} else {\n\t\t\trawHeaders.push(key, headers[key]);\n\t\t}\n\t}\n\treturn rawHeaders;\n}\n/* @__NO_SIDE_EFFECTS__ */\nexport function mergeFns(...functions) {\n\treturn function(...args) {\n\t\tfor (const fn of functions) {\n\t\t\tfn(...args);\n\t\t}\n\t};\n}\n/* @__NO_SIDE_EFFECTS__ */\nexport function createNotImplementedError(name) {\n\treturn new Error(`[unenv] ${name} is not implemented yet!`);\n}\n/* @__NO_SIDE_EFFECTS__ */\nexport function notImplemented(name) {\n\tconst fn = () => {\n\t\tthrow createNotImplementedError(name);\n\t};\n\treturn Object.assign(fn, { __unenv__: true });\n}\n/* @__NO_SIDE_EFFECTS__ */\nexport function notImplementedAsync(name) {\n\tconst fn = notImplemented(name);\n\tfn.__promisify__ = () => notImplemented(name + \".__promisify__\");\n\tfn.native = fn;\n\treturn fn;\n}\n/* @__NO_SIDE_EFFECTS__ */\nexport function notImplementedClass(name) {\n\treturn class {\n\t\t__unenv__ = true;\n\t\tconstructor() {\n\t\t\tthrow new Error(`[unenv] ${name} is not implemented yet!`);\n\t\t}\n\t};\n}\n", "import { createNotImplementedError } from \"../../../_internal/utils.mjs\";\nconst _timeOrigin = globalThis.performance?.timeOrigin ?? Date.now();\nconst _performanceNow = globalThis.performance?.now ? globalThis.performance.now.bind(globalThis.performance) : () => Date.now() - _timeOrigin;\nconst nodeTiming = {\n\tname: \"node\",\n\tentryType: \"node\",\n\tstartTime: 0,\n\tduration: 0,\n\tnodeStart: 0,\n\tv8Start: 0,\n\tbootstrapComplete: 0,\n\tenvironment: 0,\n\tloopStart: 0,\n\tloopExit: 0,\n\tidleTime: 0,\n\tuvMetricsInfo: {\n\t\tloopCount: 0,\n\t\tevents: 0,\n\t\teventsWaiting: 0\n\t},\n\tdetail: undefined,\n\ttoJSON() {\n\t\treturn this;\n\t}\n};\n// PerformanceEntry\nexport class PerformanceEntry {\n\t__unenv__ = true;\n\tdetail;\n\tentryType = \"event\";\n\tname;\n\tstartTime;\n\tconstructor(name, options) {\n\t\tthis.name = name;\n\t\tthis.startTime = options?.startTime || _performanceNow();\n\t\tthis.detail = options?.detail;\n\t}\n\tget duration() {\n\t\treturn _performanceNow() - this.startTime;\n\t}\n\ttoJSON() {\n\t\treturn {\n\t\t\tname: this.name,\n\t\t\tentryType: this.entryType,\n\t\t\tstartTime: this.startTime,\n\t\t\tduration: this.duration,\n\t\t\tdetail: this.detail\n\t\t};\n\t}\n}\n// PerformanceMark\nexport const PerformanceMark = class PerformanceMark extends PerformanceEntry {\n\tentryType = \"mark\";\n\tconstructor() {\n\t\t// @ts-ignore\n\t\tsuper(...arguments);\n\t}\n\tget duration() {\n\t\treturn 0;\n\t}\n};\n// PerformanceMark\nexport class PerformanceMeasure extends PerformanceEntry {\n\tentryType = \"measure\";\n}\n// PerformanceResourceTiming\nexport class PerformanceResourceTiming extends PerformanceEntry {\n\tentryType = \"resource\";\n\tserverTiming = [];\n\tconnectEnd = 0;\n\tconnectStart = 0;\n\tdecodedBodySize = 0;\n\tdomainLookupEnd = 0;\n\tdomainLookupStart = 0;\n\tencodedBodySize = 0;\n\tfetchStart = 0;\n\tinitiatorType = \"\";\n\tname = \"\";\n\tnextHopProtocol = \"\";\n\tredirectEnd = 0;\n\tredirectStart = 0;\n\trequestStart = 0;\n\tresponseEnd = 0;\n\tresponseStart = 0;\n\tsecureConnectionStart = 0;\n\tstartTime = 0;\n\ttransferSize = 0;\n\tworkerStart = 0;\n\tresponseStatus = 0;\n}\n// PerformanceObserverEntryList\nexport class PerformanceObserverEntryList {\n\t__unenv__ = true;\n\tgetEntries() {\n\t\treturn [];\n\t}\n\tgetEntriesByName(_name, _type) {\n\t\treturn [];\n\t}\n\tgetEntriesByType(type) {\n\t\treturn [];\n\t}\n}\n// Performance\nexport class Performance {\n\t__unenv__ = true;\n\ttimeOrigin = _timeOrigin;\n\teventCounts = new Map();\n\t_entries = [];\n\t_resourceTimingBufferSize = 0;\n\tnavigation = undefined;\n\ttiming = undefined;\n\ttimerify(_fn, _options) {\n\t\tthrow createNotImplementedError(\"Performance.timerify\");\n\t}\n\tget nodeTiming() {\n\t\treturn nodeTiming;\n\t}\n\teventLoopUtilization() {\n\t\treturn {};\n\t}\n\tmarkResourceTiming() {\n\t\t// TODO: create a new PerformanceResourceTiming entry\n\t\t// so that performance.getEntries, getEntriesByName, and getEntriesByType return it\n\t\t// see: https://nodejs.org/api/perf_hooks.html#performancemarkresourcetimingtiminginfo-requestedurl-initiatortype-global-cachemode-bodyinfo-responsestatus-deliverytype\n\t\treturn new PerformanceResourceTiming(\"\");\n\t}\n\tonresourcetimingbufferfull = null;\n\tnow() {\n\t\t// https://developer.mozilla.org/en-US/docs/Web/API/Performance/now\n\t\tif (this.timeOrigin === _timeOrigin) {\n\t\t\treturn _performanceNow();\n\t\t}\n\t\treturn Date.now() - this.timeOrigin;\n\t}\n\tclearMarks(markName) {\n\t\tthis._entries = markName ? this._entries.filter((e) => e.name !== markName) : this._entries.filter((e) => e.entryType !== \"mark\");\n\t}\n\tclearMeasures(measureName) {\n\t\tthis._entries = measureName ? this._entries.filter((e) => e.name !== measureName) : this._entries.filter((e) => e.entryType !== \"measure\");\n\t}\n\tclearResourceTimings() {\n\t\tthis._entries = this._entries.filter((e) => e.entryType !== \"resource\" || e.entryType !== \"navigation\");\n\t}\n\tgetEntries() {\n\t\treturn this._entries;\n\t}\n\tgetEntriesByName(name, type) {\n\t\treturn this._entries.filter((e) => e.name === name && (!type || e.entryType === type));\n\t}\n\tgetEntriesByType(type) {\n\t\treturn this._entries.filter((e) => e.entryType === type);\n\t}\n\tmark(name, options) {\n\t\t// @ts-expect-error constructor is not protected\n\t\tconst entry = new PerformanceMark(name, options);\n\t\tthis._entries.push(entry);\n\t\treturn entry;\n\t}\n\tmeasure(measureName, startOrMeasureOptions, endMark) {\n\t\tlet start;\n\t\tlet end;\n\t\tif (typeof startOrMeasureOptions === \"string\") {\n\t\t\tstart = this.getEntriesByName(startOrMeasureOptions, \"mark\")[0]?.startTime;\n\t\t\tend = this.getEntriesByName(endMark, \"mark\")[0]?.startTime;\n\t\t} else {\n\t\t\tstart = Number.parseFloat(startOrMeasureOptions?.start) || this.now();\n\t\t\tend = Number.parseFloat(startOrMeasureOptions?.end) || this.now();\n\t\t}\n\t\tconst entry = new PerformanceMeasure(measureName, {\n\t\t\tstartTime: start,\n\t\t\tdetail: {\n\t\t\t\tstart,\n\t\t\t\tend\n\t\t\t}\n\t\t});\n\t\tthis._entries.push(entry);\n\t\treturn entry;\n\t}\n\tsetResourceTimingBufferSize(maxSize) {\n\t\tthis._resourceTimingBufferSize = maxSize;\n\t}\n\taddEventListener(type, listener, options) {\n\t\tthrow createNotImplementedError(\"Performance.addEventListener\");\n\t}\n\tremoveEventListener(type, listener, options) {\n\t\tthrow createNotImplementedError(\"Performance.removeEventListener\");\n\t}\n\tdispatchEvent(event) {\n\t\tthrow createNotImplementedError(\"Performance.dispatchEvent\");\n\t}\n\ttoJSON() {\n\t\treturn this;\n\t}\n}\n// PerformanceObserver\nexport class PerformanceObserver {\n\t__unenv__ = true;\n\tstatic supportedEntryTypes = [];\n\t_callback = null;\n\tconstructor(callback) {\n\t\tthis._callback = callback;\n\t}\n\ttakeRecords() {\n\t\treturn [];\n\t}\n\tdisconnect() {\n\t\tthrow createNotImplementedError(\"PerformanceObserver.disconnect\");\n\t}\n\tobserve(options) {\n\t\tthrow createNotImplementedError(\"PerformanceObserver.observe\");\n\t}\n\tbind(fn) {\n\t\treturn fn;\n\t}\n\trunInAsyncScope(fn, thisArg, ...args) {\n\t\treturn fn.call(thisArg, ...args);\n\t}\n\tasyncId() {\n\t\treturn 0;\n\t}\n\ttriggerAsyncId() {\n\t\treturn 0;\n\t}\n\temitDestroy() {\n\t\treturn this;\n\t}\n}\n// workerd implements a subset of globalThis.performance (as of last check, only timeOrigin set to 0 + now() implemented)\n// We already use performance.now() from globalThis.performance, if provided (see top of this file)\n// If we detect this condition, we can just use polyfill instead.\nexport const performance = globalThis.performance && \"addEventListener\" in globalThis.performance ? globalThis.performance : new Performance();\n", "import {\n  performance,\n  Performance,\n  PerformanceEntry,\n  PerformanceMark,\n  PerformanceMeasure,\n  PerformanceObserver,\n  PerformanceObserverEntryList,\n  PerformanceResourceTiming\n} from \"node:perf_hooks\";\nglobalThis.performance = performance;\nglobalThis.Performance = Performance;\nglobalThis.PerformanceEntry = PerformanceEntry;\nglobalThis.PerformanceMark = PerformanceMark;\nglobalThis.PerformanceMeasure = PerformanceMeasure;\nglobalThis.PerformanceObserver = PerformanceObserver;\nglobalThis.PerformanceObserverEntryList = PerformanceObserverEntryList;\nglobalThis.PerformanceResourceTiming = PerformanceResourceTiming;\n", "// https://nodejs.org/api/process.html#processhrtime\nexport const hrtime = /* @__PURE__ */ Object.assign(function hrtime(startTime) {\n\tconst now = Date.now();\n\t// millis to seconds\n\tconst seconds = Math.trunc(now / 1e3);\n\t// convert millis to nanos\n\tconst nanos = now % 1e3 * 1e6;\n\tif (startTime) {\n\t\tlet diffSeconds = seconds - startTime[0];\n\t\tlet diffNanos = nanos - startTime[0];\n\t\tif (diffNanos < 0) {\n\t\t\tdiffSeconds = diffSeconds - 1;\n\t\t\tdiffNanos = 1e9 + diffNanos;\n\t\t}\n\t\treturn [diffSeconds, diffNanos];\n\t}\n\treturn [seconds, nanos];\n}, { bigint: function bigint() {\n\t// Convert milliseconds to nanoseconds\n\treturn BigInt(Date.now() * 1e6);\n} });\n", "import { EventEmitter } from \"node:events\";\nimport { ReadStream, WriteStream } from \"node:tty\";\nimport { notImplemented, createNotImplementedError } from \"../../../_internal/utils.mjs\";\n// node-version.ts is generated at build time\nimport { NODE_VERSION } from \"./node-version.mjs\";\nexport class Process extends EventEmitter {\n\tenv;\n\thrtime;\n\tnextTick;\n\tconstructor(impl) {\n\t\tsuper();\n\t\tthis.env = impl.env;\n\t\tthis.hrtime = impl.hrtime;\n\t\tthis.nextTick = impl.nextTick;\n\t\tfor (const prop of [...Object.getOwnPropertyNames(Process.prototype), ...Object.getOwnPropertyNames(EventEmitter.prototype)]) {\n\t\t\tconst value = this[prop];\n\t\t\tif (typeof value === \"function\") {\n\t\t\t\tthis[prop] = value.bind(this);\n\t\t\t}\n\t\t}\n\t}\n\t// --- event emitter ---\n\temitWarning(warning, type, code) {\n\t\tconsole.warn(`${code ? `[${code}] ` : \"\"}${type ? `${type}: ` : \"\"}${warning}`);\n\t}\n\temit(...args) {\n\t\t// @ts-ignore\n\t\treturn super.emit(...args);\n\t}\n\tlisteners(eventName) {\n\t\treturn super.listeners(eventName);\n\t}\n\t// --- stdio (lazy initializers) ---\n\t#stdin;\n\t#stdout;\n\t#stderr;\n\tget stdin() {\n\t\treturn this.#stdin ??= new ReadStream(0);\n\t}\n\tget stdout() {\n\t\treturn this.#stdout ??= new WriteStream(1);\n\t}\n\tget stderr() {\n\t\treturn this.#stderr ??= new WriteStream(2);\n\t}\n\t// --- cwd ---\n\t#cwd = \"/\";\n\tchdir(cwd) {\n\t\tthis.#cwd = cwd;\n\t}\n\tcwd() {\n\t\treturn this.#cwd;\n\t}\n\t// --- dummy props and getters ---\n\tarch = \"\";\n\tplatform = \"\";\n\targv = [];\n\targv0 = \"\";\n\texecArgv = [];\n\texecPath = \"\";\n\ttitle = \"\";\n\tpid = 200;\n\tppid = 100;\n\tget version() {\n\t\treturn `v${NODE_VERSION}`;\n\t}\n\tget versions() {\n\t\treturn { node: NODE_VERSION };\n\t}\n\tget allowedNodeEnvironmentFlags() {\n\t\treturn new Set();\n\t}\n\tget sourceMapsEnabled() {\n\t\treturn false;\n\t}\n\tget debugPort() {\n\t\treturn 0;\n\t}\n\tget throwDeprecation() {\n\t\treturn false;\n\t}\n\tget traceDeprecation() {\n\t\treturn false;\n\t}\n\tget features() {\n\t\treturn {};\n\t}\n\tget release() {\n\t\treturn {};\n\t}\n\tget connected() {\n\t\treturn false;\n\t}\n\tget config() {\n\t\treturn {};\n\t}\n\tget moduleLoadList() {\n\t\treturn [];\n\t}\n\tconstrainedMemory() {\n\t\treturn 0;\n\t}\n\tavailableMemory() {\n\t\treturn 0;\n\t}\n\tuptime() {\n\t\treturn 0;\n\t}\n\tresourceUsage() {\n\t\treturn {};\n\t}\n\t// --- noop methods ---\n\tref() {\n\t\t// noop\n\t}\n\tunref() {\n\t\t// noop\n\t}\n\t// --- unimplemented methods ---\n\tumask() {\n\t\tthrow createNotImplementedError(\"process.umask\");\n\t}\n\tgetBuiltinModule() {\n\t\treturn undefined;\n\t}\n\tgetActiveResourcesInfo() {\n\t\tthrow createNotImplementedError(\"process.getActiveResourcesInfo\");\n\t}\n\texit() {\n\t\tthrow createNotImplementedError(\"process.exit\");\n\t}\n\treallyExit() {\n\t\tthrow createNotImplementedError(\"process.reallyExit\");\n\t}\n\tkill() {\n\t\tthrow createNotImplementedError(\"process.kill\");\n\t}\n\tabort() {\n\t\tthrow createNotImplementedError(\"process.abort\");\n\t}\n\tdlopen() {\n\t\tthrow createNotImplementedError(\"process.dlopen\");\n\t}\n\tsetSourceMapsEnabled() {\n\t\tthrow createNotImplementedError(\"process.setSourceMapsEnabled\");\n\t}\n\tloadEnvFile() {\n\t\tthrow createNotImplementedError(\"process.loadEnvFile\");\n\t}\n\tdisconnect() {\n\t\tthrow createNotImplementedError(\"process.disconnect\");\n\t}\n\tcpuUsage() {\n\t\tthrow createNotImplementedError(\"process.cpuUsage\");\n\t}\n\tsetUncaughtExceptionCaptureCallback() {\n\t\tthrow createNotImplementedError(\"process.setUncaughtExceptionCaptureCallback\");\n\t}\n\thasUncaughtExceptionCaptureCallback() {\n\t\tthrow createNotImplementedError(\"process.hasUncaughtExceptionCaptureCallback\");\n\t}\n\tinitgroups() {\n\t\tthrow createNotImplementedError(\"process.initgroups\");\n\t}\n\topenStdin() {\n\t\tthrow createNotImplementedError(\"process.openStdin\");\n\t}\n\tassert() {\n\t\tthrow createNotImplementedError(\"process.assert\");\n\t}\n\tbinding() {\n\t\tthrow createNotImplementedError(\"process.binding\");\n\t}\n\t// --- attached interfaces ---\n\tpermission = { has: /* @__PURE__ */ notImplemented(\"process.permission.has\") };\n\treport = {\n\t\tdirectory: \"\",\n\t\tfilename: \"\",\n\t\tsignal: \"SIGUSR2\",\n\t\tcompact: false,\n\t\treportOnFatalError: false,\n\t\treportOnSignal: false,\n\t\treportOnUncaughtException: false,\n\t\tgetReport: /* @__PURE__ */ notImplemented(\"process.report.getReport\"),\n\t\twriteReport: /* @__PURE__ */ notImplemented(\"process.report.writeReport\")\n\t};\n\tfinalization = {\n\t\tregister: /* @__PURE__ */ notImplemented(\"process.finalization.register\"),\n\t\tunregister: /* @__PURE__ */ notImplemented(\"process.finalization.unregister\"),\n\t\tregisterBeforeExit: /* @__PURE__ */ notImplemented(\"process.finalization.registerBeforeExit\")\n\t};\n\tmemoryUsage = Object.assign(() => ({\n\t\tarrayBuffers: 0,\n\t\trss: 0,\n\t\texternal: 0,\n\t\theapTotal: 0,\n\t\theapUsed: 0\n\t}), { rss: () => 0 });\n\t// --- undefined props ---\n\tmainModule = undefined;\n\tdomain = undefined;\n\t// optional\n\tsend = undefined;\n\texitCode = undefined;\n\tchannel = undefined;\n\tgetegid = undefined;\n\tgeteuid = undefined;\n\tgetgid = undefined;\n\tgetgroups = undefined;\n\tgetuid = undefined;\n\tsetegid = undefined;\n\tseteuid = undefined;\n\tsetgid = undefined;\n\tsetgroups = undefined;\n\tsetuid = undefined;\n\t// internals\n\t_events = undefined;\n\t_eventsCount = undefined;\n\t_exiting = undefined;\n\t_maxListeners = undefined;\n\t_debugEnd = undefined;\n\t_debugProcess = undefined;\n\t_fatalException = undefined;\n\t_getActiveHandles = undefined;\n\t_getActiveRequests = undefined;\n\t_kill = undefined;\n\t_preload_modules = undefined;\n\t_rawDebug = undefined;\n\t_startProfilerIdleNotifier = undefined;\n\t_stopProfilerIdleNotifier = undefined;\n\t_tickCallback = undefined;\n\t_disconnect = undefined;\n\t_handleQueue = undefined;\n\t_pendingMessage = undefined;\n\t_channel = undefined;\n\t_send = undefined;\n\t_linkedBinding = undefined;\n}\n", "export class ReadStream {\n\tfd;\n\tisRaw = false;\n\tisTTY = false;\n\tconstructor(fd) {\n\t\tthis.fd = fd;\n\t}\n\tsetRawMode(mode) {\n\t\tthis.isRaw = mode;\n\t\treturn this;\n\t}\n}\n", "export class WriteStream {\n\tfd;\n\tcolumns = 80;\n\trows = 24;\n\tisTTY = false;\n\tconstructor(fd) {\n\t\tthis.fd = fd;\n\t}\n\tclearLine(dir, callback) {\n\t\tcallback && callback();\n\t\treturn false;\n\t}\n\tclearScreenDown(callback) {\n\t\tcallback && callback();\n\t\treturn false;\n\t}\n\tcursorTo(x, y, callback) {\n\t\tcallback && typeof callback === \"function\" && callback();\n\t\treturn false;\n\t}\n\tmoveCursor(dx, dy, callback) {\n\t\tcallback && callback();\n\t\treturn false;\n\t}\n\tgetColorDepth(env) {\n\t\treturn 1;\n\t}\n\thasColors(count, env) {\n\t\treturn false;\n\t}\n\tgetWindowSize() {\n\t\treturn [this.columns, this.rows];\n\t}\n\twrite(str, encoding, cb) {\n\t\tif (str instanceof Uint8Array) {\n\t\t\tstr = new TextDecoder().decode(str);\n\t\t}\n\t\ttry {\n\t\t\tconsole.log(str);\n\t\t} catch {}\n\t\tcb && typeof cb === \"function\" && cb();\n\t\treturn false;\n\t}\n}\n", "// Extracted from .nvmrc\nexport const NODE_VERSION = \"22.14.0\";\n", "import { hrtime as UnenvHrTime } from \"unenv/node/internal/process/hrtime\";\nimport { Process as UnenvProcess } from \"unenv/node/internal/process/process\";\nconst globalProcess = globalThis[\"process\"];\nexport const getBuiltinModule = globalProcess.getBuiltinModule;\nconst workerdProcess = getBuiltinModule(\"node:process\");\nconst isWorkerdProcessV2 = globalThis.Cloudflare.compatibilityFlags.enable_nodejs_process_v2;\nconst unenvProcess = new UnenvProcess({\n  env: globalProcess.env,\n  // `hrtime` is only available from workerd process v2\n  hrtime: isWorkerdProcessV2 ? workerdProcess.hrtime : UnenvHrTime,\n  // `nextTick` is available from workerd process v1\n  nextTick: workerdProcess.nextTick\n});\nexport const { exit, features, platform } = workerdProcess;\nexport const {\n  // Always implemented by workerd\n  env,\n  // Only implemented in workerd v2\n  hrtime,\n  // Always implemented by workerd\n  nextTick\n} = unenvProcess;\nexport const {\n  _channel,\n  _disconnect,\n  _events,\n  _eventsCount,\n  _handleQueue,\n  _maxListeners,\n  _pendingMessage,\n  _send,\n  assert,\n  disconnect,\n  mainModule\n} = unenvProcess;\nexport const {\n  // @ts-expect-error `_debugEnd` is missing typings\n  _debugEnd,\n  // @ts-expect-error `_debugProcess` is missing typings\n  _debugProcess,\n  // @ts-expect-error `_exiting` is missing typings\n  _exiting,\n  // @ts-expect-error `_fatalException` is missing typings\n  _fatalException,\n  // @ts-expect-error `_getActiveHandles` is missing typings\n  _getActiveHandles,\n  // @ts-expect-error `_getActiveRequests` is missing typings\n  _getActiveRequests,\n  // @ts-expect-error `_kill` is missing typings\n  _kill,\n  // @ts-expect-error `_linkedBinding` is missing typings\n  _linkedBinding,\n  // @ts-expect-error `_preload_modules` is missing typings\n  _preload_modules,\n  // @ts-expect-error `_rawDebug` is missing typings\n  _rawDebug,\n  // @ts-expect-error `_startProfilerIdleNotifier` is missing typings\n  _startProfilerIdleNotifier,\n  // @ts-expect-error `_stopProfilerIdleNotifier` is missing typings\n  _stopProfilerIdleNotifier,\n  // @ts-expect-error `_tickCallback` is missing typings\n  _tickCallback,\n  abort,\n  addListener,\n  allowedNodeEnvironmentFlags,\n  arch,\n  argv,\n  argv0,\n  availableMemory,\n  // @ts-expect-error `binding` is missing typings\n  binding,\n  channel,\n  chdir,\n  config,\n  connected,\n  constrainedMemory,\n  cpuUsage,\n  cwd,\n  debugPort,\n  dlopen,\n  // @ts-expect-error `domain` is missing typings\n  domain,\n  emit,\n  emitWarning,\n  eventNames,\n  execArgv,\n  execPath,\n  exitCode,\n  finalization,\n  getActiveResourcesInfo,\n  getegid,\n  geteuid,\n  getgid,\n  getgroups,\n  getMaxListeners,\n  getuid,\n  hasUncaughtExceptionCaptureCallback,\n  // @ts-expect-error `initgroups` is missing typings\n  initgroups,\n  kill,\n  listenerCount,\n  listeners,\n  loadEnvFile,\n  memoryUsage,\n  // @ts-expect-error `moduleLoadList` is missing typings\n  moduleLoadList,\n  off,\n  on,\n  once,\n  // @ts-expect-error `openStdin` is missing typings\n  openStdin,\n  permission,\n  pid,\n  ppid,\n  prependListener,\n  prependOnceListener,\n  rawListeners,\n  // @ts-expect-error `reallyExit` is missing typings\n  reallyExit,\n  ref,\n  release,\n  removeAllListeners,\n  removeListener,\n  report,\n  resourceUsage,\n  send,\n  setegid,\n  seteuid,\n  setgid,\n  setgroups,\n  setMaxListeners,\n  setSourceMapsEnabled,\n  setuid,\n  setUncaughtExceptionCaptureCallback,\n  sourceMapsEnabled,\n  stderr,\n  stdin,\n  stdout,\n  throwDeprecation,\n  title,\n  traceDeprecation,\n  umask,\n  unref,\n  uptime,\n  version,\n  versions\n} = isWorkerdProcessV2 ? workerdProcess : unenvProcess;\nconst _process = {\n  abort,\n  addListener,\n  allowedNodeEnvironmentFlags,\n  hasUncaughtExceptionCaptureCallback,\n  setUncaughtExceptionCaptureCallback,\n  loadEnvFile,\n  sourceMapsEnabled,\n  arch,\n  argv,\n  argv0,\n  chdir,\n  config,\n  connected,\n  constrainedMemory,\n  availableMemory,\n  cpuUsage,\n  cwd,\n  debugPort,\n  dlopen,\n  disconnect,\n  emit,\n  emitWarning,\n  env,\n  eventNames,\n  execArgv,\n  execPath,\n  exit,\n  finalization,\n  features,\n  getBuiltinModule,\n  getActiveResourcesInfo,\n  getMaxListeners,\n  hrtime,\n  kill,\n  listeners,\n  listenerCount,\n  memoryUsage,\n  nextTick,\n  on,\n  off,\n  once,\n  pid,\n  platform,\n  ppid,\n  prependListener,\n  prependOnceListener,\n  rawListeners,\n  release,\n  removeAllListeners,\n  removeListener,\n  report,\n  resourceUsage,\n  setMaxListeners,\n  setSourceMapsEnabled,\n  stderr,\n  stdin,\n  stdout,\n  title,\n  throwDeprecation,\n  traceDeprecation,\n  umask,\n  uptime,\n  version,\n  versions,\n  // @ts-expect-error old API\n  domain,\n  initgroups,\n  moduleLoadList,\n  reallyExit,\n  openStdin,\n  assert,\n  binding,\n  send,\n  exitCode,\n  channel,\n  getegid,\n  geteuid,\n  getgid,\n  getgroups,\n  getuid,\n  setegid,\n  seteuid,\n  setgid,\n  setgroups,\n  setuid,\n  permission,\n  mainModule,\n  _events,\n  _eventsCount,\n  _exiting,\n  _maxListeners,\n  _debugEnd,\n  _debugProcess,\n  _fatalException,\n  _getActiveHandles,\n  _getActiveRequests,\n  _kill,\n  _preload_modules,\n  _rawDebug,\n  _startProfilerIdleNotifier,\n  _stopProfilerIdleNotifier,\n  _tickCallback,\n  _disconnect,\n  _handleQueue,\n  _pendingMessage,\n  _channel,\n  _send,\n  _linkedBinding\n};\nexport default _process;\n", "import { default as defaultExport } from \"@cloudflare/unenv-preset/node/process\";\nglobalThis.process = defaultExport;", "/**\r\n * =====================================================\r\n * ProVeloce Cloudflare Worker Backend\r\n * =====================================================\r\n * \r\n * IMPORTANT: CLOUDFLARE ACCESS / ZERO TRUST CONFIGURATION\r\n * --------------------------------------------------------\r\n * If you see a Cloudflare Access login page when hitting backend.proveloce.com,\r\n * you need to DISABLE or BYPASS Cloudflare Access for this Worker route.\r\n * \r\n * To fix:\r\n * 1. Go to Cloudflare Dashboard \u2192 Zero Trust \u2192 Access \u2192 Applications\r\n * 2. Find any application protecting \"backend.proveloce.com\" or \"*proveloce.com*\"\r\n * 3. Either DELETE the application, or add a BYPASS policy for the /api/* paths\r\n * =====================================================\r\n */\r\n\r\n// =====================================================\r\n// CORS Configuration\r\n// =====================================================\r\n\r\nconst ALLOWED_ORIGIN = \"https://app.proveloce.com\";\r\n\r\nconst corsHeaders: Record<string, string> = {\r\n    \"Access-Control-Allow-Origin\": ALLOWED_ORIGIN,\r\n    \"Access-Control-Allow-Methods\": \"GET, POST, PUT, PATCH, DELETE, OPTIONS\",\r\n    \"Access-Control-Allow-Headers\": \"Content-Type, Authorization\",\r\n    \"Access-Control-Allow-Credentials\": \"true\",\r\n};\r\n\r\nfunction handleOptions(request: Request): Response {\r\n    const origin = request.headers.get(\"Origin\");\r\n    if (origin === ALLOWED_ORIGIN) {\r\n        return new Response(null, { status: 204, headers: corsHeaders });\r\n    }\r\n    return new Response(null, { status: 204 });\r\n}\r\n\r\nfunction jsonResponse(data: any, status: number = 200): Response {\r\n    return new Response(JSON.stringify(data), {\r\n        status,\r\n        headers: { \"Content-Type\": \"application/json\", ...corsHeaders },\r\n    });\r\n}\r\n\r\nasync function createNotification(env: any, userId: string, type: string, title: string, message: string, link?: string): Promise<void> {\r\n    if (!env.proveloce_db) return;\r\n    try {\r\n        await env.proveloce_db.prepare(`\r\n            INSERT INTO notifications (id, user_id, type, title, message, link, created_at)\r\n            VALUES (?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP)\r\n        `).bind(crypto.randomUUID(), userId, type, title, message, link || null).run();\r\n    } catch (error) {\r\n        console.error(\"Failed to create notification:\", error);\r\n    }\r\n}\r\n\r\n// =====================================================\r\n// JWT Helper Functions (Simple implementation for Workers)\r\n// =====================================================\r\n\r\nasync function createJWT(payload: any, secret: string, expiresInSeconds: number = 604800): Promise<string> {\r\n    const header = { alg: \"HS256\", typ: \"JWT\" };\r\n    const now = Math.floor(Date.now() / 1000);\r\n    const exp = now + expiresInSeconds;\r\n\r\n    const fullPayload = { ...payload, iat: now, exp };\r\n\r\n    const encoder = new TextEncoder();\r\n    const headerB64 = btoa(JSON.stringify(header)).replace(/=/g, '').replace(/\\+/g, '-').replace(/\\//g, '_');\r\n    const payloadB64 = btoa(JSON.stringify(fullPayload)).replace(/=/g, '').replace(/\\+/g, '-').replace(/\\//g, '_');\r\n\r\n    const key = await crypto.subtle.importKey(\r\n        \"raw\",\r\n        encoder.encode(secret),\r\n        { name: \"HMAC\", hash: \"SHA-256\" },\r\n        false,\r\n        [\"sign\"]\r\n    );\r\n\r\n    const signature = await crypto.subtle.sign(\r\n        \"HMAC\",\r\n        key,\r\n        encoder.encode(`${headerB64}.${payloadB64}`)\r\n    );\r\n\r\n    const signatureB64 = btoa(String.fromCharCode(...new Uint8Array(signature)))\r\n        .replace(/=/g, '').replace(/\\+/g, '-').replace(/\\//g, '_');\r\n\r\n    return `${headerB64}.${payloadB64}.${signatureB64}`;\r\n}\r\n\r\nasync function verifyJWT(token: string, secret: string): Promise<any> {\r\n    try {\r\n        const [headerB64, payloadB64, signatureB64] = token.split('.');\r\n\r\n        const encoder = new TextEncoder();\r\n        const key = await crypto.subtle.importKey(\r\n            \"raw\",\r\n            encoder.encode(secret),\r\n            { name: \"HMAC\", hash: \"SHA-256\" },\r\n            false,\r\n            [\"verify\"]\r\n        );\r\n\r\n        // Decode signature\r\n        const signatureStr = atob(signatureB64.replace(/-/g, '+').replace(/_/g, '/'));\r\n        const signature = new Uint8Array([...signatureStr].map(c => c.charCodeAt(0)));\r\n\r\n        const valid = await crypto.subtle.verify(\r\n            \"HMAC\",\r\n            key,\r\n            signature,\r\n            encoder.encode(`${headerB64}.${payloadB64}`)\r\n        );\r\n\r\n        if (!valid) return null;\r\n\r\n        const payload = JSON.parse(atob(payloadB64.replace(/-/g, '+').replace(/_/g, '/')));\r\n\r\n        // Check expiration\r\n        if (payload.exp && payload.exp < Math.floor(Date.now() / 1000)) {\r\n            return null;\r\n        }\r\n\r\n        return payload;\r\n    } catch {\r\n        return null;\r\n    }\r\n}\r\n\r\n// =====================================================\r\n// POML v1.0 Refresh Token Management\r\n// =====================================================\r\n\r\nasync function storeRefreshToken(env: any, userId: string, token: string, expiresAt: Date): Promise<void> {\r\n    if (!env.proveloce_db) return;\r\n    try {\r\n        await env.proveloce_db.prepare(`\r\n            INSERT INTO refresh_tokens (id, user_id, token, expires_at, created_at)\r\n            VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP)\r\n        `).bind(crypto.randomUUID(), userId, token, expiresAt.toISOString()).run();\r\n\r\n        // Audit log: refresh_token_stored\r\n        await env.proveloce_db.prepare(`\r\n            INSERT INTO activity_logs (id, user_id, action, details, created_at)\r\n            VALUES (?, ?, 'refresh_token_stored', ?, CURRENT_TIMESTAMP)\r\n        `).bind(crypto.randomUUID(), userId, JSON.stringify({ expires_at: expiresAt.toISOString() })).run();\r\n    } catch (error) {\r\n        console.error(\"Failed to store refresh token:\", error);\r\n    }\r\n}\r\n\r\nasync function validateRefreshToken(env: any, token: string): Promise<{ valid: boolean; userId?: string; error?: string }> {\r\n    if (!env.proveloce_db) return { valid: false, error: \"Database not configured\" };\r\n    try {\r\n        const result = await env.proveloce_db.prepare(`\r\n            SELECT user_id, expires_at, revoked_at\r\n            FROM refresh_tokens\r\n            WHERE token = ?\r\n        `).bind(token).first() as any;\r\n\r\n        if (!result) return { valid: false, error: \"Token not found\" };\r\n        if (result.revoked_at) return { valid: false, error: \"Token has been revoked\" };\r\n        if (new Date(result.expires_at) < new Date()) return { valid: false, error: \"Token has expired\" };\r\n\r\n        // Audit log: refresh_token_fetched\r\n        await env.proveloce_db.prepare(`\r\n            INSERT INTO activity_logs (id, user_id, action, details, created_at)\r\n            VALUES (?, ?, 'refresh_token_fetched', ?, CURRENT_TIMESTAMP)\r\n        `).bind(crypto.randomUUID(), result.user_id, JSON.stringify({ expires_at: result.expires_at })).run();\r\n\r\n        return { valid: true, userId: result.user_id };\r\n    } catch (error) {\r\n        console.error(\"Failed to validate refresh token:\", error);\r\n        return { valid: false, error: \"Validation failed\" };\r\n    }\r\n}\r\n\r\nasync function revokeRefreshToken(env: any, token: string, userId?: string): Promise<boolean> {\r\n    if (!env.proveloce_db) return false;\r\n    try {\r\n        await env.proveloce_db.prepare(`\r\n            UPDATE refresh_tokens\r\n            SET revoked_at = CURRENT_TIMESTAMP\r\n            WHERE token = ?\r\n        `).bind(token).run();\r\n\r\n        // Audit log: refresh_token_revoked\r\n        if (userId) {\r\n            await env.proveloce_db.prepare(`\r\n                INSERT INTO activity_logs (id, user_id, action, details, created_at)\r\n                VALUES (?, ?, 'refresh_token_revoked', ?, CURRENT_TIMESTAMP)\r\n            `).bind(crypto.randomUUID(), userId, JSON.stringify({ revoked_at: new Date().toISOString() })).run();\r\n        }\r\n\r\n        return true;\r\n    } catch (error) {\r\n        console.error(\"Failed to revoke refresh token:\", error);\r\n        return false;\r\n    }\r\n}\r\n\r\nasync function revokeAllUserTokens(env: any, userId: string): Promise<boolean> {\r\n    if (!env.proveloce_db) return false;\r\n    try {\r\n        await env.proveloce_db.prepare(`\r\n            UPDATE refresh_tokens\r\n            SET revoked_at = CURRENT_TIMESTAMP\r\n            WHERE user_id = ? AND revoked_at IS NULL\r\n        `).bind(userId).run();\r\n        return true;\r\n    } catch (error) {\r\n        console.error(\"Failed to revoke all user tokens:\", error);\r\n        return false;\r\n    }\r\n}\r\n\r\n// =====================================================\r\n// Google OAuth Helper Functions\r\n// =====================================================\r\n\r\ninterface GoogleTokenResponse {\r\n    access_token: string;\r\n    id_token?: string;\r\n    expires_in: number;\r\n    token_type: string;\r\n    refresh_token?: string;\r\n}\r\n\r\ninterface GoogleUserInfo {\r\n    id: string;\r\n    email: string;\r\n    verified_email: boolean;\r\n    name: string;\r\n    given_name?: string;\r\n    family_name?: string;\r\n    picture?: string;\r\n}\r\n\r\nasync function exchangeCodeForTokens(\r\n    code: string,\r\n    clientId: string,\r\n    clientSecret: string,\r\n    redirectUri: string\r\n): Promise<GoogleTokenResponse> {\r\n    const response = await fetch(\"https://oauth2.googleapis.com/token\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/x-www-form-urlencoded\" },\r\n        body: new URLSearchParams({\r\n            code,\r\n            client_id: clientId,\r\n            client_secret: clientSecret,\r\n            redirect_uri: redirectUri,\r\n            grant_type: \"authorization_code\",\r\n        }),\r\n    });\r\n\r\n    if (!response.ok) {\r\n        const error = await response.text();\r\n        throw new Error(`Token exchange failed: ${error}`);\r\n    }\r\n\r\n    return response.json();\r\n}\r\n\r\nasync function getGoogleUserInfo(accessToken: string): Promise<GoogleUserInfo> {\r\n    const response = await fetch(\"https://www.googleapis.com/oauth2/v2/userinfo\", {\r\n        headers: { Authorization: `Bearer ${accessToken}` },\r\n    });\r\n\r\n    if (!response.ok) {\r\n        throw new Error(\"Failed to get user info from Google\");\r\n    }\r\n\r\n    return response.json();\r\n}\r\n\r\n// =====================================================\r\n// Main Worker Export\r\n// =====================================================\r\n\r\nexport default {\r\n    async fetch(request: Request, env: any): Promise<Response> {\r\n        const url = new URL(request.url);\r\n\r\n        // Handle CORS Preflight\r\n        if (request.method === \"OPTIONS\") {\r\n            return handleOptions(request);\r\n        }\r\n\r\n        try {\r\n            // =====================================================\r\n            // Base Routes\r\n            // =====================================================\r\n\r\n            if (url.pathname === \"/api\") {\r\n                return jsonResponse({ success: true, message: \"ProVeloce API Active \uD83D\uDE80\" });\r\n            }\r\n\r\n            if (url.pathname === \"/health\") {\r\n                return jsonResponse({ status: \"ok\", timestamp: new Date().toISOString() });\r\n            }\r\n\r\n            // =====================================================\r\n            // Email/Password Login\r\n            // =====================================================\r\n\r\n            if (url.pathname === \"/api/auth/login\" && request.method === \"POST\") {\r\n                try {\r\n                    const body = await request.json() as { email?: string; password?: string };\r\n\r\n                    if (!body.email || !body.password) {\r\n                        return jsonResponse({ success: false, error: \"Email and password are required\" }, 400);\r\n                    }\r\n\r\n                    // Check if user exists in D1\r\n                    if (!env.proveloce_db) {\r\n                        return jsonResponse({ success: false, error: \"Database not configured\" }, 500);\r\n                    }\r\n\r\n                    const user = await env.proveloce_db.prepare(\r\n                        \"SELECT id, name, email, role, org_id, suspended, password_hash, status FROM users WHERE email = ?\"\r\n                    ).bind(body.email).first() as any;\r\n\r\n                    if (!user) {\r\n                        return jsonResponse({ success: false, error: \"Invalid email or password\" }, 401);\r\n                    }\r\n\r\n                    // TODO: Verify password hash (implement proper password verification)\r\n                    // For now, just generate JWT for existing user\r\n\r\n                    // login trigger: set status to 'Active' if NULL or 'pending_verification'\r\n                    const currentStatus = user.status;\r\n                    if (!currentStatus || currentStatus === 'pending_verification') {\r\n                        await env.proveloce_db.prepare(\r\n                            \"UPDATE users SET status = 'active', updated_at = CURRENT_TIMESTAMP WHERE id = ?\"\r\n                        ).bind(user.id).run();\r\n\r\n                        // Log the activation\r\n                        await env.proveloce_db.prepare(\r\n                            \"INSERT INTO activity_logs (id, user_id, action, entity_type, entity_id, metadata) VALUES (?, ?, ?, ?, ?, ?)\"\r\n                        ).bind(crypto.randomUUID(), user.id, \"USER_ACTIVATION\", \"user\", user.id, JSON.stringify({ reason: \"Login Trigger\", oldStatus: currentStatus, newStatus: \"active\" })).run();\r\n                    }\r\n\r\n                    const token = await createJWT(\r\n                        { userId: user.id, email: user.email, name: user.name, role: user.role, org_id: user.org_id || 'ORG-DEFAULT' },\r\n                        env.JWT_ACCESS_SECRET || \"default-secret\"\r\n                    );\r\n\r\n                    return jsonResponse({\r\n                        success: true,\r\n                        message: \"Login successful\",\r\n                        token,\r\n                        user: { id: user.id, name: user.name, email: user.email, role: user.role, status: 'active' }\r\n                    });\r\n                } catch (e: any) {\r\n                    return jsonResponse({ success: false, error: e.message || \"Login failed\" }, 400);\r\n                }\r\n            }\r\n\r\n            // =====================================================\r\n            // Email/Password Signup (POML v1.0)\r\n            // =====================================================\r\n\r\n            if (url.pathname === \"/api/auth/signup\" && request.method === \"POST\") {\r\n                try {\r\n                    const body = await request.json() as {\r\n                        email?: string;\r\n                        password?: string;\r\n                        name?: string;\r\n                        profile_photo_url?: string;\r\n                        bio?: string;\r\n                        dob?: string;\r\n                        phone?: string;\r\n                    };\r\n\r\n                    if (!body.email || !body.password || !body.name) {\r\n                        return jsonResponse({ success: false, error: \"Email, password, and name are required\" }, 400);\r\n                    }\r\n\r\n                    if (!env.proveloce_db) {\r\n                        return jsonResponse({ success: false, error: \"Database not configured\" }, 500);\r\n                    }\r\n\r\n                    // Check if user already exists\r\n                    const existingUser = await env.proveloce_db.prepare(\r\n                        \"SELECT id FROM users WHERE email = ?\"\r\n                    ).bind(body.email).first();\r\n\r\n                    if (existingUser) {\r\n                        return jsonResponse({ success: false, error: \"User already exists with this email\" }, 409);\r\n                    }\r\n\r\n                    // Hash password\r\n                    const encoder = new TextEncoder();\r\n                    const data = encoder.encode(body.password);\r\n                    const hashBuffer = await crypto.subtle.digest(\"SHA-256\", data);\r\n                    const hashArray = Array.from(new Uint8Array(hashBuffer));\r\n                    const passwordHash = hashArray.map(b => b.toString(16).padStart(2, \"0\")).join(\"\");\r\n\r\n                    const userId = crypto.randomUUID();\r\n                    const role = \"customer\"; // Default role as per POML\r\n                    const status = \"active\";\r\n\r\n                    await env.proveloce_db.prepare(\r\n                        \"INSERT INTO users (id, name, email, password_hash, role, status, profile_photo_url, bio, dob, phone, email_verified) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, 1)\"\r\n                    ).bind(\r\n                        userId,\r\n                        body.name,\r\n                        body.email,\r\n                        passwordHash,\r\n                        role,\r\n                        status,\r\n                        body.profile_photo_url || null,\r\n                        body.bio || null,\r\n                        body.dob || null,\r\n                        body.phone || null\r\n                    ).run();\r\n\r\n                    // Log activity\r\n                    await env.proveloce_db.prepare(\r\n                        \"INSERT INTO activity_logs (id, user_id, action, entity_type, entity_id, metadata) VALUES (?, ?, ?, ?, ?, ?)\"\r\n                    ).bind(crypto.randomUUID(), userId, \"USER_REGISTRATION\", \"user\", userId, JSON.stringify({ method: \"email\", role, status })).run();\r\n\r\n                    const token = await createJWT(\r\n                        { userId: userId, email: body.email, name: body.name, role: role, org_id: 'ORG-DEFAULT' },\r\n                        env.JWT_ACCESS_SECRET || \"default-secret\"\r\n                    );\r\n\r\n                    return jsonResponse({\r\n                        success: true,\r\n                        message: \"Signup successful\",\r\n                        token,\r\n                        user: { id: userId, name: body.name, email: body.email, role: role, status: status }\r\n                    }, 201);\r\n\r\n                } catch (e: any) {\r\n                    console.error(\"Signup error:\", e);\r\n                    return jsonResponse({ success: false, error: e.message || \"Signup failed\" }, 400);\r\n                }\r\n            }\r\n\r\n            // =====================================================\r\n            // GET /api/auth/me - Current User with Application Status\r\n            // =====================================================\r\n\r\n            if (url.pathname === \"/api/auth/me\" && request.method === \"GET\") {\r\n                const authHeader = request.headers.get(\"Authorization\");\r\n                if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const token = authHeader.substring(7);\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\");\r\n\r\n                if (!payload) {\r\n                    return jsonResponse({ success: false, error: \"Invalid or expired token\" }, 401);\r\n                }\r\n\r\n                if (!env.proveloce_db) {\r\n                    return jsonResponse({ success: false, error: \"Database not configured\" }, 500);\r\n                }\r\n\r\n                try {\r\n                    // Fetch user from database\r\n                    const user = await env.proveloce_db.prepare(\r\n                        \"SELECT id, name, email, phone, role, status, email_verified, created_at FROM users WHERE id = ?\"\r\n                    ).bind(payload.userId).first() as any;\r\n\r\n                    if (!user) {\r\n                        return jsonResponse({ success: false, error: \"User not found\" }, 404);\r\n                    }\r\n\r\n                    // Fetch expert application status\r\n                    const application = await env.proveloce_db.prepare(\r\n                        \"SELECT id, status, submitted_at, rejection_reason FROM expert_applications WHERE user_id = ?\"\r\n                    ).bind(payload.userId).first() as any;\r\n\r\n                    // Determine application status (NONE if no application exists)\r\n                    const applicationStatus = application\r\n                        ? (application.status || 'DRAFT').toUpperCase()\r\n                        : 'NONE';\r\n\r\n                    return jsonResponse({\r\n                        success: true,\r\n                        data: {\r\n                            user: {\r\n                                id: user.id,\r\n                                name: user.name,\r\n                                email: user.email,\r\n                                phone: user.phone,\r\n                                role: (user.role || 'customer').toUpperCase(),\r\n                                status: user.status || 'ACTIVE',\r\n                                emailVerified: !!user.email_verified,\r\n                                createdAt: user.created_at,\r\n                            },\r\n                            // Application state for UI control\r\n                            expertApplication: {\r\n                                status: applicationStatus,\r\n                                applicationId: application?.id || null,\r\n                                submittedAt: application?.submitted_at || null,\r\n                                rejectionReason: application?.rejection_reason || null,\r\n                            }\r\n                        }\r\n                    });\r\n                } catch (error: any) {\r\n                    console.error(\"Error fetching user:\", error);\r\n                    return jsonResponse({ success: false, error: \"Failed to fetch user\" }, 500);\r\n                }\r\n            }\r\n\r\n            // =====================================================\r\n            // POST /api/auth/refresh - POML v1.0 Refresh Token\r\n            // =====================================================\r\n\r\n            if (url.pathname === \"/api/auth/refresh\" && request.method === \"POST\") {\r\n                try {\r\n                    const body = await request.json() as { refreshToken?: string };\r\n\r\n                    if (!body.refreshToken) {\r\n                        return jsonResponse({ success: false, error: \"Refresh token is required\" }, 400);\r\n                    }\r\n\r\n                    if (!env.proveloce_db) {\r\n                        return jsonResponse({ success: false, error: \"Database not configured\" }, 500);\r\n                    }\r\n\r\n                    // Validate the refresh token\r\n                    const validation = await validateRefreshToken(env, body.refreshToken);\r\n\r\n                    if (!validation.valid) {\r\n                        return jsonResponse({ success: false, error: validation.error || \"Invalid refresh token\" }, 401);\r\n                    }\r\n\r\n                    // Get user info for new access token\r\n                    const user = await env.proveloce_db.prepare(\r\n                        \"SELECT id, name, email, role, org_id FROM users WHERE id = ?\"\r\n                    ).bind(validation.userId).first() as any;\r\n\r\n                    if (!user) {\r\n                        return jsonResponse({ success: false, error: \"User not found\" }, 404);\r\n                    }\r\n\r\n                    // Revoke old refresh token (rotation)\r\n                    await revokeRefreshToken(env, body.refreshToken, validation.userId);\r\n\r\n                    // Create new access token\r\n                    const newAccessToken = await createJWT(\r\n                        { userId: user.id, email: user.email, name: user.name, role: user.role, org_id: user.org_id || 'ORG-DEFAULT' },\r\n                        env.JWT_ACCESS_SECRET || \"default-secret\"\r\n                    );\r\n\r\n                    // Create new refresh token (24h rotation per POML spec)\r\n                    const newRefreshToken = crypto.randomUUID();\r\n                    const expiresAt = new Date(Date.now() + 24 * 60 * 60 * 1000); // 24 hours\r\n                    await storeRefreshToken(env, user.id, newRefreshToken, expiresAt);\r\n\r\n                    return jsonResponse({\r\n                        success: true,\r\n                        accessToken: newAccessToken,\r\n                        refreshToken: newRefreshToken,\r\n                        expiresIn: 604800 // 7 days for access token\r\n                    });\r\n                } catch (e: any) {\r\n                    console.error(\"Refresh token error:\", e);\r\n                    return jsonResponse({ success: false, error: \"Token refresh failed\" }, 500);\r\n                }\r\n            }\r\n\r\n            // =====================================================\r\n            // POST /api/auth/logout - POML v1.0 Token Revocation\r\n            // =====================================================\r\n\r\n            if (url.pathname === \"/api/auth/logout\" && request.method === \"POST\") {\r\n                try {\r\n                    const authHeader = request.headers.get(\"Authorization\");\r\n                    let userId: string | undefined;\r\n\r\n                    // Try to get userId from access token if provided\r\n                    if (authHeader && authHeader.startsWith(\"Bearer \")) {\r\n                        const token = authHeader.substring(7);\r\n                        const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\");\r\n                        if (payload) {\r\n                            userId = payload.userId;\r\n                        }\r\n                    }\r\n\r\n                    const body = await request.json() as { refreshToken?: string; revokeAll?: boolean };\r\n\r\n                    if (!env.proveloce_db) {\r\n                        return jsonResponse({ success: false, error: \"Database not configured\" }, 500);\r\n                    }\r\n\r\n                    if (body.revokeAll && userId) {\r\n                        // Revoke ALL user tokens\r\n                        await revokeAllUserTokens(env, userId);\r\n                        return jsonResponse({ success: true, message: \"All tokens revoked\" });\r\n                    }\r\n\r\n                    if (body.refreshToken) {\r\n                        // Revoke specific refresh token\r\n                        await revokeRefreshToken(env, body.refreshToken, userId);\r\n                        return jsonResponse({ success: true, message: \"Token revoked\" });\r\n                    }\r\n\r\n                    return jsonResponse({ success: true, message: \"Logout successful\" });\r\n                } catch (e: any) {\r\n                    console.error(\"Logout error:\", e);\r\n                    return jsonResponse({ success: false, error: \"Logout failed\" }, 500);\r\n                }\r\n            }\r\n\r\n            // =====================================================\r\n            // Google OAuth - Step 1: Redirect to Google\r\n            // =====================================================\r\n\r\n            if (url.pathname === \"/api/auth/google\") {\r\n                const redirectUri = env.GOOGLE_CALLBACK_URL || \"https://backend.proveloce.com/api/auth/google/callback\";\r\n                const clientId = env.GOOGLE_CLIENT_ID;\r\n                const scope = \"openid email profile\";\r\n\r\n                if (!clientId) {\r\n                    return jsonResponse({ success: false, error: \"GOOGLE_CLIENT_ID not configured\" }, 500);\r\n                }\r\n\r\n                const googleURL = new URL(\"https://accounts.google.com/o/oauth2/v2/auth\");\r\n                googleURL.searchParams.set(\"client_id\", clientId);\r\n                googleURL.searchParams.set(\"redirect_uri\", redirectUri);\r\n                googleURL.searchParams.set(\"response_type\", \"code\");\r\n                googleURL.searchParams.set(\"scope\", scope);\r\n                googleURL.searchParams.set(\"access_type\", \"offline\");\r\n                googleURL.searchParams.set(\"prompt\", \"consent\");\r\n\r\n                return Response.redirect(googleURL.toString(), 302);\r\n            }\r\n\r\n            // =====================================================\r\n            // Google OAuth - Step 2: Handle Callback\r\n            // =====================================================\r\n\r\n            if (url.pathname === \"/api/auth/google/callback\") {\r\n                const code = url.searchParams.get(\"code\");\r\n                const error = url.searchParams.get(\"error\");\r\n                const frontendUrl = env.FRONTEND_URL || \"https://app.proveloce.com\";\r\n\r\n                // Handle errors from Google\r\n                if (error) {\r\n                    return Response.redirect(\r\n                        `${frontendUrl}/auth/error?error=${encodeURIComponent(error)}`,\r\n                        302\r\n                    );\r\n                }\r\n\r\n                if (!code) {\r\n                    return Response.redirect(\r\n                        `${frontendUrl}/auth/error?error=no_code_provided`,\r\n                        302\r\n                    );\r\n                }\r\n\r\n                try {\r\n                    // Exchange code for tokens\r\n                    const tokens = await exchangeCodeForTokens(\r\n                        code,\r\n                        env.GOOGLE_CLIENT_ID,\r\n                        env.GOOGLE_CLIENT_SECRET,\r\n                        env.GOOGLE_CALLBACK_URL || \"https://backend.proveloce.com/api/auth/google/callback\"\r\n                    );\r\n\r\n                    // Get user info from Google\r\n                    const googleUser = await getGoogleUserInfo(tokens.access_token);\r\n\r\n                    // Check if D1 database is available\r\n                    if (!env.proveloce_db) {\r\n                        console.error(\"D1 Database not bound\");\r\n                        return Response.redirect(\r\n                            `${frontendUrl}/auth/error?error=database_not_configured`,\r\n                            302\r\n                        );\r\n                    }\r\n\r\n                    // Check if user exists\r\n                    let user = await env.proveloce_db.prepare(\r\n                        \"SELECT id, name, email, role, org_id, suspended FROM users WHERE email = ?\"\r\n                    ).bind(googleUser.email).first();\r\n\r\n                    // Create user if doesn't exist\r\n                    if (!user) {\r\n                        const userId = crypto.randomUUID();\r\n                        await env.proveloce_db.prepare(\r\n                            \"INSERT INTO users (id, name, email, role, status, email_verified, avatar_data) VALUES (?, ?, ?, ?, ?, ?, ?)\"\r\n                        ).bind(\r\n                            userId,\r\n                            googleUser.name,\r\n                            googleUser.email,\r\n                            \"customer\",\r\n                            \"active\",\r\n                            1,\r\n                            googleUser.picture || null\r\n                        ).run();\r\n\r\n                        // Log activity\r\n                        await env.proveloce_db.prepare(\r\n                            \"INSERT INTO activity_logs (id, user_id, action, entity_type, entity_id, metadata) VALUES (?, ?, ?, ?, ?, ?)\"\r\n                        ).bind(crypto.randomUUID(), userId, \"USER_REGISTRATION\", \"user\", userId, JSON.stringify({ method: \"google\", role: \"customer\", status: \"active\" })).run();\r\n\r\n                        user = {\r\n                            id: userId,\r\n                            name: googleUser.name,\r\n                            email: googleUser.email,\r\n                            role: \"customer\",\r\n                            status: \"active\"\r\n                        };\r\n                    } else {\r\n                        // existing user login trigger\r\n                        if (!user.status || user.status === 'pending_verification') {\r\n                            await env.proveloce_db.prepare(\r\n                                \"UPDATE users SET status = 'active', updated_at = CURRENT_TIMESTAMP WHERE id = ?\"\r\n                            ).bind(user.id).run();\r\n\r\n                            await env.proveloce_db.prepare(\r\n                                \"INSERT INTO activity_logs (id, user_id, action, entity_type, entity_id, metadata) VALUES (?, ?, ?, ?, ?, ?)\"\r\n                            ).bind(crypto.randomUUID(), user.id, \"USER_ACTIVATION\", \"user\", user.id, JSON.stringify({ method: \"google\", oldStatus: user.status, newStatus: \"active\" })).run();\r\n\r\n                            user.status = \"active\";\r\n                        }\r\n                    }\r\n\r\n                    // Generate JWT token\r\n                    const jwtToken = await createJWT(\r\n                        {\r\n                            userId: user.id,\r\n                            email: user.email,\r\n                            name: user.name,\r\n                            role: user.role,\r\n                            org_id: user.org_id || 'ORG-DEFAULT'\r\n                        },\r\n                        env.JWT_ACCESS_SECRET || \"default-secret\",\r\n                        604800 // 7 days\r\n                    );\r\n\r\n                    // Redirect to frontend with token\r\n                    const redirectUrl = new URL(`${frontendUrl}/auth/success`);\r\n                    redirectUrl.searchParams.set(\"token\", jwtToken);\r\n                    redirectUrl.searchParams.set(\"email\", user.email);\r\n                    redirectUrl.searchParams.set(\"name\", user.name);\r\n                    redirectUrl.searchParams.set(\"role\", user.role);\r\n\r\n                    return Response.redirect(redirectUrl.toString(), 302);\r\n\r\n                } catch (err: any) {\r\n                    console.error(\"OAuth callback error:\", err);\r\n                    return Response.redirect(\r\n                        `${frontendUrl}/auth/error?error=${encodeURIComponent(err.message || \"oauth_failed\")}`,\r\n                        302\r\n                    );\r\n                }\r\n            }\r\n\r\n            // =====================================================\r\n            // Verify Token Endpoint\r\n            // =====================================================\r\n\r\n            if (url.pathname === \"/api/auth/verify\" && request.method === \"GET\") {\r\n                const authHeader = request.headers.get(\"Authorization\");\r\n                if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\r\n                    return jsonResponse({ success: false, error: \"No token provided\" }, 401);\r\n                }\r\n\r\n                const token = authHeader.substring(7);\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\");\r\n\r\n                if (!payload) {\r\n                    return jsonResponse({ success: false, error: \"Invalid or expired token\" }, 401);\r\n                }\r\n\r\n                return jsonResponse({ success: true, user: payload });\r\n            }\r\n\r\n            // =====================================================\r\n            // Get Current User (Protected)\r\n            // =====================================================\r\n\r\n            if (url.pathname === \"/api/auth/me\" && request.method === \"GET\") {\r\n                const authHeader = request.headers.get(\"Authorization\");\r\n                if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const token = authHeader.substring(7);\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\");\r\n\r\n                if (!payload) {\r\n                    return jsonResponse({ success: false, error: \"Invalid or expired token\" }, 401);\r\n                }\r\n\r\n                // Get fresh user data from DB\r\n                if (env.proveloce_db) {\r\n                    const user = await env.proveloce_db.prepare(\r\n                        \"SELECT id, name, email, phone, role, created_at FROM users WHERE id = ?\"\r\n                    ).bind(payload.userId).first();\r\n\r\n                    if (user) {\r\n                        return jsonResponse({ success: true, user });\r\n                    }\r\n                }\r\n\r\n                return jsonResponse({ success: true, user: payload });\r\n            }\r\n\r\n            // =====================================================\r\n            // Profile Routes\r\n            // =====================================================\r\n\r\n            // Get current user profile\r\n            if (url.pathname === \"/api/profiles/me\" && request.method === \"GET\") {\r\n                const authHeader = request.headers.get(\"Authorization\");\r\n                if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const token = authHeader.substring(7);\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\");\r\n\r\n                if (!payload) {\r\n                    return jsonResponse({ success: false, error: \"Invalid or expired token\" }, 401);\r\n                }\r\n\r\n                if (!env.proveloce_db) {\r\n                    return jsonResponse({ success: false, error: \"Database not configured\" }, 500);\r\n                }\r\n\r\n                const user = await env.proveloce_db.prepare(\r\n                    \"SELECT id, name, email, phone, role, profile_photo_url, profile_image, created_at FROM users WHERE id = ?\"\r\n                ).bind(payload.userId).first() as any;\r\n\r\n                const profile = await env.proveloce_db.prepare(\r\n                    \"SELECT * FROM user_profiles WHERE user_id = ?\"\r\n                ).bind(payload.userId).first() as any;\r\n\r\n                // Return user data with phone and avatarUrl explicitly at top level\r\n                return jsonResponse({\r\n                    success: true,\r\n                    data: {\r\n                        user: {\r\n                            id: user?.id,\r\n                            name: user?.name,\r\n                            email: user?.email,\r\n                            phone: user?.phone || null,\r\n                            role: user?.role,\r\n                            created_at: user?.created_at,\r\n                            profile: {\r\n                                ...profile,\r\n                                avatarUrl: user?.profile_image || user?.profile_photo_url || null\r\n                            }\r\n                        },\r\n                        profileCompletion: profile ? 80 : 20\r\n                    }\r\n                });\r\n            }\r\n\r\n            // Update current user profile (PATCH)\r\n            if (url.pathname === \"/api/profiles/me\" && request.method === \"PATCH\") {\r\n                const authHeader = request.headers.get(\"Authorization\");\r\n                if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const token = authHeader.substring(7);\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\");\r\n\r\n                if (!payload) {\r\n                    return jsonResponse({ success: false, error: \"Invalid or expired token\" }, 401);\r\n                }\r\n\r\n                if (!env.proveloce_db) {\r\n                    return jsonResponse({ success: false, error: \"Database not configured\" }, 500);\r\n                }\r\n\r\n                const body = await request.json() as any;\r\n                const { name, phone, dob, gender, addressLine1, addressLine2, city, state, country, pincode, bio } = body;\r\n\r\n                // Update user name and phone if provided (these are in users table)\r\n                if (name || phone) {\r\n                    const updates = [];\r\n                    const values = [];\r\n\r\n                    if (name) {\r\n                        updates.push(\"name = ?\");\r\n                        values.push(name);\r\n                    }\r\n                    if (phone) {\r\n                        updates.push(\"phone = ?\");\r\n                        values.push(phone);\r\n                    }\r\n\r\n                    if (updates.length > 0) {\r\n                        updates.push(\"updated_at = CURRENT_TIMESTAMP\");\r\n                        values.push(payload.userId);\r\n                        await env.proveloce_db.prepare(\r\n                            `UPDATE users SET ${updates.join(\", \")} WHERE id = ?`\r\n                        ).bind(...values).run();\r\n                    }\r\n                }\r\n\r\n                // Upsert user profile (profile-specific fields)\r\n                const existingProfile = await env.proveloce_db.prepare(\r\n                    \"SELECT id FROM user_profiles WHERE user_id = ?\"\r\n                ).bind(payload.userId).first();\r\n\r\n                if (existingProfile) {\r\n                    await env.proveloce_db.prepare(`\r\n                        UPDATE user_profiles SET \r\n                            dob = COALESCE(?, dob),\r\n                            gender = COALESCE(?, gender),\r\n                            address_line1 = COALESCE(?, address_line1),\r\n                            address_line2 = COALESCE(?, address_line2),\r\n                            city = COALESCE(?, city),\r\n                            state = COALESCE(?, state),\r\n                            country = COALESCE(?, country),\r\n                            pincode = COALESCE(?, pincode),\r\n                            bio = COALESCE(?, bio),\r\n                            updated_at = CURRENT_TIMESTAMP\r\n                        WHERE user_id = ?\r\n                    `).bind(dob, gender, addressLine1, addressLine2, city, state, country, pincode, bio, payload.userId).run();\r\n                } else {\r\n                    const profileId = crypto.randomUUID();\r\n                    await env.proveloce_db.prepare(`\r\n                        INSERT INTO user_profiles (id, user_id, dob, gender, address_line1, address_line2, city, state, country, pincode, bio)\r\n                        VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\r\n                    `).bind(profileId, payload.userId, dob, gender, addressLine1, addressLine2, city, state, country, pincode, bio).run();\r\n                }\r\n\r\n                // Get updated user and profile\r\n                const user = await env.proveloce_db.prepare(\r\n                    \"SELECT id, name, email, phone, role, created_at FROM users WHERE id = ?\"\r\n                ).bind(payload.userId).first() as any;\r\n\r\n                const profile = await env.proveloce_db.prepare(\r\n                    \"SELECT * FROM user_profiles WHERE user_id = ?\"\r\n                ).bind(payload.userId).first();\r\n\r\n                return jsonResponse({\r\n                    success: true,\r\n                    message: \"Profile updated successfully\",\r\n                    data: {\r\n                        user: {\r\n                            id: user?.id,\r\n                            name: user?.name,\r\n                            email: user?.email,\r\n                            phone: user?.phone || null,\r\n                            role: user?.role,\r\n                            profile\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n\r\n            // POST /api/profiles/me/avatar - Upload profile avatar to R2\r\n            if (url.pathname === \"/api/profiles/me/avatar\" && request.method === \"POST\") {\r\n                const authHeader = request.headers.get(\"Authorization\");\r\n                if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const token = authHeader.substring(7);\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\");\r\n\r\n                if (!payload) {\r\n                    return jsonResponse({ success: false, error: \"Invalid or expired token\" }, 401);\r\n                }\r\n\r\n                if (!env.proveloce_db || !env.others) {\r\n                    return jsonResponse({ success: false, error: \"Storage not configured\" }, 500);\r\n                }\r\n\r\n                try {\r\n                    // Parse multipart form data\r\n                    const contentType = request.headers.get(\"Content-Type\") || \"\";\r\n                    if (!contentType.includes(\"multipart/form-data\")) {\r\n                        return jsonResponse({ success: false, error: \"Content-Type must be multipart/form-data\" }, 400);\r\n                    }\r\n\r\n                    const formData = await request.formData();\r\n                    const file = formData.get(\"avatar\") as File | null;\r\n\r\n                    if (!file) {\r\n                        return jsonResponse({ success: false, error: \"No avatar file provided\" }, 400);\r\n                    }\r\n\r\n                    // Validate file size (max 5MB)\r\n                    if (file.size > 5 * 1024 * 1024) {\r\n                        return jsonResponse({ success: false, error: \"File size must be less than 5MB\" }, 400);\r\n                    }\r\n\r\n                    // Validate file type\r\n                    const allowedTypes = [\"image/jpeg\", \"image/png\", \"image/gif\", \"image/webp\"];\r\n                    if (!allowedTypes.includes(file.type)) {\r\n                        return jsonResponse({ success: false, error: \"Only JPEG, PNG, GIF, and WebP images are allowed\" }, 400);\r\n                    }\r\n\r\n                    // Generate unique filename\r\n                    const ext = file.name.split(\".\").pop() || \"jpg\";\r\n                    const timestamp = Date.now();\r\n                    const r2Key = `profile-photos/${payload.userId}-${timestamp}.${ext}`;\r\n\r\n                    // Upload to R2 'others' bucket\r\n                    const fileBuffer = await file.arrayBuffer();\r\n                    await env.others.put(r2Key, fileBuffer, {\r\n                        httpMetadata: {\r\n                            contentType: file.type,\r\n                        },\r\n                    });\r\n\r\n                    // Construct public URL\r\n                    const avatarUrl = `https://pub-others.r2.dev/${r2Key}`;\r\n\r\n                    // Update user's profile_image and profile_photo_url in database\r\n                    // Append timestamp for cache busting if needed, but unique filename per upload is better\r\n                    await env.proveloce_db.prepare(\r\n                        \"UPDATE users SET profile_image = ?, profile_photo_url = ?, updated_at = CURRENT_TIMESTAMP WHERE id = ?\"\r\n                    ).bind(avatarUrl, avatarUrl, payload.userId).run();\r\n\r\n                    // Also update user_profiles.avatar_url if the table has that column\r\n                    try {\r\n                        await env.proveloce_db.prepare(\r\n                            \"UPDATE user_profiles SET avatar_url = ?, updated_at = CURRENT_TIMESTAMP WHERE user_id = ?\"\r\n                        ).bind(avatarUrl, payload.userId).run();\r\n                    } catch (e) {\r\n                        // Ignore if avatar_url column doesn't exist in user_profiles\r\n                    }\r\n\r\n                    console.log(`\u2705 Avatar uploaded for user ${payload.userId}: ${r2Key}`);\r\n\r\n                    return jsonResponse({\r\n                        success: true,\r\n                        message: \"Avatar uploaded successfully\",\r\n                        data: { avatarUrl }\r\n                    });\r\n                } catch (error: any) {\r\n                    console.error(\"Avatar upload error:\", error);\r\n                    return jsonResponse({ success: false, error: \"Failed to upload avatar\" }, 500);\r\n                }\r\n            }\r\n\r\n            // =====================================================\r\n            // Change Password Route\r\n            // =====================================================\r\n\r\n            if (url.pathname === \"/api/auth/change-password\" && request.method === \"POST\") {\r\n                const authHeader = request.headers.get(\"Authorization\");\r\n                if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const token = authHeader.substring(7);\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\");\r\n\r\n                if (!payload) {\r\n                    return jsonResponse({ success: false, error: \"Invalid or expired token\" }, 401);\r\n                }\r\n\r\n                if (!env.proveloce_db) {\r\n                    return jsonResponse({ success: false, error: \"Database not configured\" }, 500);\r\n                }\r\n\r\n                const body = await request.json() as any;\r\n                const { currentPassword, newPassword, confirmPassword } = body;\r\n\r\n                if (!currentPassword || !newPassword || !confirmPassword) {\r\n                    return jsonResponse({ success: false, error: \"All password fields are required\" }, 400);\r\n                }\r\n\r\n                if (newPassword !== confirmPassword) {\r\n                    return jsonResponse({ success: false, error: \"New password and confirmation do not match\" }, 400);\r\n                }\r\n\r\n                // Strong password validation\r\n                const passwordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[@$!%*?&])[A-Za-z\\d@$!%*?&]{8,}$/;\r\n                if (!passwordRegex.test(newPassword)) {\r\n                    return jsonResponse({\r\n                        success: false,\r\n                        error: \"Password must be at least 8 characters with 1 uppercase, 1 lowercase, 1 number, and 1 special character (@$!%*?&)\"\r\n                    }, 400);\r\n                }\r\n\r\n                // Get current user\r\n                const user = await env.proveloce_db.prepare(\r\n                    \"SELECT id, password_hash FROM users WHERE id = ?\"\r\n                ).bind(payload.userId).first() as any;\r\n\r\n                if (!user) {\r\n                    return jsonResponse({ success: false, error: \"User not found\" }, 404);\r\n                }\r\n\r\n                // If user has existing password, verify current password\r\n                if (user.password_hash) {\r\n                    // Simple hash comparison (in production, use bcrypt)\r\n                    const encoder = new TextEncoder();\r\n                    const data = encoder.encode(currentPassword);\r\n                    const hashBuffer = await crypto.subtle.digest(\"SHA-256\", data);\r\n                    const hashArray = Array.from(new Uint8Array(hashBuffer));\r\n                    const currentHash = hashArray.map(b => b.toString(16).padStart(2, \"0\")).join(\"\");\r\n\r\n                    if (currentHash !== user.password_hash) {\r\n                        return jsonResponse({ success: false, error: \"Current password is incorrect\" }, 400);\r\n                    }\r\n                }\r\n\r\n                // Hash new password\r\n                const encoder = new TextEncoder();\r\n                const data = encoder.encode(newPassword);\r\n                const hashBuffer = await crypto.subtle.digest(\"SHA-256\", data);\r\n                const hashArray = Array.from(new Uint8Array(hashBuffer));\r\n                const newHash = hashArray.map(b => b.toString(16).padStart(2, \"0\")).join(\"\");\r\n\r\n                // Update password\r\n                await env.proveloce_db.prepare(\r\n                    \"UPDATE users SET password_hash = ?, updated_at = CURRENT_TIMESTAMP WHERE id = ?\"\r\n                ).bind(newHash, payload.userId).run();\r\n\r\n                // Log activity\r\n                await env.proveloce_db.prepare(\r\n                    \"INSERT INTO activity_logs (id, user_id, action, entity_type, entity_id, metadata) VALUES (?, ?, ?, ?, ?, ?)\"\r\n                ).bind(crypto.randomUUID(), payload.userId, \"CHANGE_PASSWORD\", \"user\", payload.userId, JSON.stringify({ timestamp: new Date().toISOString() })).run();\r\n\r\n                return jsonResponse({ success: true, message: \"Password changed successfully\" });\r\n            }\r\n\r\n            // =====================================================\r\n            // Login History Route\r\n            // =====================================================\r\n\r\n            if (url.pathname === \"/api/auth/login-history\" && request.method === \"GET\") {\r\n                const authHeader = request.headers.get(\"Authorization\");\r\n                if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const token = authHeader.substring(7);\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\");\r\n\r\n                if (!payload) {\r\n                    return jsonResponse({ success: false, error: \"Invalid or expired token\" }, 401);\r\n                }\r\n\r\n                if (!env.proveloce_db) {\r\n                    return jsonResponse({ success: false, error: \"Database not configured\" }, 500);\r\n                }\r\n\r\n                // Get login history from activity_logs\r\n                const history = await env.proveloce_db.prepare(\r\n                    `SELECT id, action, ip_address, user_agent, metadata, created_at \r\n                     FROM activity_logs \r\n                     WHERE user_id = ? AND action IN ('LOGIN', 'LOGIN_OAUTH', 'LOGIN_FAILED')\r\n                     ORDER BY created_at DESC \r\n                     LIMIT 20`\r\n                ).bind(payload.userId).all();\r\n\r\n                const loginHistory = history.results.map((entry: any) => ({\r\n                    id: entry.id,\r\n                    createdAt: entry.created_at,\r\n                    ipAddress: entry.ip_address || 'Unknown',\r\n                    device: entry.user_agent ? (entry.user_agent.substring(0, 50) + '...') : 'Unknown device',\r\n                    success: entry.action !== 'LOGIN_FAILED'\r\n                }));\r\n\r\n                return jsonResponse({ success: true, data: { loginHistory } });\r\n            }\r\n\r\n            // =====================================================\r\n            // D1 Database Routes\r\n            // =====================================================\r\n\r\n            if (url.pathname === \"/api/db/test\") {\r\n                if (!env.proveloce_db) {\r\n                    return jsonResponse({ success: false, error: \"D1 Database not bound\" }, 500);\r\n                }\r\n                const result = await env.proveloce_db.prepare(\"SELECT 1 as test\").all();\r\n                return jsonResponse({ success: true, message: \"D1 Database Connected \u2714\", result: result.results });\r\n            }\r\n\r\n            if (url.pathname === \"/api/db/users\" && request.method === \"GET\") {\r\n                if (!env.proveloce_db) {\r\n                    return jsonResponse({ success: false, error: \"D1 Database not bound\" }, 500);\r\n                }\r\n                const result = await env.proveloce_db.prepare(\r\n                    \"SELECT id, name, email, role, created_at FROM users LIMIT 50\"\r\n                ).all();\r\n                return jsonResponse({ success: true, users: result.results });\r\n            }\r\n\r\n            if (url.pathname === \"/api/db/users\" && request.method === \"POST\") {\r\n                if (!env.proveloce_db) {\r\n                    return jsonResponse({ success: false, error: \"D1 Database not bound\" }, 500);\r\n                }\r\n                const body = await request.json() as any;\r\n                const id = crypto.randomUUID();\r\n                await env.proveloce_db.prepare(\r\n                    \"INSERT INTO users (id, name, email, role) VALUES (?, ?, ?, ?)\"\r\n                ).bind(id, body.name, body.email, body.role || \"customer\").run();\r\n                return jsonResponse({ success: true, message: \"User created\", id }, 201);\r\n            }\r\n\r\n            if (url.pathname.startsWith(\"/api/db/users/\") && request.method === \"GET\") {\r\n                if (!env.proveloce_db) {\r\n                    return jsonResponse({ success: false, error: \"D1 Database not bound\" }, 500);\r\n                }\r\n                const id = url.pathname.split(\"/\").pop();\r\n                const result = await env.proveloce_db.prepare(\r\n                    \"SELECT id, name, email, role, created_at FROM users WHERE id = ?\"\r\n                ).bind(id).first();\r\n                if (!result) {\r\n                    return jsonResponse({ success: false, error: \"User not found\" }, 404);\r\n                }\r\n                return jsonResponse({ success: true, user: result });\r\n            }\r\n\r\n            // =====================================================\r\n            // Admin Routes (Protected - ADMIN/SUPERADMIN only)\r\n            // =====================================================\r\n\r\n            // Helper: Check if user has admin role\r\n            const checkAdminRole = async (req: Request): Promise<{ valid: boolean; payload?: any; error?: string }> => {\r\n                const authHeader = req.headers.get(\"Authorization\");\r\n                if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\r\n                    return { valid: false, error: \"Unauthorized\" };\r\n                }\r\n                const token = authHeader.substring(7);\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\");\r\n                if (!payload) {\r\n                    return { valid: false, error: \"Invalid or expired token\" };\r\n                }\r\n                const role = (payload.role || \"\").toLowerCase();\r\n                if (role !== \"admin\" && role !== \"superadmin\") {\r\n                    return { valid: false, error: \"Insufficient permissions\" };\r\n                }\r\n                return { valid: true, payload };\r\n            };\r\n\r\n            // GET /api/admin/users - List all users with filtering\r\n            if (url.pathname === \"/api/admin/users\" && request.method === \"GET\") {\r\n                const auth = await checkAdminRole(request);\r\n                if (!auth.valid) {\r\n                    return jsonResponse({ success: false, error: auth.error }, 401);\r\n                }\r\n\r\n                if (!env.proveloce_db) {\r\n                    return jsonResponse({ success: false, error: \"Database not configured\" }, 500);\r\n                }\r\n\r\n                const filterRole = url.searchParams.get(\"role\");\r\n                const status = url.searchParams.get(\"status\");\r\n                const search = url.searchParams.get(\"search\");\r\n                const page = parseInt(url.searchParams.get(\"page\") || \"1\");\r\n                const limit = parseInt(url.searchParams.get(\"limit\") || \"20\");\r\n                const offset = (page - 1) * limit;\r\n\r\n                let query = \"SELECT id, name, email, phone, role, status, profile_image, profile_photo_url, email_verified, last_login_at, created_at FROM users WHERE 1=1\";\r\n                const params: any[] = [];\r\n\r\n                // Role-based visibility restrictions\r\n                const requesterRole = (auth.payload.role || \"\").toLowerCase();\r\n                if (requesterRole === \"superadmin\") {\r\n                    // SuperAdmin cannot see other SuperAdmins (including themselves)\r\n                    query += \" AND role != 'superadmin'\";\r\n                } else if (requesterRole === \"admin\") {\r\n                    // Admin can only see Customer, Expert, Analyst, Agent, Viewer\r\n                    query += \" AND role IN ('customer', 'expert', 'analyst', 'agent', 'viewer')\";\r\n                }\r\n\r\n                if (filterRole) {\r\n                    query += \" AND role = ?\";\r\n                    params.push(filterRole);\r\n                }\r\n                if (status) {\r\n                    query += \" AND status = ?\";\r\n                    params.push(status);\r\n                }\r\n                if (search) {\r\n                    query += \" AND (name LIKE ? OR email LIKE ?)\";\r\n                    params.push(`%${search}%`, `%${search}%`);\r\n                }\r\n\r\n                // Get total count\r\n                const countQuery = query.replace(\"SELECT id, name, email, phone, role, status, profile_image, profile_photo_url, email_verified, last_login_at, created_at\", \"SELECT COUNT(*) as total\");\r\n                const countResult = await env.proveloce_db.prepare(countQuery).bind(...params).first() as any;\r\n                const total = countResult?.total || 0;\r\n\r\n                // Get paginated results\r\n                query += \" ORDER BY created_at DESC LIMIT ? OFFSET ?\";\r\n                params.push(limit, offset);\r\n\r\n                const result = await env.proveloce_db.prepare(query).bind(...params).all();\r\n\r\n                return jsonResponse({\r\n                    success: true,\r\n                    data: {\r\n                        users: result.results,\r\n                        pagination: {\r\n                            page,\r\n                            limit,\r\n                            total,\r\n                            totalPages: Math.ceil(total / limit)\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n\r\n            // GET /api/users - General user listing (Enterprise v2.2)\r\n            if (url.pathname === \"/api/users\" && request.method === \"GET\") {\r\n                const authHeader = request.headers.get(\"Authorization\") || \"\";\r\n                const token = authHeader.replace(\"Bearer \", \"\");\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\") as { userId: string; role?: string; org_id?: string } | null;\r\n\r\n                if (!payload) return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n\r\n                const role = (payload.role || \"\").toUpperCase();\r\n                const requesterOrgId = payload.org_id || 'ORG-DEFAULT';\r\n\r\n                let query = \"SELECT id, name, email, phone, role, status, org_id FROM users WHERE status = 'active'\";\r\n                const params: any[] = [];\r\n\r\n                // Filter by roles if provided\r\n                const rolesParam = url.searchParams.get('roles');\r\n                if (rolesParam) {\r\n                    const requestedRoles = rolesParam.split(',').map(r => r.trim().toUpperCase()).filter(r => r !== \"\");\r\n                    if (requestedRoles.length > 0) {\r\n                        const placeholders = requestedRoles.map(() => '?').join(',');\r\n                        query += ` AND UPPER(role) IN (${placeholders})`;\r\n                        params.push(...requestedRoles);\r\n                    }\r\n                }\r\n\r\n                if (role === 'SUPERADMIN') {\r\n                    // SuperAdmin can see everyone active\r\n                } else if (role === 'ADMIN') {\r\n                    // Admins see people in their org\r\n                    query += \" AND org_id = ?\";\r\n                    params.push(requesterOrgId);\r\n                } else {\r\n                    return jsonResponse({ success: false, error: \"Access denied\" }, 403);\r\n                }\r\n\r\n                const result = await env.proveloce_db.prepare(query).bind(...params).all();\r\n\r\n                return jsonResponse({\r\n                    success: true,\r\n                    data: {\r\n                        data: result.results\r\n                    }\r\n                });\r\n            }\r\n\r\n            // GET /api/admin/users/:id - Get single user\r\n            if (url.pathname.match(/^\\/api\\/admin\\/users\\/[^\\/]+$/) && request.method === \"GET\") {\r\n                const auth = await checkAdminRole(request);\r\n                if (!auth.valid) {\r\n                    return jsonResponse({ success: false, error: auth.error }, 401);\r\n                }\r\n\r\n                if (!env.proveloce_db) {\r\n                    return jsonResponse({ success: false, error: \"Database not configured\" }, 500);\r\n                }\r\n\r\n                const id = url.pathname.split(\"/\").pop();\r\n                const user = await env.proveloce_db.prepare(\r\n                    \"SELECT id, name, email, phone, role, status, email_verified, last_login_at, created_at FROM users WHERE id = ?\"\r\n                ).bind(id).first();\r\n\r\n                if (!user) {\r\n                    return jsonResponse({ success: false, error: \"User not found\" }, 404);\r\n                }\r\n\r\n                const profile = await env.proveloce_db.prepare(\r\n                    \"SELECT * FROM user_profiles WHERE user_id = ?\"\r\n                ).bind(id).first();\r\n\r\n                return jsonResponse({ success: true, data: { user: { ...user, profile } } });\r\n            }\r\n\r\n            // POST /api/admin/users - Create new user\r\n            if (url.pathname === \"/api/admin/users\" && request.method === \"POST\") {\r\n                const auth = await checkAdminRole(request);\r\n                if (!auth.valid) {\r\n                    return jsonResponse({ success: false, error: auth.error }, 401);\r\n                }\r\n\r\n                if (!env.proveloce_db) {\r\n                    return jsonResponse({ success: false, error: \"Database not configured\" }, 500);\r\n                }\r\n\r\n                const body = await request.json() as any;\r\n                const { name, email, phone, role, status } = body;\r\n\r\n                if (!name || !email || !phone || !body.password) {\r\n                    return jsonResponse({ success: false, error: \"All fields are required (name, email, phone, password)\" }, 400);\r\n                }\r\n\r\n                // Check if email exists\r\n                const existing = await env.proveloce_db.prepare(\r\n                    \"SELECT id FROM users WHERE email = ?\"\r\n                ).bind(email).first();\r\n\r\n                if (existing) {\r\n                    return jsonResponse({ success: false, error: \"Email already exists\" }, 409);\r\n                }\r\n\r\n                // Role creation restrictions\r\n                const requesterRole = (auth.payload.role || \"\").toLowerCase();\r\n                const finalRole = (role || \"Customer\").toLowerCase() === \"expert\" ? \"Expert\" : (role === \"Customer\" || role === \"viewer\" ? \"Customer\" : role);\r\n                const finalStatus = (status || \"active\").toLowerCase();\r\n\r\n                // Validation\r\n                if (!['superadmin', 'admin', 'Expert', 'Customer'].includes(finalRole)) {\r\n                    return jsonResponse({ success: false, error: \"Invalid role (must be Expert or Customer)\" }, 400);\r\n                }\r\n                if (!['active', 'inactive', 'suspended'].includes(finalStatus)) {\r\n                    return jsonResponse({ success: false, error: \"Invalid status\" }, 400);\r\n                }\r\n\r\n                // Only superadmin can create superadmin or admin users\r\n                if ((finalRole === \"superadmin\" || finalRole === \"admin\") && requesterRole !== \"superadmin\") {\r\n                    return jsonResponse({ success: false, error: \"Only superadmin can create privileged users\" }, 403);\r\n                }\r\n\r\n                // Hash password if provided\r\n                const password = body.password || \"123user123\";\r\n                const encoder = new TextEncoder();\r\n                const data = encoder.encode(password);\r\n                const hashBuffer = await crypto.subtle.digest(\"SHA-256\", data);\r\n                const hashArray = Array.from(new Uint8Array(hashBuffer));\r\n                const passwordHash = hashArray.map(b => b.toString(16).padStart(2, \"0\")).join(\"\");\r\n\r\n                const id = crypto.randomUUID();\r\n                await env.proveloce_db.prepare(\r\n                    \"INSERT INTO users (id, name, email, phone, role, status, email_verified, password_hash) VALUES (?, ?, ?, ?, ?, ?, 1, ?)\"\r\n                ).bind(id, name, email, phone || null, finalRole, finalStatus, passwordHash).run();\r\n\r\n                // Log activity\r\n                await env.proveloce_db.prepare(\r\n                    \"INSERT INTO activity_logs (id, user_id, action, entity_type, entity_id, metadata) VALUES (?, ?, ?, ?, ?, ?)\"\r\n                ).bind(crypto.randomUUID(), auth.payload.userId, \"CREATE_USER\", \"user\", id, JSON.stringify({ name, email, role: finalRole })).run();\r\n\r\n                const newUser = await env.proveloce_db.prepare(\r\n                    \"SELECT id, name, email, phone, role, status, created_at FROM users WHERE id = ?\"\r\n                ).bind(id).first();\r\n\r\n                return jsonResponse({ success: true, message: \"User created successfully\", data: { user: newUser } }, 201);\r\n            }\r\n\r\n            // PATCH /api/admin/users/:id - Update user\r\n            if (url.pathname.match(/^\\/api\\/admin\\/users\\/[^\\/]+$/) && request.method === \"PATCH\") {\r\n                const auth = await checkAdminRole(request);\r\n                if (!auth.valid) {\r\n                    return jsonResponse({ success: false, error: auth.error }, 401);\r\n                }\r\n\r\n                if (!env.proveloce_db) {\r\n                    return jsonResponse({ success: false, error: \"Database not configured\" }, 500);\r\n                }\r\n\r\n                const id = url.pathname.split(\"/\").pop();\r\n                const body = await request.json() as any;\r\n                const { name, email, phone, role, status, save_cta_state, save_cta_action } = body;\r\n\r\n                // Workflow_SaveCTA Enforcement\r\n                if (save_cta_state !== 'enabled' || save_cta_action !== 'commit_changes_to_db') {\r\n                    return jsonResponse({ success: false, error: \"Workflow compliance error: Save CTA state must be enabled and action must be commit_changes_to_db\" }, 400);\r\n                }\r\n\r\n                // Check if user exists and get their current role\r\n                const existing = await env.proveloce_db.prepare(\r\n                    \"SELECT id, role FROM users WHERE id = ?\"\r\n                ).bind(id).first() as any;\r\n\r\n                if (!existing) {\r\n                    return jsonResponse({ success: false, error: \"User not found\" }, 404);\r\n                }\r\n\r\n                // Get requester's role\r\n                const requesterRole = (auth.payload.role || \"\").toLowerCase();\r\n                const targetRole = (existing.role || \"\").toLowerCase();\r\n\r\n                // Prevent modifying superadmin accounts\r\n                if (targetRole === \"superadmin\") {\r\n                    return jsonResponse({ success: false, error: \"Cannot modify superadmin accounts\" }, 403);\r\n                }\r\n\r\n                // Admin cannot modify other admins\r\n                if (requesterRole === \"admin\" && targetRole === \"admin\") {\r\n                    return jsonResponse({ success: false, error: \"Admins cannot modify other admins\" }, 403);\r\n                }\r\n\r\n                // role change guards (RoleMapping spec)\r\n                if (role !== undefined) {\r\n                    if (!['superadmin', 'admin', 'Expert', 'Customer'].includes(role)) {\r\n                        return jsonResponse({ success: false, error: \"Invalid role mapping: value must be Expert or Customer\" }, 400);\r\n                    }\r\n\r\n                    // Enforce RBAC guardrails: Only superadmin can change roles\r\n                    if (requesterRole !== \"superadmin\") {\r\n                        return jsonResponse({ success: false, error: \"Only superadmin can change roles\" }, 403);\r\n                    }\r\n\r\n                    // Prevent self-demotion\r\n                    if (existing.id === auth.payload.userId) {\r\n                        return jsonResponse({ success: false, error: \"Superadmin cannot demote self\" }, 403);\r\n                    }\r\n                }\r\n\r\n                if (status !== undefined) {\r\n                    const nextStatus = status.toLowerCase();\r\n                    if (!['active', 'inactive', 'suspended'].includes(nextStatus)) {\r\n                        return jsonResponse({ success: false, error: \"Invalid status\" }, 400);\r\n                    }\r\n                }\r\n\r\n                // Build update query dynamically\r\n                const updates: string[] = [];\r\n                const values: any[] = [];\r\n\r\n                if (name !== undefined) { updates.push(\"name = ?\"); values.push(name); }\r\n                if (email !== undefined) { updates.push(\"email = ?\"); values.push(email); }\r\n                if (phone !== undefined) { updates.push(\"phone = ?\"); values.push(phone); }\r\n                if (role !== undefined) { updates.push(\"role = ?\"); values.push(role); }\r\n                if (status !== undefined) { updates.push(\"status = ?\"); values.push(status); }\r\n\r\n                if (updates.length === 0) {\r\n                    return jsonResponse({ success: false, error: \"No fields to update\" }, 400);\r\n                }\r\n\r\n                updates.push(\"updated_at = CURRENT_TIMESTAMP\");\r\n                values.push(id);\r\n\r\n                await env.proveloce_db.prepare(\r\n                    `UPDATE users SET ${updates.join(\", \")} WHERE id = ?`\r\n                ).bind(...values).run();\r\n\r\n                // Log activity with save_cta metadata\r\n                await env.proveloce_db.prepare(\r\n                    \"INSERT INTO activity_logs (id, user_id, action, entity_type, entity_id, metadata) VALUES (?, ?, ?, ?, ?, ?)\"\r\n                ).bind(\r\n                    crypto.randomUUID(),\r\n                    auth.payload.userId,\r\n                    \"UPDATE_USER\",\r\n                    \"user\",\r\n                    id,\r\n                    JSON.stringify({\r\n                        ...body,\r\n                        save_cta_invoked: {\r\n                            state: save_cta_state,\r\n                            action: save_cta_action,\r\n                            timestamp: new Date().toISOString()\r\n                        }\r\n                    })\r\n                ).run();\r\n\r\n                const updatedUser = await env.proveloce_db.prepare(\r\n                    \"SELECT id, name, email, phone, role, status, created_at FROM users WHERE id = ?\"\r\n                ).bind(id).first();\r\n\r\n                return jsonResponse({ success: true, message: \"User updated successfully\", data: { user: updatedUser } });\r\n            }\r\n\r\n            // DELETE /api/admin/users/:id - Deactivate user\r\n            if (url.pathname.match(/^\\/api\\/admin\\/users\\/[^\\/]+$/) && request.method === \"DELETE\") {\r\n                const auth = await checkAdminRole(request);\r\n                if (!auth.valid) {\r\n                    return jsonResponse({ success: false, error: auth.error }, 401);\r\n                }\r\n\r\n                if (!env.proveloce_db) {\r\n                    return jsonResponse({ success: false, error: \"Database not configured\" }, 500);\r\n                }\r\n\r\n                const id = url.pathname.split(\"/\").pop();\r\n\r\n                // Check if user exists\r\n                const existing = await env.proveloce_db.prepare(\r\n                    \"SELECT id, role FROM users WHERE id = ?\"\r\n                ).bind(id).first() as any;\r\n\r\n                if (!existing) {\r\n                    return jsonResponse({ success: false, error: \"User not found\" }, 404);\r\n                }\r\n\r\n                // Prevent deleting superadmin\r\n                if (existing.role === \"superadmin\") {\r\n                    return jsonResponse({ success: false, error: \"Cannot delete superadmin\" }, 403);\r\n                }\r\n\r\n                // Update status to 'inactive' (POML Spec)\r\n                await env.proveloce_db.prepare(\r\n                    \"UPDATE users SET status = 'inactive', updated_at = CURRENT_TIMESTAMP WHERE id = ?\"\r\n                ).bind(id).run();\r\n\r\n                // Log activity\r\n                await env.proveloce_db.prepare(\r\n                    \"INSERT INTO activity_logs (id, user_id, action, entity_type, entity_id, metadata) VALUES (?, ?, ?, ?, ?, ?)\"\r\n                ).bind(crypto.randomUUID(), auth.payload.userId, \"DEACTIVATE_USER\", \"user\", id, JSON.stringify({ oldRole: existing.role, newStatus: 'inactive' })).run();\r\n\r\n                return jsonResponse({ success: true, message: \"User deactivated successfully\" });\r\n            }\r\n\r\n            // GET /api/admin/stats - Dashboard statistics\r\n            if (url.pathname === \"/api/admin/stats\" && request.method === \"GET\") {\r\n                const auth = await checkAdminRole(request);\r\n                if (!auth.valid) {\r\n                    return jsonResponse({ success: false, error: auth.error }, 401);\r\n                }\r\n\r\n                if (!env.proveloce_db) {\r\n                    return jsonResponse({ success: false, error: \"Database not configured\" }, 500);\r\n                }\r\n\r\n                const stats = {\r\n                    totalUsers: 0,\r\n                    admins: 0,\r\n                    analysts: 0,\r\n                    experts: 0,\r\n                    customers: 0,\r\n                    agents: 0, // Added agent count\r\n                    viewers: 0, // Added viewer count\r\n                    activeUsers: 0,\r\n                    pendingUsers: 0,\r\n                    recentUsers: [] as any[]\r\n                };\r\n\r\n                // Get counts by role (FILTERED BY ACTIVE STATUS per Spec)\r\n                const roleCounts = await env.proveloce_db.prepare(\r\n                    \"SELECT role, COUNT(*) as count FROM users WHERE status = 'active' GROUP BY role\"\r\n                ).all();\r\n\r\n                // Get Total Users count separately (all statuses)\r\n                const totalCount = await env.proveloce_db.prepare(\r\n                    \"SELECT COUNT(*) as count FROM users\"\r\n                ).first() as any;\r\n                stats.totalUsers = totalCount?.count || 0;\r\n\r\n                for (const row of roleCounts.results as any[]) {\r\n                    const role = (row.role || \"\").toLowerCase();\r\n                    const count = row.count || 0;\r\n                    if (role === \"admin\") stats.admins = count;\r\n                    if (role === \"superadmin\") stats.admins += count; // Include superadmins in admin count\r\n                    if (role === \"expert\") stats.experts = count;\r\n                    if (role === \"customer\") stats.customers = count;\r\n                    if (role === \"analyst\") stats.analysts = count;\r\n                }\r\n\r\n                // Get counts by status\r\n                const statusCounts = await env.proveloce_db.prepare(\r\n                    \"SELECT status, COUNT(*) as count FROM users GROUP BY status\"\r\n                ).all();\r\n\r\n                for (const row of statusCounts.results as any[]) {\r\n                    const status = (row.status || \"\").toLowerCase();\r\n                    const count = row.count || 0;\r\n                    if (status === \"active\") stats.activeUsers = count;\r\n                    if (status === \"pending_verification\") stats.pendingUsers = count;\r\n                }\r\n\r\n                // Get recent users\r\n                const recentUsers = await env.proveloce_db.prepare(\r\n                    \"SELECT id, name, email, role, status, created_at FROM users ORDER BY created_at DESC LIMIT 5\"\r\n                ).all();\r\n                stats.recentUsers = recentUsers.results as any[];\r\n\r\n                return jsonResponse({ success: true, data: stats });\r\n            }\r\n\r\n            // GET /api/admin/logs - Activity logs (SUPERADMIN only)\r\n            if (url.pathname === \"/api/admin/logs\" && request.method === \"GET\") {\r\n                const auth = await checkAdminRole(request);\r\n                if (!auth.valid) {\r\n                    return jsonResponse({ success: false, error: auth.error }, 401);\r\n                }\r\n\r\n                // Restrict to superadmin only\r\n                if ((auth.payload.role || \"\").toLowerCase() !== \"superadmin\") {\r\n                    return jsonResponse({ success: false, error: \"Superadmin access required\" }, 403);\r\n                }\r\n\r\n                if (!env.proveloce_db) {\r\n                    return jsonResponse({ success: false, error: \"Database not configured\" }, 500);\r\n                }\r\n\r\n                const action = url.searchParams.get(\"action\");\r\n                const userId = url.searchParams.get(\"userId\");\r\n                const page = parseInt(url.searchParams.get(\"page\") || \"1\");\r\n                const limit = parseInt(url.searchParams.get(\"limit\") || \"50\");\r\n                const offset = (page - 1) * limit;\r\n\r\n                let query = `\r\n                    SELECT al.*, u.name as user_name, u.email as user_email \r\n                    FROM activity_logs al \r\n                    LEFT JOIN users u ON al.user_id = u.id \r\n                    WHERE 1=1\r\n                `;\r\n                const params: any[] = [];\r\n\r\n                if (action) {\r\n                    query += \" AND al.action = ?\";\r\n                    params.push(action);\r\n                }\r\n                if (userId) {\r\n                    query += \" AND al.user_id = ?\";\r\n                    params.push(userId);\r\n                }\r\n\r\n                query += \" ORDER BY al.created_at DESC LIMIT ? OFFSET ?\";\r\n                params.push(limit, offset);\r\n\r\n                const result = await env.proveloce_db.prepare(query).bind(...params).all();\r\n\r\n                return jsonResponse({ success: true, data: { logs: result.results } });\r\n            }\r\n\r\n            // =====================================================\r\n            // Expert Application Routes\r\n            // =====================================================\r\n\r\n            // GET /api/applications - Admin: List all expert applications\r\n            if (url.pathname === \"/api/applications\" && request.method === \"GET\") {\r\n                console.log(\"\uD83D\uDCCB Admin: Fetching expert applications\");\r\n\r\n                const authHeader = request.headers.get(\"Authorization\");\r\n                if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const token = authHeader.substring(7);\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\");\r\n\r\n                if (!payload) {\r\n                    return jsonResponse({ success: false, error: \"Invalid or expired token\" }, 401);\r\n                }\r\n\r\n                // Check admin role\r\n                const role = (payload.role || \"\").toLowerCase();\r\n                if (role !== \"admin\" && role !== \"superadmin\") {\r\n                    console.log(`\u274C Access denied for role: ${role}`);\r\n                    return jsonResponse({ success: false, error: \"Access denied. Admin role required.\" }, 403);\r\n                }\r\n\r\n                if (!env.proveloce_db) {\r\n                    return jsonResponse({ success: false, error: \"Database not configured\" }, 500);\r\n                }\r\n\r\n                // Get status filter from query params\r\n                // Handle malformed status values like \"PENDING:1\" (cache-busting suffixes)\r\n                let statusFilter = url.searchParams.get(\"status\");\r\n                if (statusFilter && statusFilter.includes(\":\")) {\r\n                    statusFilter = statusFilter.split(\":\")[0];\r\n                }\r\n                // Validate status is one of the allowed values\r\n                const validStatuses = [\"PENDING\", \"APPROVED\", \"REJECTED\", \"DRAFT\", \"UNDER_REVIEW\", \"REQUIRES_CLARIFICATION\", \"REVOKED\", \"\"];\r\n                if (statusFilter && !validStatuses.includes(statusFilter.toUpperCase())) {\r\n                    statusFilter = null;\r\n                }\r\n                console.log(`\uD83D\uDCCA Status filter: ${statusFilter || 'none'}`);\r\n\r\n                try {\r\n                    let query = `\r\n                        SELECT \r\n                            ea.id,\r\n                            ea.user_id as userId,\r\n                            ea.status,\r\n                            ea.dob,\r\n                            ea.gender,\r\n                            ea.address_line1 as addressLine1,\r\n                            ea.address_line2 as addressLine2,\r\n                            ea.city,\r\n                            ea.state,\r\n                            ea.country,\r\n                            ea.pincode,\r\n                            ea.government_id_type as governmentIdType,\r\n                            ea.government_id_url as governmentIdUrl,\r\n                            ea.profile_photo_url as profilePhotoUrl,\r\n                            ea.domains,\r\n                            ea.skills,\r\n                            ea.years_of_experience as yearsOfExperience,\r\n                            ea.summary_bio as summaryBio,\r\n                            ea.resume_url as resumeUrl,\r\n                            ea.portfolio_urls as portfolioUrls,\r\n                            ea.certification_urls as certificationUrls,\r\n                            ea.working_type as workingType,\r\n                            ea.hourly_rate as hourlyRate,\r\n                            ea.languages,\r\n                            ea.available_days as availableDays,\r\n                            ea.available_time_slots as availableTimeSlots,\r\n                            ea.work_preference as workPreference,\r\n                            ea.communication_mode as communicationMode,\r\n                            ea.terms_accepted as termsAccepted,\r\n                            ea.nda_accepted as ndaAccepted,\r\n                            ea.signature_url as signatureUrl,\r\n                            ea.rejection_reason as rejectionReason,\r\n                            ea.reviewed_by as reviewedBy,\r\n                            ea.reviewed_at as reviewedAt,\r\n                            ea.created_at as createdAt,\r\n                            ea.submitted_at as submittedAt,\r\n                            ea.updated_at as updatedAt,\r\n                            u.id as \"user.id\",\r\n                            u.name as \"user.name\",\r\n                            u.email as \"user.email\",\r\n                            u.phone as \"user.phone\"\r\n                        FROM expert_applications ea\r\n                        JOIN users u ON u.id = ea.user_id\r\n                    `;\r\n                    const params: any[] = [];\r\n                    const requesterOrgId = payload.org_id || 'ORG-DEFAULT';\r\n                    const isAdmin = role === 'admin';\r\n\r\n                    let whereClauses = [];\r\n\r\n                    if (isAdmin) {\r\n                        whereClauses.push(\"ea.org_id = ?\");\r\n                        params.push(requesterOrgId);\r\n                    }\r\n\r\n                    if (statusFilter && statusFilter !== \"\") {\r\n                        whereClauses.push(\"LOWER(ea.status) = LOWER(?)\");\r\n                        params.push(statusFilter);\r\n                    }\r\n\r\n                    if (whereClauses.length > 0) {\r\n                        query += ` WHERE ${whereClauses.join(\" AND \")}`;\r\n                    }\r\n\r\n                    query += ` ORDER BY ea.created_at DESC LIMIT 100`;\r\n\r\n                    const result = await env.proveloce_db.prepare(query).bind(...params).all();\r\n                    console.log(`\u2705 Found ${result.results.length} applications`);\r\n\r\n                    // Transform to expected format with nested user object\r\n                    const applications = result.results.map((row: any) => {\r\n                        // Parse JSON fields\r\n                        let domains = [];\r\n                        let skills = [];\r\n                        let availableDays = [];\r\n                        let availableTimeSlots = [];\r\n\r\n                        try { domains = row.domains ? JSON.parse(row.domains) : []; } catch { }\r\n                        try { skills = row.skills ? JSON.parse(row.skills) : []; } catch { }\r\n                        try { availableDays = row.availableDays ? JSON.parse(row.availableDays) : []; } catch { }\r\n                        try { availableTimeSlots = row.availableTimeSlots ? JSON.parse(row.availableTimeSlots) : []; } catch { }\r\n\r\n                        // Parse additional JSON fields\r\n                        let portfolioUrls = [];\r\n                        let certificationUrls = [];\r\n                        let languages = [];\r\n                        try { portfolioUrls = row.portfolioUrls ? JSON.parse(row.portfolioUrls) : []; } catch { }\r\n                        try { certificationUrls = row.certificationUrls ? JSON.parse(row.certificationUrls) : []; } catch { }\r\n                        try { languages = row.languages ? JSON.parse(row.languages) : []; } catch { }\r\n\r\n                        let docMetadata = [];\r\n                        let imgMetadata = [];\r\n                        try { docMetadata = row.documents ? JSON.parse(row.documents) : []; } catch { }\r\n                        try { imgMetadata = row.images ? JSON.parse(row.images) : []; } catch { }\r\n\r\n                        return {\r\n                            id: row.id,\r\n                            userId: row.userId,\r\n                            orgId: row.org_id,\r\n                            status: (row.status || 'DRAFT').toUpperCase(),\r\n                            dob: row.dob,\r\n                            gender: row.gender,\r\n                            addressLine1: row.addressLine1,\r\n                            addressLine2: row.addressLine2,\r\n                            city: row.city,\r\n                            state: row.state,\r\n                            country: row.country,\r\n                            pincode: row.pincode,\r\n                            governmentIdType: row.governmentIdType,\r\n                            governmentIdUrl: row.governmentIdUrl,\r\n                            profilePhotoUrl: row.profilePhotoUrl,\r\n                            domains,\r\n                            skills,\r\n                            yearsOfExperience: row.yearsOfExperience,\r\n                            summaryBio: row.summaryBio,\r\n                            resumeUrl: row.resumeUrl,\r\n                            portfolioUrls,\r\n                            certificationUrls,\r\n                            workingType: row.workingType,\r\n                            hourlyRate: row.hourlyRate,\r\n                            languages,\r\n                            availableDays,\r\n                            availableTimeSlots,\r\n                            workPreference: row.workPreference,\r\n                            communicationMode: row.communicationMode,\r\n                            termsAccepted: row.termsAccepted,\r\n                            ndaAccepted: row.ndaAccepted,\r\n                            signatureUrl: row.signatureUrl,\r\n                            rejectionReason: row.rejectionReason,\r\n                            reviewedBy: row.reviewedBy,\r\n                            reviewedAt: row.reviewedAt,\r\n                            createdAt: row.createdAt,\r\n                            submittedAt: row.submittedAt,\r\n                            updatedAt: row.updatedAt,\r\n                            user: {\r\n                                id: row[\"user.id\"],\r\n                                name: row[\"user.name\"],\r\n                                email: row[\"user.email\"],\r\n                                phone: row[\"user.phone\"],\r\n                            },\r\n                        };\r\n                    });\r\n\r\n                    return jsonResponse({\r\n                        success: true,\r\n                        data: {\r\n                            applications,\r\n                            count: applications.length,\r\n                        },\r\n                    });\r\n                } catch (error: any) {\r\n                    console.error(\"Error fetching applications:\", error);\r\n                    // Return empty array instead of 500 error\r\n                    return jsonResponse({\r\n                        success: true,\r\n                        data: {\r\n                            applications: [],\r\n                            count: 0,\r\n                        },\r\n                    });\r\n                }\r\n            }\r\n\r\n            // GET /api/applications/:id - Admin: Get single application with all details and documents\r\n            if (url.pathname.match(/^\\/api\\/applications\\/[^\\/]+$/) && request.method === \"GET\") {\r\n                const authHeader = request.headers.get(\"Authorization\");\r\n                if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const token = authHeader.substring(7);\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\");\r\n\r\n                if (!payload) {\r\n                    return jsonResponse({ success: false, error: \"Invalid or expired token\" }, 401);\r\n                }\r\n\r\n                const role = (payload.role || \"\").toLowerCase();\r\n                if (role !== \"admin\" && role !== \"superadmin\") {\r\n                    return jsonResponse({ success: false, error: \"Access denied\" }, 403);\r\n                }\r\n\r\n                const pathParts = url.pathname.split(\"/\");\r\n                const applicationId = pathParts[3];\r\n\r\n                if (!env.proveloce_db) {\r\n                    return jsonResponse({ success: false, error: \"Database not configured\" }, 500);\r\n                }\r\n\r\n                try {\r\n                    // Fetch complete application with user info\r\n                    const app = await env.proveloce_db.prepare(`\r\n                        SELECT \r\n                            ea.*,\r\n                            u.name as user_name,\r\n                            u.email as user_email,\r\n                            u.phone as user_phone\r\n                        FROM expert_applications ea\r\n                        JOIN users u ON u.id = ea.user_id\r\n                        WHERE ea.id = ?\r\n                    `).bind(applicationId).first() as any;\r\n\r\n                    if (!app) {\r\n                        return jsonResponse({ success: false, error: \"Application not found\" }, 404);\r\n                    }\r\n\r\n                    // Tenant Isolation Check (Spec v2.0)\r\n                    const requesterOrgId = payload.org_id || 'ORG-DEFAULT';\r\n                    if (role === 'admin' && app.org_id !== requesterOrgId) {\r\n                        return jsonResponse({ success: false, error: \"Access denied. Tenant mismatch.\" }, 403);\r\n                    }\r\n\r\n                    // Fetch all documents for this application\r\n                    const docsResult = await env.proveloce_db.prepare(`\r\n                        SELECT * FROM expert_documents WHERE application_id = ? OR user_id = ?\r\n                    `).bind(applicationId, app.user_id).all();\r\n\r\n                    // Generate signed URLs for each document\r\n                    const documents: any[] = [];\r\n                    for (const doc of docsResult.results as any[]) {\r\n                        let signedUrl = null;\r\n                        if (doc.r2_object_key && env.EXPERT_APPLICATION) {\r\n                            try {\r\n                                const object = await env.EXPERT_APPLICATION.head(doc.r2_object_key);\r\n                                if (object) {\r\n                                    // Generate a simple presigned-like URL (for display)\r\n                                    signedUrl = `https://backend.proveloce.com/api/documents/${doc.id}/download`;\r\n                                }\r\n                            } catch (e) {\r\n                                console.log(`Could not find R2 object: ${doc.r2_object_key}`);\r\n                            }\r\n                        }\r\n                        documents.push({\r\n                            id: doc.id,\r\n                            type: doc.document_type,\r\n                            fileName: doc.file_name,\r\n                            r2Key: doc.r2_object_key,\r\n                            url: signedUrl,\r\n                            reviewStatus: doc.review_status,\r\n                            uploadedAt: doc.uploaded_at,\r\n                        });\r\n                    }\r\n\r\n                    // Parse JSON fields\r\n                    let domains = [], skills = [], languages = [], availableDays = [], availableTimeSlots = [];\r\n                    let portfolioUrls = [], certificationUrls = [];\r\n                    try { domains = app.domains ? JSON.parse(app.domains) : []; } catch { }\r\n                    try { skills = app.skills ? JSON.parse(app.skills) : []; } catch { }\r\n                    try { languages = app.languages ? JSON.parse(app.languages) : []; } catch { }\r\n                    try { availableDays = app.available_days ? JSON.parse(app.available_days) : []; } catch { }\r\n                    try { availableTimeSlots = app.available_time_slots ? JSON.parse(app.available_time_slots) : []; } catch { }\r\n                    try { portfolioUrls = app.portfolio_urls ? JSON.parse(app.portfolio_urls) : []; } catch { }\r\n                    try { certificationUrls = app.certification_urls ? JSON.parse(app.certification_urls) : []; } catch { }\r\n\r\n                    const application = {\r\n                        id: app.id,\r\n                        userId: app.user_id,\r\n                        status: (app.status || 'DRAFT').toUpperCase(),\r\n\r\n                        // Personal Info\r\n                        user: {\r\n                            name: app.user_name,\r\n                            email: app.user_email,\r\n                            phone: app.user_phone,\r\n                        },\r\n                        dob: app.dob,\r\n                        gender: app.gender,\r\n                        address: {\r\n                            line1: app.address_line1,\r\n                            line2: app.address_line2,\r\n                            city: app.city,\r\n                            state: app.state,\r\n                            country: app.country,\r\n                            pincode: app.pincode,\r\n                        },\r\n\r\n                        // Professional Info\r\n                        governmentIdType: app.government_id_type,\r\n                        domains,\r\n                        skills,\r\n                        yearsOfExperience: app.years_of_experience,\r\n                        summaryBio: app.summary_bio,\r\n                        workingType: app.working_type,\r\n                        hourlyRate: app.hourly_rate,\r\n                        projectRate: app.project_rate,\r\n                        languages,\r\n                        portfolioUrls,\r\n\r\n                        // Availability\r\n                        availableDays,\r\n                        availableTimeSlots,\r\n                        workPreference: app.work_preference,\r\n                        communicationMode: app.communication_mode,\r\n\r\n                        // Legal\r\n                        termsAccepted: !!app.terms_accepted,\r\n                        ndaAccepted: !!app.nda_accepted,\r\n                        signatureUrl: app.signature_url,\r\n\r\n                        // Documents (from R2)\r\n                        documents,\r\n                        profilePhotoUrl: app.profile_photo_url,\r\n                        governmentIdUrl: app.government_id_url,\r\n                        resumeUrl: app.resume_url,\r\n                        certificationUrls,\r\n\r\n                        // Timestamps\r\n                        createdAt: app.created_at,\r\n                        updatedAt: app.updated_at,\r\n                        submittedAt: app.submitted_at,\r\n\r\n                        // Review Info\r\n                        reviewedBy: app.reviewed_by,\r\n                        reviewedAt: app.reviewed_at,\r\n                        rejectionReason: app.rejection_reason,\r\n                        internalNotes: app.internal_notes,\r\n                    };\r\n\r\n                    return jsonResponse({\r\n                        success: true,\r\n                        data: { application }\r\n                    });\r\n                } catch (error: any) {\r\n                    console.error(\"Error fetching application details:\", error);\r\n                    return jsonResponse({ success: false, error: \"Failed to fetch application\" }, 500);\r\n                }\r\n            }\r\n\r\n            // POST /api/applications/:id/approve - Approve application\r\n            if (url.pathname.match(/^\\/api\\/applications\\/[^\\/]+\\/approve$/) && request.method === \"POST\") {\r\n                const authHeader = request.headers.get(\"Authorization\");\r\n                if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const token = authHeader.substring(7);\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\");\r\n\r\n                if (!payload) {\r\n                    return jsonResponse({ success: false, error: \"Invalid or expired token\" }, 401);\r\n                }\r\n\r\n                const role = (payload.role || \"\").toLowerCase();\r\n                if (role !== \"admin\" && role !== \"superadmin\") {\r\n                    return jsonResponse({ success: false, error: \"Access denied\" }, 403);\r\n                }\r\n\r\n                const pathParts = url.pathname.split(\"/\");\r\n                const applicationId = pathParts[3];\r\n\r\n                if (!env.proveloce_db) {\r\n                    return jsonResponse({ success: false, error: \"Database not configured\" }, 500);\r\n                }\r\n\r\n                // Get the application to find user_id\r\n                const app = await env.proveloce_db.prepare(\r\n                    \"SELECT user_id FROM expert_applications WHERE id = ?\"\r\n                ).bind(applicationId).first() as any;\r\n\r\n                if (!app) {\r\n                    return jsonResponse({ success: false, error: \"Application not found\" }, 404);\r\n                }\r\n\r\n                // Update application status to 'Approved'\r\n                await env.proveloce_db.prepare(\r\n                    \"UPDATE expert_applications SET status = 'approved', reviewed_by = ?, reviewed_at = CURRENT_TIMESTAMP, updated_at = CURRENT_TIMESTAMP WHERE id = ?\"\r\n                ).bind(payload.userId, applicationId).run();\r\n\r\n                // Update user role to 'agent'\r\n                await env.proveloce_db.prepare(\r\n                    \"UPDATE users SET role = 'agent', updated_at = CURRENT_TIMESTAMP WHERE id = ?\"\r\n                ).bind(app.user_id).run();\r\n\r\n                // Log activity\r\n                await env.proveloce_db.prepare(\r\n                    \"INSERT INTO activity_logs (id, user_id, action, entity_type, entity_id, metadata) VALUES (?, ?, ?, ?, ?, ?)\"\r\n                ).bind(crypto.randomUUID(), payload.userId, \"APPROVE_EXPERT_APPLICATION\", \"expert_application\", applicationId, JSON.stringify({ approvedBy: payload.userId, userId: app.user_id, status: 'approved', role: 'agent' })).run();\r\n\r\n                return jsonResponse({ success: true, message: \"Application approved\" });\r\n            }\r\n\r\n            // POST /api/applications/:id/reject - Reject application\r\n            if (url.pathname.match(/^\\/api\\/applications\\/[^\\/]+\\/reject$/) && request.method === \"POST\") {\r\n                const authHeader = request.headers.get(\"Authorization\");\r\n                if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const token = authHeader.substring(7);\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\");\r\n\r\n                if (!payload) {\r\n                    return jsonResponse({ success: false, error: \"Invalid or expired token\" }, 401);\r\n                }\r\n\r\n                const role = (payload.role || \"\").toLowerCase();\r\n                if (role !== \"admin\" && role !== \"superadmin\") {\r\n                    return jsonResponse({ success: false, error: \"Access denied\" }, 403);\r\n                }\r\n\r\n                const pathParts = url.pathname.split(\"/\");\r\n                const applicationId = pathParts[3];\r\n\r\n                const body = await request.json() as any;\r\n                const reason = body.reason || \"No reason provided\";\r\n\r\n                if (!env.proveloce_db) {\r\n                    return jsonResponse({ success: false, error: \"Database not configured\" }, 500);\r\n                }\r\n\r\n                await env.proveloce_db.prepare(\r\n                    \"UPDATE expert_applications SET status = 'Rejected', rejection_reason = ?, reviewed_by = ?, reviewed_at = CURRENT_TIMESTAMP, updated_at = CURRENT_TIMESTAMP WHERE id = ?\"\r\n                ).bind(reason, payload.userId, applicationId).run();\r\n\r\n                // Log activity\r\n                await env.proveloce_db.prepare(\r\n                    \"INSERT INTO activity_logs (id, user_id, action, entity_type, entity_id, metadata) VALUES (?, ?, ?, ?, ?, ?)\"\r\n                ).bind(crypto.randomUUID(), payload.userId, \"REJECT_EXPERT_APPLICATION\", \"expert_application\", applicationId, JSON.stringify({ rejectedBy: payload.userId, status: 'Rejected', reason })).run();\r\n\r\n                return jsonResponse({ success: true, message: \"Application rejected\" });\r\n            }\r\n\r\n            // POST /api/applications/:id/remove - Remove/revoke an approved expert\r\n            if (url.pathname.match(/^\\/api\\/applications\\/[^\\/]+\\/remove$/) && request.method === \"POST\") {\r\n                const authHeader = request.headers.get(\"Authorization\");\r\n                if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const token = authHeader.substring(7);\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\");\r\n\r\n                if (!payload) {\r\n                    return jsonResponse({ success: false, error: \"Invalid or expired token\" }, 401);\r\n                }\r\n\r\n                const role = (payload.role || \"\").toLowerCase();\r\n                if (role !== \"admin\" && role !== \"superadmin\") {\r\n                    return jsonResponse({ success: false, error: \"Access denied\" }, 403);\r\n                }\r\n\r\n                const pathParts = url.pathname.split(\"/\");\r\n                const applicationId = pathParts[3];\r\n\r\n                const body = await request.json() as any;\r\n                const reason = body.reason || \"No reason provided\";\r\n                const permanentBan = body.permanentBan || false;\r\n\r\n                if (!env.proveloce_db) {\r\n                    return jsonResponse({ success: false, error: \"Database not configured\" }, 500);\r\n                }\r\n\r\n                try {\r\n                    // Get the application to find user_id\r\n                    const app = await env.proveloce_db.prepare(\r\n                        \"SELECT user_id, status FROM expert_applications WHERE id = ?\"\r\n                    ).bind(applicationId).first() as any;\r\n\r\n                    if (!app) {\r\n                        return jsonResponse({ success: false, error: \"Application not found\" }, 404);\r\n                    }\r\n\r\n                    // Only allow removing approved experts\r\n                    if ((app.status || '').toLowerCase() !== 'approved') {\r\n                        return jsonResponse({\r\n                            success: false,\r\n                            error: \"Can only remove approved experts. Current status: \" + app.status\r\n                        }, 400);\r\n                    }\r\n\r\n                    // Update application status to REVOKED\r\n                    await env.proveloce_db.prepare(`\r\n                        UPDATE expert_applications \r\n                        SET status = 'revoked', \r\n                            rejection_reason = ?, \r\n                            reviewed_by = ?,\r\n                            reviewed_at = CURRENT_TIMESTAMP,\r\n                            updated_at = CURRENT_TIMESTAMP \r\n                        WHERE id = ?\r\n                    `).bind(reason, payload.userId, applicationId).run();\r\n\r\n                    // Revert user role back to customer (or suspended if permanent ban)\r\n                    const newRole = permanentBan ? 'suspended' : 'customer';\r\n                    await env.proveloce_db.prepare(\r\n                        \"UPDATE users SET role = ?, updated_at = CURRENT_TIMESTAMP WHERE id = ?\"\r\n                    ).bind(newRole, app.user_id).run();\r\n\r\n                    // Log activity\r\n                    await env.proveloce_db.prepare(\r\n                        \"INSERT INTO activity_logs (id, user_id, action, entity_type, entity_id, metadata) VALUES (?, ?, ?, ?, ?, ?)\"\r\n                    ).bind(\r\n                        crypto.randomUUID(),\r\n                        payload.userId,\r\n                        \"REMOVE_EXPERT\",\r\n                        \"expert_application\",\r\n                        applicationId,\r\n                        JSON.stringify({ removedBy: payload.userId, reason, permanentBan })\r\n                    ).run();\r\n\r\n                    return jsonResponse({\r\n                        success: true,\r\n                        message: permanentBan ? \"Expert removed and permanently banned\" : \"Expert removed\"\r\n                    });\r\n                } catch (error: any) {\r\n                    console.error(\"Error removing expert:\", error);\r\n                    return jsonResponse({ success: false, error: \"Failed to remove expert\" }, 500);\r\n                }\r\n            }\r\n\r\n            // GET /api/expert-application - Get current user's application\r\n            if (url.pathname === \"/api/expert-application\" && request.method === \"GET\") {\r\n                const authHeader = request.headers.get(\"Authorization\");\r\n                if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const token = authHeader.substring(7);\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\");\r\n\r\n                if (!payload) {\r\n                    return jsonResponse({ success: false, error: \"Invalid or expired token\" }, 401);\r\n                }\r\n\r\n                if (!env.proveloce_db) {\r\n                    return jsonResponse({ success: false, error: \"Database not configured\" }, 500);\r\n                }\r\n\r\n                try {\r\n                    let application = await env.proveloce_db.prepare(\r\n                        \"SELECT * FROM expert_applications WHERE user_id = ?\"\r\n                    ).bind(payload.userId).first();\r\n\r\n                    // AUTO-CREATE: If no application exists, create one with DRAFT status\r\n                    if (!application) {\r\n                        const newId = crypto.randomUUID();\r\n                        const userOrgId = payload.org_id || 'ORG-DEFAULT';\r\n                        await env.proveloce_db.prepare(`\r\n                            INSERT INTO expert_applications (id, user_id, org_id, status, created_at, updated_at)\r\n                            VALUES (?, ?, ?, 'draft', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP)\r\n                        `).bind(newId, payload.userId, userOrgId).run();\r\n\r\n                        application = {\r\n                            id: newId,\r\n                            user_id: payload.userId,\r\n                            org_id: userOrgId,\r\n                            status: 'draft',\r\n                            created_at: new Date().toISOString(),\r\n                            updated_at: new Date().toISOString()\r\n                        };\r\n                        console.log(`\u2705 Auto-created DRAFT application for user ${payload.userId}`);\r\n                    }\r\n\r\n                    return jsonResponse({\r\n                        success: true,\r\n                        data: {\r\n                            application: {\r\n                                ...application,\r\n                                profile_phone: application.profile_phone || \"\",\r\n                                profile_dob: application.profile_dob || \"\",\r\n                                profile_address: application.profile_address || \"\"\r\n                            }\r\n                        }\r\n                    });\r\n                } catch (error: any) {\r\n                    console.error(\"Error fetching/creating application:\", error);\r\n                    return jsonResponse({ success: false, error: \"Failed to fetch application\" }, 500);\r\n                }\r\n            }\r\n\r\n            // POST /api/expert-application - Save/update draft (POML v1.0)\r\n            if (url.pathname === \"/api/expert-application\" && request.method === \"POST\") {\r\n                const authHeader = request.headers.get(\"Authorization\");\r\n                if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const token = authHeader.substring(7);\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\");\r\n\r\n                if (!payload) {\r\n                    return jsonResponse({ success: false, error: \"Invalid or expired token\" }, 401);\r\n                }\r\n\r\n                if (!env.proveloce_db) {\r\n                    return jsonResponse({ success: false, error: \"Database not configured\" }, 500);\r\n                }\r\n\r\n                try {\r\n                    const body = await request.json() as any;\r\n\r\n                    // Check if application exists\r\n                    const existing = await env.proveloce_db.prepare(\r\n                        \"SELECT id, status FROM expert_applications WHERE user_id = ?\"\r\n                    ).bind(payload.userId).first() as any;\r\n\r\n                    if (existing) {\r\n                        const currentStatus = (existing.status || '').toLowerCase();\r\n                        if (currentStatus === 'pending') {\r\n                            return jsonResponse({ success: false, error: \"Cannot modify application while it's under review\" }, 400);\r\n                        }\r\n                        if (currentStatus === 'approved') {\r\n                            return jsonResponse({ success: false, error: \"Your application has already been approved\" }, 400);\r\n                        }\r\n\r\n                        // Update existing application (POML fields)\r\n                        await env.proveloce_db.prepare(`\r\n                            UPDATE expert_applications SET\r\n                                profile_phone = ?, \r\n                                profile_dob = ?, \r\n                                profile_address = ?,\r\n                                status = 'draft',\r\n                                updated_at = CURRENT_TIMESTAMP\r\n                            WHERE user_id = ?\r\n                        `).bind(\r\n                            body.phone || \"\",\r\n                            body.dob || \"\",\r\n                            body.address || \"\",\r\n                            payload.userId\r\n                        ).run();\r\n                    } else {\r\n                        // Create new application draft\r\n                        const id = crypto.randomUUID();\r\n                        const userOrgId = payload.org_id || 'ORG-DEFAULT';\r\n                        await env.proveloce_db.prepare(`\r\n                            INSERT INTO expert_applications (\r\n                                id, user_id, org_id, status,\r\n                                profile_phone, profile_dob, profile_address,\r\n                                created_at, updated_at\r\n                            ) VALUES (?, ?, ?, 'draft', ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP)\r\n                        `).bind(\r\n                            id, payload.userId, userOrgId,\r\n                            body.phone || \"\",\r\n                            body.dob || \"\",\r\n                            body.address || \"\"\r\n                        ).run();\r\n                    }\r\n\r\n                    console.log(`\u2705 Draft saved for user ${payload.userId}`);\r\n                    return jsonResponse({ success: true, message: \"Application saved successfully\" });\r\n                } catch (error: any) {\r\n                    console.error(\"Error saving application draft:\", error);\r\n                    return jsonResponse({ success: false, error: \"Failed to save application\" }, 500);\r\n                }\r\n            }\r\n\r\n            // POST /api/expert-application/submit - Submit application\r\n            if (url.pathname === \"/api/expert-application/submit\" && request.method === \"POST\") {\r\n                const authHeader = request.headers.get(\"Authorization\");\r\n                if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const token = authHeader.substring(7);\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\");\r\n\r\n                if (!payload) {\r\n                    return jsonResponse({ success: false, error: \"Invalid or expired token\" }, 401);\r\n                }\r\n\r\n                if (!env.proveloce_db) {\r\n                    return jsonResponse({ success: false, error: \"Database not configured\" }, 500);\r\n                }\r\n\r\n                try {\r\n                    // First check if application exists and its current status\r\n                    const existing = await env.proveloce_db.prepare(\r\n                        \"SELECT id, status FROM expert_applications WHERE user_id = ?\"\r\n                    ).bind(payload.userId).first() as any;\r\n\r\n                    if (!existing) {\r\n                        return jsonResponse({\r\n                            success: false,\r\n                            error: \"No application found. Please save a draft first.\"\r\n                        }, 404);\r\n                    }\r\n\r\n                    const currentStatus = (existing.status || '').toLowerCase();\r\n\r\n                    // GUARD: Only allow submitting if status is DRAFT or REJECTED (reapply)\r\n                    if (currentStatus === 'pending') {\r\n                        return jsonResponse({\r\n                            success: false,\r\n                            error: \"Application already submitted and under review\"\r\n                        }, 400);\r\n                    }\r\n                    if (currentStatus === 'approved') {\r\n                        return jsonResponse({\r\n                            success: false,\r\n                            error: \"Your application has already been approved\"\r\n                        }, 400);\r\n                    }\r\n\r\n                    // Update status to pending\r\n                    await env.proveloce_db.prepare(`\r\n                        UPDATE expert_applications \r\n                        SET status = 'pending', submitted_at = CURRENT_TIMESTAMP, updated_at = CURRENT_TIMESTAMP\r\n                        WHERE user_id = ?\r\n                    `).bind(payload.userId).run();\r\n\r\n                    // Log activity\r\n                    await env.proveloce_db.prepare(\r\n                        \"INSERT INTO activity_logs (id, user_id, action, entity_type, entity_id, metadata) VALUES (?, ?, ?, ?, ?, ?)\"\r\n                    ).bind(crypto.randomUUID(), payload.userId, \"SUBMIT_EXPERT_APPLICATION\", \"expert_application\", existing.id, JSON.stringify({ timestamp: new Date().toISOString() })).run();\r\n\r\n                    // Notification\r\n                    await createNotification(\r\n                        env, payload.userId, 'INFO',\r\n                        'Application Submitted',\r\n                        'Your expert application has been submitted for review. We will notify you once a decision is made.',\r\n                        '/customer/expert-application'\r\n                    );\r\n\r\n                    console.log(`\u2705 Application submitted for user ${payload.userId}`);\r\n                    return jsonResponse({ success: true, message: \"Application submitted successfully\" });\r\n                } catch (error: any) {\r\n                    console.error(\"Error submitting application:\", error);\r\n                    return jsonResponse({ success: false, error: \"Failed to submit application\" }, 500);\r\n                }\r\n            }\r\n\r\n            // POST /api/v1/expert_documents/upload - Upload document (POML v1.0)\r\n            if (url.pathname === \"/api/v1/expert_documents/upload\" && request.method === \"POST\") {\r\n                const authHeader = request.headers.get(\"Authorization\");\r\n                if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const token = authHeader.substring(7);\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\");\r\n\r\n                if (!payload) {\r\n                    return jsonResponse({ success: false, error: \"Invalid or expired token\" }, 401);\r\n                }\r\n\r\n                if (!env.proveloce_db || !env.EXPERT_APPLICATION) {\r\n                    return jsonResponse({ success: false, error: \"Cloud resources not configured\" }, 500);\r\n                }\r\n\r\n                try {\r\n                    const formData = await request.formData();\r\n                    const file = formData.get(\"file\") as File;\r\n                    const documentType = formData.get(\"type\") as string || \"other\";\r\n\r\n                    if (!file) {\r\n                        return jsonResponse({ success: false, error: \"No file provided\" }, 400);\r\n                    }\r\n\r\n                    // 1. Upload to R2\r\n                    const r2Key = `docs/${payload.userId}/${crypto.randomUUID()}-${file.name.replace(/\\s+/g, '_')}`;\r\n                    await env.EXPERT_APPLICATION.put(r2Key, file.stream(), {\r\n                        httpMetadata: { contentType: file.type }\r\n                    });\r\n\r\n                    const r2Url = `https://backend.proveloce.com/api/attachments/${r2Key}`;\r\n\r\n                    // 2. Get application_id for this user\r\n                    const application = await env.proveloce_db.prepare(\r\n                        \"SELECT id FROM expert_applications WHERE user_id = ?\"\r\n                    ).bind(payload.userId).first() as any;\r\n\r\n                    if (!application) {\r\n                        return jsonResponse({ success: false, error: \"Expert application not found\" }, 404);\r\n                    }\r\n\r\n                    // 3. Save to expert_documents\r\n                    const docId = crypto.randomUUID();\r\n                    await env.proveloce_db.prepare(`\r\n                        INSERT INTO expert_documents (\r\n                            id, user_id, application_id, document_type, \r\n                            file_name, file_type, file_size, r2_object_key, r2_url\r\n                        ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)\r\n                    `).bind(\r\n                        docId, payload.userId, application.id, documentType,\r\n                        file.name, file.type, file.size, r2Key, r2Url\r\n                    ).run();\r\n\r\n                    return jsonResponse({\r\n                        success: true,\r\n                        message: \"Document uploaded successfully\",\r\n                        data: {\r\n                            id: docId,\r\n                            url: r2Url,\r\n                            fileName: file.name\r\n                        }\r\n                    });\r\n                } catch (error: any) {\r\n                    console.error(\"Error uploading document:\", error);\r\n                    return jsonResponse({ success: false, error: \"Failed to upload document\" }, 500);\r\n                }\r\n            }\r\n\r\n            // GET /api/applications - POML Expert Review v1.0: RBAC-filtered applications list\r\n            if (url.pathname === \"/api/applications\" && request.method === \"GET\") {\r\n                const authHeader = request.headers.get(\"Authorization\");\r\n                if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const token = authHeader.substring(7);\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\");\r\n\r\n                if (!payload) {\r\n                    return jsonResponse({ success: false, error: \"Invalid or expired token\" }, 401);\r\n                }\r\n\r\n                const role = (payload.role || \"\").toUpperCase();\r\n                const requesterOrgId = payload.org_id || 'ORG-DEFAULT';\r\n\r\n                if (!env.proveloce_db) return jsonResponse({ success: false, error: \"Database not configured\" }, 500);\r\n\r\n                // POML v1.0 RBAC:\r\n                // - Superadmin: view all applications\r\n                // - Admin: view all applications in their org\r\n                // - Expert: view ONLY submitted + validated applications (no drafts)\r\n                let whereClause = \"\";\r\n                let params: any[] = [];\r\n\r\n                if (role === \"SUPERADMIN\") {\r\n                    // Superadmin sees all\r\n                    whereClause = \"1=1\";\r\n                } else if (role === \"ADMIN\") {\r\n                    // Admin sees all in their org\r\n                    whereClause = \"org_id = ?\";\r\n                    params = [requesterOrgId];\r\n                } else if (role === \"EXPERT\") {\r\n                    // Expert ONLY sees submitted + validated applications (POML v1.0)\r\n                    whereClause = \"org_id = ? AND status = 'submitted' AND validated = 1\";\r\n                    params = [requesterOrgId];\r\n                } else {\r\n                    return jsonResponse({ success: false, error: \"Access denied\" }, 403);\r\n                }\r\n\r\n                // Optional status filter from query params\r\n                const statusFilter = url.searchParams.get(\"status\");\r\n                if (statusFilter && role !== \"EXPERT\") {\r\n                    whereClause += \" AND status = ?\";\r\n                    params.push(statusFilter);\r\n                }\r\n\r\n                try {\r\n                    const result = await env.proveloce_db.prepare(`\r\n                        SELECT ea.*, u.name as user_name, u.email as user_email\r\n                        FROM expert_applications ea\r\n                        LEFT JOIN users u ON ea.user_id = u.id\r\n                        WHERE ${whereClause}\r\n                        ORDER BY ea.created_at DESC\r\n                    `).bind(...params).all();\r\n\r\n                    return jsonResponse({\r\n                        success: true,\r\n                        data: { applications: result.results || [] }\r\n                    });\r\n                } catch (error: any) {\r\n                    console.error(\"Error fetching applications:\", error);\r\n                    return jsonResponse({ success: false, error: \"Failed to fetch applications\" }, 500);\r\n                }\r\n            }\r\n\r\n            // POST /api/v1/expert_applications/submit - Spec v2.0 Submission\r\n            if (url.pathname === \"/api/v1/expert_applications/submit\" && request.method === \"POST\") {\r\n                const authHeader = request.headers.get(\"Authorization\");\r\n                if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const token = authHeader.substring(7);\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\");\r\n\r\n                if (!payload || !payload.userId) {\r\n                    return jsonResponse({ success: false, error: \"Invalid or expired token\" }, 401);\r\n                }\r\n\r\n                if (!env.proveloce_db) return jsonResponse({ success: false, error: \"Database not configured\" }, 500);\r\n\r\n                try {\r\n                    const body = await request.json() as any;\r\n                    const { full_name, email, phone, address, expertise, experience, documents, images } = body;\r\n\r\n                    // Simplified storage as per Spec\r\n                    const id = crypto.randomUUID();\r\n                    const orgId = payload.org_id || 'ORG-DEFAULT';\r\n\r\n                    await env.proveloce_db.prepare(`\r\n                        INSERT INTO expert_applications (\r\n                            id, user_id, org_id, status, full_name, email, phone, summary_bio, \r\n                            skills, years_of_experience, documents, images, submitted_at, created_at, updated_at\r\n                        ) VALUES (?, ?, ?, 'pending', ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP)\r\n                    `).bind(\r\n                        id, payload.userId, orgId,\r\n                        full_name || '', email || '', phone || null, address || null,\r\n                        expertise || '', experience || 0,\r\n                        JSON.stringify(documents || []),\r\n                        JSON.stringify(images || [])\r\n                    ).run();\r\n\r\n                    // Notification\r\n                    await createNotification(\r\n                        env, payload.userId, 'INFO',\r\n                        'Application Submitted',\r\n                        'Your expert application has been submitted for review. We will notify you once a decision is made.',\r\n                        '/customer/expert-application'\r\n                    );\r\n\r\n                    return jsonResponse({ success: true, message: \"Application submitted successfully\", id });\r\n                } catch (error: any) {\r\n                    console.error(\"Error in v1 submit:\", error);\r\n                    return jsonResponse({ success: false, error: \"Failed to submit\" }, 500);\r\n                }\r\n            }\r\n\r\n            // POST /api/v1/expert_applications/:id/review - Spec v2.0 Unified Review\r\n            const reviewMatch = url.pathname.match(/^\\/api\\/v1\\/expert_applications\\/([^\\/]+)\\/review$/);\r\n            if (reviewMatch && request.method === \"POST\") {\r\n                const authHeader = request.headers.get(\"Authorization\");\r\n                if (!authHeader || !authHeader.startsWith(\"Bearer \")) return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n\r\n                const token = authHeader.substring(7);\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\");\r\n\r\n                if (!payload) return jsonResponse({ success: false, error: \"Invalid or expired token\" }, 401);\r\n\r\n                const role = (payload.role || \"\").toLowerCase();\r\n                const requesterOrgId = payload.org_id || 'ORG-DEFAULT';\r\n\r\n                if (role !== \"admin\" && role !== \"superadmin\") {\r\n                    return jsonResponse({ success: false, error: \"Access denied\" }, 403);\r\n                }\r\n\r\n                const applicationId = reviewMatch[1];\r\n\r\n                const body = await request.json() as any;\r\n                const decision = (body.decision || \"\").toLowerCase(); // \"approved\" or \"rejected\"\r\n                const reason = body.reason || \"\";\r\n\r\n                if (!['approved', 'rejected'].includes(decision)) {\r\n                    return jsonResponse({ success: false, error: \"Invalid decision. Must be 'approved' or 'rejected'.\" }, 400);\r\n                }\r\n\r\n                if (!env.proveloce_db) return jsonResponse({ success: false, error: \"Database not configured\" }, 500);\r\n\r\n                // Fetch app to check tenancy and get email for audit\r\n                const app = await env.proveloce_db.prepare(`\r\n                    SELECT ea.user_id, ea.org_id, ea.status, u.email as user_email \r\n                    FROM expert_applications ea \r\n                    JOIN users u ON ea.user_id = u.id \r\n                    WHERE ea.id = ?\r\n                `).bind(applicationId).first() as any;\r\n\r\n                if (!app) return jsonResponse({ success: false, error: \"Application not found\" }, 404);\r\n\r\n                if (role === 'admin' && app.org_id !== requesterOrgId) {\r\n                    return jsonResponse({ success: false, error: \"Tenant mismatch\" }, 403);\r\n                }\r\n\r\n                if (app.status.toLowerCase() !== 'pending' && role !== 'superadmin') {\r\n                    return jsonResponse({ success: false, error: \"Can only review pending applications\" }, 400);\r\n                }\r\n\r\n                const reviewerId = payload.userId;\r\n                const status = decision === 'approved' ? 'approved' : 'rejected';\r\n                const auditAction = decision === 'approved' ? 'APPROVE_EXPERT' : 'REJECT_EXPERT';\r\n\r\n                // Batch transaction for Atomicity\r\n                const statements = [\r\n                    // 1. Update application status\r\n                    env.proveloce_db.prepare(`\r\n                        UPDATE expert_applications \r\n                        SET status = ?, \r\n                            reviewed_by = ?, \r\n                            rejection_reason = ?,\r\n                            reviewed_at = CURRENT_TIMESTAMP, \r\n                            updated_at = CURRENT_TIMESTAMP \r\n                        WHERE id = ?\r\n                    `).bind(status, reviewerId, reason, applicationId),\r\n\r\n                    // 2. Audit Log (Spec: audit_logs table)\r\n                    env.proveloce_db.prepare(`\r\n                        INSERT INTO audit_logs (id, action, expert_id, expert_email, reason, performed_by, performed_at)\r\n                        VALUES (?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP)\r\n                    `).bind(crypto.randomUUID(), auditAction, applicationId, app.user_email, reason, reviewerId),\r\n\r\n                    // 3. Activity Log (Standard: activity_logs table for broad tracking)\r\n                    env.proveloce_db.prepare(`\r\n                        INSERT INTO activity_logs (id, user_id, action, entity_type, entity_id, metadata)\r\n                        VALUES (?, ?, ?, ?, ?, ?)\r\n                    `).bind(\r\n                        crypto.randomUUID(), reviewerId, \"EXPERT_APPLICATION_REVIEWED\", \"expert_application\", applicationId,\r\n                        JSON.stringify({ decision, reason, org_id: app.org_id, actor_id: reviewerId, actor_role: role, timestamp: new Date().toISOString() })\r\n                    )\r\n                ];\r\n\r\n                // If approved, update user role\r\n                if (decision === 'approved') {\r\n                    statements.push(\r\n                        env.proveloce_db.prepare(\r\n                            \"UPDATE users SET role = 'Expert', updated_at = CURRENT_TIMESTAMP WHERE id = ?\"\r\n                        ).bind(app.user_id)\r\n                    );\r\n                }\r\n\r\n                await env.proveloce_db.batch(statements);\r\n\r\n                // Notification to Applicant\r\n                if (decision === 'approved') {\r\n                    await createNotification(\r\n                        env, app.user_id, 'SUCCESS',\r\n                        'Application Approved! \uD83C\uDF89',\r\n                        'Congratulations! Your expert application has been approved. You now have access to expert features.',\r\n                        '/expert/dashboard'\r\n                    );\r\n                } else {\r\n                    await createNotification(\r\n                        env, app.user_id, 'WARNING',\r\n                        'Application Status Update',\r\n                        `Your expert application was reviewed and unfortunately was not approved at this time. Reason: ${reason || 'Please check with support for details.'}`,\r\n                        '/customer/expert-application'\r\n                    );\r\n                }\r\n\r\n                return jsonResponse({ success: true, message: `Application ${decision} successfully` });\r\n            }\r\n\r\n            // =====================================================\r\n            // Document Upload Routes (R2 Storage)\r\n            // =====================================================\r\n\r\n            // POST /api/documents/upload - Upload file to R2\r\n            if (url.pathname === \"/api/documents/upload\" && request.method === \"POST\") {\r\n                console.log(\"\uD83D\uDCC1 Document upload request received\");\r\n\r\n                const authHeader = request.headers.get(\"Authorization\");\r\n                if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const token = authHeader.substring(7);\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\");\r\n\r\n                if (!payload) {\r\n                    return jsonResponse({ success: false, error: \"Invalid or expired token\" }, 401);\r\n                }\r\n\r\n                // Check R2 bucket binding\r\n                if (!env.EXPERT_APPLICATION) {\r\n                    console.error(\"\u274C R2 bucket EXPERT_APPLICATION not bound\");\r\n                    return jsonResponse({ success: false, error: \"R2 storage not configured\" }, 500);\r\n                }\r\n\r\n                if (!env.proveloce_db) {\r\n                    return jsonResponse({ success: false, error: \"Database not configured\" }, 500);\r\n                }\r\n\r\n                try {\r\n                    // Parse multipart form data\r\n                    const formData = await request.formData();\r\n                    const file = formData.get(\"file\") as File | null;\r\n                    const documentType = formData.get(\"documentType\") as string || \"other\";\r\n\r\n                    if (!file) {\r\n                        return jsonResponse({ success: false, error: \"No file provided\" }, 400);\r\n                    }\r\n\r\n                    console.log(`\uD83D\uDCC4 Uploading file: ${file.name}, type: ${file.type}, size: ${file.size}`);\r\n\r\n                    // Validate file size (10MB max)\r\n                    const MAX_SIZE = 10 * 1024 * 1024;\r\n                    if (file.size > MAX_SIZE) {\r\n                        return jsonResponse({ success: false, error: \"File size exceeds 10MB limit\" }, 400);\r\n                    }\r\n\r\n                    // Validate file type\r\n                    const allowedTypes = [\r\n                        'image/jpeg', 'image/png', 'image/webp',\r\n                        'application/pdf',\r\n                        'application/msword',\r\n                        'application/vnd.openxmlformats-officedocument.wordprocessingml.document'\r\n                    ];\r\n                    if (!allowedTypes.includes(file.type)) {\r\n                        return jsonResponse({ success: false, error: `File type ${file.type} not allowed` }, 400);\r\n                    }\r\n\r\n                    // Generate unique object key\r\n                    const timestamp = Date.now();\r\n                    const sanitizedName = file.name.replace(/[^a-zA-Z0-9._-]/g, '_');\r\n                    const objectKey = `experts/${payload.userId}/${documentType}/${timestamp}_${sanitizedName}`;\r\n\r\n                    console.log(`\uD83D\uDD11 R2 Object Key: ${objectKey}`);\r\n\r\n                    // Upload to R2\r\n                    await env.EXPERT_APPLICATION.put(objectKey, file.stream(), {\r\n                        httpMetadata: {\r\n                            contentType: file.type,\r\n                        },\r\n                        customMetadata: {\r\n                            userId: payload.userId,\r\n                            documentType: documentType,\r\n                            originalName: file.name,\r\n                        },\r\n                    });\r\n\r\n                    console.log(`\u2705 File uploaded to R2: ${objectKey}`);\r\n\r\n                    // Get or create application_id for this user\r\n                    let applicationId: string | null = null;\r\n                    const existingApp = await env.proveloce_db.prepare(\r\n                        \"SELECT id FROM expert_applications WHERE user_id = ?\"\r\n                    ).bind(payload.userId).first() as any;\r\n\r\n                    if (existingApp) {\r\n                        applicationId = existingApp.id;\r\n                    }\r\n\r\n                    // Save metadata to D1 with application_id\r\n                    const docId = crypto.randomUUID();\r\n                    await env.proveloce_db.prepare(`\r\n                        INSERT INTO expert_documents (\r\n                            id, user_id, application_id, document_type, file_name, \r\n                            file_type, file_size, r2_object_key, \r\n                            review_status, application_status, uploaded_at, updated_at\r\n                        ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, 'pending', 'draft', datetime('now'), datetime('now'))\r\n                    `).bind(\r\n                        docId,\r\n                        payload.userId,\r\n                        applicationId,\r\n                        documentType,\r\n                        file.name,\r\n                        file.type,\r\n                        file.size,\r\n                        objectKey\r\n                    ).run();\r\n\r\n                    console.log(`\u2705 Document metadata saved to D1: ${docId}, linked to application: ${applicationId}`);\r\n\r\n                    return jsonResponse({\r\n                        success: true,\r\n                        message: \"File uploaded successfully\",\r\n                        data: {\r\n                            document: {\r\n                                id: docId,\r\n                                documentType,\r\n                                fileName: file.name,\r\n                                fileType: file.type,\r\n                                fileSize: file.size,\r\n                                reviewStatus: \"pending\",\r\n                            },\r\n                        },\r\n                    });\r\n                } catch (err: any) {\r\n                    console.error(\"\u274C Upload error:\", err);\r\n                    return jsonResponse({ success: false, error: err.message || \"Upload failed\" }, 500);\r\n                }\r\n            }\r\n\r\n            // GET /api/documents/my-documents - Get user's documents\r\n            if (url.pathname === \"/api/documents/my-documents\" && request.method === \"GET\") {\r\n                const authHeader = request.headers.get(\"Authorization\");\r\n                if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const token = authHeader.substring(7);\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\");\r\n\r\n                if (!payload) {\r\n                    return jsonResponse({ success: false, error: \"Invalid or expired token\" }, 401);\r\n                }\r\n\r\n                if (!env.proveloce_db) {\r\n                    return jsonResponse({ success: false, error: \"Database not configured\" }, 500);\r\n                }\r\n\r\n                const docs = await env.proveloce_db.prepare(`\r\n                    SELECT id, document_type, file_name, file_type, file_size, \r\n                           r2_object_key, review_status, application_status, uploaded_at\r\n                    FROM expert_documents \r\n                    WHERE user_id = ? \r\n                    ORDER BY uploaded_at DESC\r\n                `).bind(payload.userId).all();\r\n\r\n                return jsonResponse({\r\n                    success: true,\r\n                    data: {\r\n                        documents: docs.results,\r\n                        count: docs.results.length,\r\n                    },\r\n                });\r\n            }\r\n\r\n            // GET /api/documents/:id/url - Get signed URL for document\r\n            if (url.pathname.match(/^\\/api\\/documents\\/[^\\/]+\\/url$/) && request.method === \"GET\") {\r\n                const authHeader = request.headers.get(\"Authorization\");\r\n                if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const token = authHeader.substring(7);\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\");\r\n\r\n                if (!payload) {\r\n                    return jsonResponse({ success: false, error: \"Invalid or expired token\" }, 401);\r\n                }\r\n\r\n                const pathParts = url.pathname.split(\"/\");\r\n                const docId = pathParts[3];\r\n\r\n                if (!env.proveloce_db) {\r\n                    return jsonResponse({ success: false, error: \"Database not configured\" }, 500);\r\n                }\r\n\r\n                const doc = await env.proveloce_db.prepare(`\r\n                    SELECT id, user_id, document_type, file_name, file_type, r2_object_key\r\n                    FROM expert_documents \r\n                    WHERE id = ?\r\n                `).bind(docId).first() as any;\r\n\r\n                if (!doc) {\r\n                    return jsonResponse({ success: false, error: \"Document not found\" }, 404);\r\n                }\r\n\r\n                // Check access: user can only access their own documents\r\n                const role = (payload.role || \"\").toLowerCase();\r\n                if (doc.user_id !== payload.userId && role !== \"admin\" && role !== \"superadmin\") {\r\n                    return jsonResponse({ success: false, error: \"Access denied\" }, 403);\r\n                }\r\n\r\n                // Generate signed URL token (10 min expiry)\r\n                const expiresAt = Date.now() + (10 * 60 * 1000);\r\n                const signedPayload = {\r\n                    docId: doc.id,\r\n                    objectKey: doc.r2_object_key,\r\n                    expiresAt,\r\n                };\r\n                const signedToken = btoa(JSON.stringify(signedPayload));\r\n\r\n                return jsonResponse({\r\n                    success: true,\r\n                    data: {\r\n                        document: doc,\r\n                        url: `/api/documents/${doc.id}/stream?token=${signedToken}`,\r\n                        expiresIn: 600,\r\n                    },\r\n                });\r\n            }\r\n\r\n            // GET /api/documents/:id/stream - Stream document content\r\n            if (url.pathname.match(/^\\/api\\/documents\\/[^\\/]+\\/stream$/) && request.method === \"GET\") {\r\n                const signedToken = url.searchParams.get(\"token\");\r\n                if (!signedToken) {\r\n                    return jsonResponse({ success: false, error: \"Missing token\" }, 401);\r\n                }\r\n\r\n                try {\r\n                    const tokenData = JSON.parse(atob(signedToken));\r\n\r\n                    if (Date.now() > tokenData.expiresAt) {\r\n                        return jsonResponse({ success: false, error: \"Token expired\" }, 401);\r\n                    }\r\n\r\n                    if (!env.EXPERT_APPLICATION) {\r\n                        return jsonResponse({ success: false, error: \"R2 not configured\" }, 500);\r\n                    }\r\n\r\n                    const object = await env.EXPERT_APPLICATION.get(tokenData.objectKey);\r\n                    if (!object) {\r\n                        return jsonResponse({ success: false, error: \"File not found\" }, 404);\r\n                    }\r\n\r\n                    return new Response(object.body, {\r\n                        headers: {\r\n                            \"Content-Type\": object.httpMetadata?.contentType || \"application/octet-stream\",\r\n                            \"Content-Disposition\": `inline; filename=\"${tokenData.objectKey.split('/').pop()}\"`,\r\n                            ...corsHeaders,\r\n                        },\r\n                    });\r\n                } catch {\r\n                    return jsonResponse({ success: false, error: \"Invalid token\" }, 401);\r\n                }\r\n            }\r\n\r\n            // POST /api/documents/submit - Submit all draft documents\r\n            if (url.pathname === \"/api/documents/submit\" && request.method === \"POST\") {\r\n                const authHeader = request.headers.get(\"Authorization\");\r\n                if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const token = authHeader.substring(7);\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\");\r\n\r\n                if (!payload) {\r\n                    return jsonResponse({ success: false, error: \"Invalid or expired token\" }, 401);\r\n                }\r\n\r\n                if (!env.proveloce_db) {\r\n                    return jsonResponse({ success: false, error: \"Database not configured\" }, 500);\r\n                }\r\n\r\n                // Update all draft documents to submitted\r\n                const result = await env.proveloce_db.prepare(`\r\n                    UPDATE expert_documents \r\n                    SET application_status = 'submitted', updated_at = datetime('now')\r\n                    WHERE user_id = ? AND application_status = 'draft'\r\n                `).bind(payload.userId).run();\r\n\r\n                return jsonResponse({\r\n                    success: true,\r\n                    message: `${result.changes} document(s) submitted for review`,\r\n                    data: { submittedCount: result.changes },\r\n                });\r\n            }\r\n\r\n            // GET /api/admin/applications/:id/documents - Admin get documents for an application\r\n            if (url.pathname.match(/^\\/api\\/admin\\/applications\\/[^\\/]+\\/documents$/) && request.method === \"GET\") {\r\n                const authHeader = request.headers.get(\"Authorization\");\r\n                if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const token = authHeader.substring(7);\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\");\r\n\r\n                if (!payload) {\r\n                    return jsonResponse({ success: false, error: \"Invalid or expired token\" }, 401);\r\n                }\r\n\r\n                // Check admin role\r\n                const role = (payload.role || \"\").toLowerCase();\r\n                if (role !== \"admin\" && role !== \"superadmin\") {\r\n                    return jsonResponse({ success: false, error: \"Admin access required\" }, 403);\r\n                }\r\n\r\n                const pathParts = url.pathname.split(\"/\");\r\n                const applicationId = pathParts[4];\r\n\r\n                if (!env.proveloce_db) {\r\n                    return jsonResponse({ success: false, error: \"Database not configured\" }, 500);\r\n                }\r\n\r\n                // Get all documents for this application\r\n                const docs = await env.proveloce_db.prepare(`\r\n                    SELECT ed.*, ea.status as application_status_main, u.name as user_name, u.email as user_email\r\n                    FROM expert_documents ed\r\n                    LEFT JOIN expert_applications ea ON ed.application_id = ea.id\r\n                    LEFT JOIN users u ON ed.user_id = u.id\r\n                    WHERE ed.application_id = ?\r\n                    ORDER BY ed.uploaded_at DESC\r\n                `).bind(applicationId).all();\r\n\r\n                return jsonResponse({\r\n                    success: true,\r\n                    data: {\r\n                        documents: docs.results,\r\n                        count: docs.results.length,\r\n                    },\r\n                });\r\n            }\r\n\r\n            // GET /api/admin/documents - Admin get all documents with application info\r\n            if (url.pathname === \"/api/admin/documents\" && request.method === \"GET\") {\r\n                const authHeader = request.headers.get(\"Authorization\");\r\n                if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const token = authHeader.substring(7);\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\");\r\n\r\n                if (!payload) {\r\n                    return jsonResponse({ success: false, error: \"Invalid or expired token\" }, 401);\r\n                }\r\n\r\n                // Check admin role\r\n                const role = (payload.role || \"\").toLowerCase();\r\n                if (role !== \"admin\" && role !== \"superadmin\") {\r\n                    return jsonResponse({ success: false, error: \"Admin access required\" }, 403);\r\n                }\r\n\r\n                if (!env.proveloce_db) {\r\n                    return jsonResponse({ success: false, error: \"Database not configured\" }, 500);\r\n                }\r\n\r\n                // Get filter from query params\r\n                const status = url.searchParams.get(\"status\") || \"\";\r\n\r\n                let query = `\r\n                    SELECT ed.*, ea.status as app_status, u.name as user_name, u.email as user_email\r\n                    FROM expert_documents ed\r\n                    LEFT JOIN expert_applications ea ON ed.application_id = ea.id\r\n                    LEFT JOIN users u ON ed.user_id = u.id\r\n                `;\r\n\r\n                if (status) {\r\n                    query += ` WHERE ea.status = '${status}'`;\r\n                }\r\n\r\n                query += ` ORDER BY ed.uploaded_at DESC LIMIT 100`;\r\n\r\n                const docs = await env.proveloce_db.prepare(query).all();\r\n\r\n                return jsonResponse({\r\n                    success: true,\r\n                    data: {\r\n                        documents: docs.results,\r\n                        count: docs.results.length,\r\n                    },\r\n                });\r\n            }\r\n\r\n            // DELETE /api/documents/:id - Delete document from R2 and D1 (atomic)\r\n            if (url.pathname.match(/^\\/api\\/documents\\/[^\\/]+$/) && request.method === \"DELETE\") {\r\n                const authHeader = request.headers.get(\"Authorization\");\r\n                if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const token = authHeader.substring(7);\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\");\r\n\r\n                if (!payload) {\r\n                    return jsonResponse({ success: false, error: \"Invalid or expired token\" }, 401);\r\n                }\r\n\r\n                const pathParts = url.pathname.split(\"/\");\r\n                const documentId = pathParts[3];\r\n\r\n                if (!env.proveloce_db || !env.EXPERT_APPLICATION) {\r\n                    return jsonResponse({ success: false, error: \"Storage not configured\" }, 500);\r\n                }\r\n\r\n                try {\r\n                    // 1. First lookup the document to get R2 key and verify ownership\r\n                    const doc = await env.proveloce_db.prepare(`\r\n                        SELECT id, user_id, r2_object_key, file_name, document_type\r\n                        FROM expert_documents\r\n                        WHERE id = ?\r\n                    `).bind(documentId).first() as any;\r\n\r\n                    if (!doc) {\r\n                        return jsonResponse({ success: false, error: \"Document not found\" }, 404);\r\n                    }\r\n\r\n                    // Check access: user can only delete their own documents unless admin\r\n                    const role = (payload.role || \"\").toLowerCase();\r\n                    if (doc.user_id !== payload.userId && role !== \"admin\" && role !== \"superadmin\") {\r\n                        return jsonResponse({ success: false, error: \"Access denied\" }, 403);\r\n                    }\r\n\r\n                    // 2. Delete from R2 FIRST (before database)\r\n                    const r2Key = doc.r2_object_key;\r\n                    console.log(`\uD83D\uDDD1\uFE0F Deleting from R2: ${r2Key}`);\r\n\r\n                    try {\r\n                        await env.EXPERT_APPLICATION.delete(r2Key);\r\n                        console.log(`\u2705 R2 deletion successful: ${r2Key}`);\r\n                    } catch (r2Error: any) {\r\n                        console.error(`\u274C R2 deletion failed: ${r2Error.message}`);\r\n                        return jsonResponse({\r\n                            success: false,\r\n                            error: \"Failed to delete file from storage\"\r\n                        }, 500);\r\n                    }\r\n\r\n                    // 3. After R2 success, delete from D1\r\n                    console.log(`\uD83D\uDDD1\uFE0F Deleting from D1: ${documentId}`);\r\n                    await env.proveloce_db.prepare(`\r\n                        DELETE FROM expert_documents WHERE id = ?\r\n                    `).bind(documentId).run();\r\n                    console.log(`\u2705 D1 deletion successful: ${documentId}`);\r\n\r\n                    // 4. Log the deletion for audit trail\r\n                    console.log(`\uD83D\uDCCB AUDIT: User ${payload.userId} (${role}) deleted document ${documentId} (${doc.file_name}) with R2 key ${r2Key}`);\r\n\r\n                    return jsonResponse({\r\n                        success: true,\r\n                        message: \"Document deleted successfully\",\r\n                        data: {\r\n                            deletedId: documentId,\r\n                            deletedFile: doc.file_name,\r\n                            deletedBy: payload.userId,\r\n                            deletedAt: new Date().toISOString(),\r\n                        },\r\n                    });\r\n                } catch (error: any) {\r\n                    console.error(\"\u274C Document deletion error:\", error);\r\n                    return jsonResponse({\r\n                        success: false,\r\n                        error: error.message || \"Failed to delete document\"\r\n                    }, 500);\r\n                }\r\n            }\r\n\r\n            // =====================================================\r\n            // TASK MANAGEMENT APIs (Admin/SuperAdmin)\r\n            // =====================================================\r\n\r\n            // POST /api/tasks - Create task and optionally assign to experts\r\n            if (url.pathname === \"/api/tasks\" && request.method === \"POST\") {\r\n                const authHeader = request.headers.get(\"Authorization\") || \"\";\r\n                const token = authHeader.replace(\"Bearer \", \"\");\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\") as { userId: string; role?: string } | null;\r\n                if (!payload) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                // Only Admin or SuperAdmin can create tasks\r\n                const user = await env.proveloce_db.prepare(\r\n                    \"SELECT role FROM users WHERE id = ?\"\r\n                ).bind(payload.userId).first() as any;\r\n\r\n                const role = user?.role?.toLowerCase() || '';\r\n                if (role !== 'admin' && role !== 'superadmin') {\r\n                    return jsonResponse({ success: false, error: \"Only Admin or SuperAdmin can create tasks\" }, 403);\r\n                }\r\n\r\n                try {\r\n                    const body = await request.json() as any;\r\n                    const { title, description, domain, deadline, price_budget, priority, expert_ids } = body;\r\n\r\n                    if (!title) {\r\n                        return jsonResponse({ success: false, error: \"Title is required\" }, 400);\r\n                    }\r\n\r\n                    const taskId = crypto.randomUUID();\r\n\r\n                    // Create the task\r\n                    await env.proveloce_db.prepare(`\r\n                        INSERT INTO tasks (id, title, description, domain, deadline, price_budget, priority, status, admin_id, created_by_id, created_at, updated_at)\r\n                        VALUES (?, ?, ?, ?, ?, ?, ?, 'PENDING', ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP)\r\n                    `).bind(\r\n                        taskId,\r\n                        title,\r\n                        description || null,\r\n                        domain || null,\r\n                        deadline || null,\r\n                        price_budget || null,\r\n                        priority || 'MEDIUM',\r\n                        payload.userId,\r\n                        payload.userId\r\n                    ).run();\r\n\r\n                    // If expert_ids provided, create expert_tasks assignments\r\n                    let assignedCount = 0;\r\n                    if (expert_ids && Array.isArray(expert_ids) && expert_ids.length > 0) {\r\n                        for (const expertId of expert_ids) {\r\n                            try {\r\n                                await env.proveloce_db.prepare(`\r\n                                    INSERT INTO expert_tasks (id, task_id, expert_id, admin_id, status, created_at, updated_at)\r\n                                    VALUES (?, ?, ?, ?, 'PENDING', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP)\r\n                                `).bind(crypto.randomUUID(), taskId, expertId, payload.userId).run();\r\n                                assignedCount++;\r\n                            } catch (e) {\r\n                                console.error(\"Failed to assign expert:\", expertId, e);\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    return jsonResponse({\r\n                        success: true,\r\n                        message: \"Task created successfully\",\r\n                        data: { taskId, assignedCount }\r\n                    });\r\n                } catch (error: any) {\r\n                    console.error(\"Task creation error:\", error);\r\n                    return jsonResponse({ success: false, error: error.message || \"Failed to create task\" }, 500);\r\n                }\r\n            }\r\n\r\n            // GET /api/tasks - Get tasks (role-filtered)\r\n            if (url.pathname === \"/api/tasks\" && request.method === \"GET\") {\r\n                const authHeader = request.headers.get(\"Authorization\") || \"\";\r\n                const token = authHeader.replace(\"Bearer \", \"\");\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\") as { userId: string; role?: string } | null;\r\n                if (!payload) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const user = await env.proveloce_db.prepare(\r\n                    \"SELECT role FROM users WHERE id = ?\"\r\n                ).bind(payload.userId).first() as any;\r\n\r\n                const role = user?.role?.toLowerCase() || '';\r\n                let tasks: any[] = [];\r\n\r\n                if (role === 'superadmin') {\r\n                    // SuperAdmin sees all tasks\r\n                    const result = await env.proveloce_db.prepare(`\r\n                        SELECT t.*, u.name as admin_name,\r\n                            (SELECT COUNT(*) FROM expert_tasks WHERE task_id = t.id) as assigned_count\r\n                        FROM tasks t\r\n                        LEFT JOIN users u ON t.admin_id = u.id\r\n                        ORDER BY t.created_at DESC\r\n                    `).all();\r\n                    tasks = result.results || [];\r\n                } else if (role === 'admin') {\r\n                    // Admin sees tasks they created\r\n                    const result = await env.proveloce_db.prepare(`\r\n                        SELECT t.*, u.name as admin_name,\r\n                            (SELECT COUNT(*) FROM expert_tasks WHERE task_id = t.id) as assigned_count\r\n                        FROM tasks t\r\n                        LEFT JOIN users u ON t.admin_id = u.id\r\n                        WHERE t.admin_id = ?\r\n                        ORDER BY t.created_at DESC\r\n                    `).bind(payload.userId).all();\r\n                    tasks = result.results || [];\r\n                } else if (role === 'expert') {\r\n                    // Expert sees tasks assigned to them\r\n                    const result = await env.proveloce_db.prepare(`\r\n                        SELECT t.*, et.status as assignment_status, et.id as assignment_id\r\n                        FROM tasks t\r\n                        JOIN expert_tasks et ON et.task_id = t.id\r\n                        WHERE et.expert_id = ?\r\n                        ORDER BY t.created_at DESC\r\n                    `).bind(payload.userId).all();\r\n                    tasks = result.results || [];\r\n                }\r\n\r\n                return jsonResponse({\r\n                    success: true,\r\n                    data: { tasks }\r\n                });\r\n            }\r\n\r\n            // POST /api/tasks/:id/assign - Assign task to experts\r\n            if (url.pathname.match(/^\\/api\\/tasks\\/[^\\/]+\\/assign$/) && request.method === \"POST\") {\r\n                const authHeader = request.headers.get(\"Authorization\") || \"\";\r\n                const token = authHeader.replace(\"Bearer \", \"\");\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\") as { userId: string; role?: string } | null;\r\n                if (!payload) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const user = await env.proveloce_db.prepare(\r\n                    \"SELECT role FROM users WHERE id = ?\"\r\n                ).bind(payload.userId).first() as any;\r\n\r\n                const role = user?.role?.toLowerCase() || '';\r\n                if (role !== 'admin' && role !== 'superadmin') {\r\n                    return jsonResponse({ success: false, error: \"Only Admin or SuperAdmin can assign tasks\" }, 403);\r\n                }\r\n\r\n                const taskId = url.pathname.split('/')[3];\r\n                const body = await request.json() as any;\r\n                const { expert_ids } = body;\r\n\r\n                if (!expert_ids || !Array.isArray(expert_ids) || expert_ids.length === 0) {\r\n                    return jsonResponse({ success: false, error: \"expert_ids array is required\" }, 400);\r\n                }\r\n\r\n                let assignedCount = 0;\r\n                for (const expertId of expert_ids) {\r\n                    try {\r\n                        await env.proveloce_db.prepare(`\r\n                            INSERT OR IGNORE INTO expert_tasks (id, task_id, expert_id, admin_id, status, created_at, updated_at)\r\n                            VALUES (?, ?, ?, ?, 'PENDING', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP)\r\n                        `).bind(crypto.randomUUID(), taskId, expertId, payload.userId).run();\r\n                        assignedCount++;\r\n                    } catch (e) {\r\n                        console.error(\"Failed to assign expert:\", expertId, e);\r\n                    }\r\n                }\r\n\r\n                return jsonResponse({\r\n                    success: true,\r\n                    message: `Task assigned to ${assignedCount} experts`,\r\n                    data: { taskId, assignedCount }\r\n                });\r\n            }\r\n\r\n            // POST /api/expert/tasks/:id/accept - Expert accepts task\r\n            if (url.pathname.match(/^\\/api\\/expert\\/tasks\\/[^\\/]+\\/accept$/) && request.method === \"POST\") {\r\n                const authHeader = request.headers.get(\"Authorization\") || \"\";\r\n                const token = authHeader.replace(\"Bearer \", \"\");\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\") as { userId: string } | null;\r\n                if (!payload) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const taskId = url.pathname.split('/')[4];\r\n\r\n                await env.proveloce_db.prepare(`\r\n                    UPDATE expert_tasks SET status = 'ACCEPTED', updated_at = CURRENT_TIMESTAMP\r\n                    WHERE task_id = ? AND expert_id = ? AND status = 'PENDING'\r\n                `).bind(taskId, payload.userId).run();\r\n\r\n                return jsonResponse({ success: true, message: \"Task accepted\" });\r\n            }\r\n\r\n            // POST /api/expert/tasks/:id/decline - Expert declines task\r\n            if (url.pathname.match(/^\\/api\\/expert\\/tasks\\/[^\\/]+\\/decline$/) && request.method === \"POST\") {\r\n                const authHeader = request.headers.get(\"Authorization\") || \"\";\r\n                const token = authHeader.replace(\"Bearer \", \"\");\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\") as { userId: string } | null;\r\n                if (!payload) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const taskId = url.pathname.split('/')[4];\r\n\r\n                await env.proveloce_db.prepare(`\r\n                    UPDATE expert_tasks SET status = 'DECLINED', updated_at = CURRENT_TIMESTAMP\r\n                    WHERE task_id = ? AND expert_id = ?\r\n                `).bind(taskId, payload.userId).run();\r\n\r\n                return jsonResponse({ success: true, message: \"Task declined\" });\r\n            }\r\n\r\n            // POST /api/expert/tasks/:id/complete - Expert marks task complete\r\n            if (url.pathname.match(/^\\/api\\/expert\\/tasks\\/[^\\/]+\\/complete$/) && request.method === \"POST\") {\r\n                const authHeader = request.headers.get(\"Authorization\") || \"\";\r\n                const token = authHeader.replace(\"Bearer \", \"\");\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\") as { userId: string } | null;\r\n                if (!payload) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const taskId = url.pathname.split('/')[4];\r\n\r\n                await env.proveloce_db.prepare(`\r\n                    UPDATE expert_tasks SET status = 'COMPLETED', updated_at = CURRENT_TIMESTAMP\r\n                    WHERE task_id = ? AND expert_id = ? AND status IN ('ACCEPTED', 'IN_PROGRESS')\r\n                `).bind(taskId, payload.userId).run();\r\n\r\n                return jsonResponse({ success: true, message: \"Task marked as completed\" });\r\n            }\r\n\r\n            // GET /api/experts - Get list of experts for assignment (Admin/SuperAdmin)\r\n            if (url.pathname === \"/api/experts\" && request.method === \"GET\") {\r\n                const authHeader = request.headers.get(\"Authorization\") || \"\";\r\n                const token = authHeader.replace(\"Bearer \", \"\");\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\") as { userId: string } | null;\r\n                if (!payload) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const user = await env.proveloce_db.prepare(\r\n                    \"SELECT role FROM users WHERE id = ?\"\r\n                ).bind(payload.userId).first() as any;\r\n\r\n                const role = user?.role?.toLowerCase() || '';\r\n                if (role !== 'admin' && role !== 'superadmin') {\r\n                    return jsonResponse({ success: false, error: \"Only Admin or SuperAdmin can view experts list\" }, 403);\r\n                }\r\n\r\n                // Get query params for filtering\r\n                const domain = url.searchParams.get('domain');\r\n                const skill = url.searchParams.get('skill');\r\n                const verified = url.searchParams.get('verified');\r\n\r\n                let query = `\r\n                    SELECT id, name, email, location, verified, rating, skills, domains, availability\r\n                    FROM users WHERE role = 'expert'\r\n                `;\r\n                const params: any[] = [];\r\n\r\n                if (verified === 'true') {\r\n                    query += ` AND verified = 1`;\r\n                }\r\n\r\n                query += ` ORDER BY rating DESC NULLS LAST, name ASC`;\r\n\r\n                const result = await env.proveloce_db.prepare(query).all();\r\n\r\n                // Filter by domain/skill in JS (since they're JSON arrays)\r\n                let experts = (result.results || []) as any[];\r\n\r\n                if (domain) {\r\n                    experts = experts.filter(e => {\r\n                        try {\r\n                            const domains = JSON.parse(e.domains || '[]');\r\n                            return domains.includes(domain);\r\n                        } catch { return false; }\r\n                    });\r\n                }\r\n\r\n                if (skill) {\r\n                    experts = experts.filter(e => {\r\n                        try {\r\n                            const skills = JSON.parse(e.skills || '[]');\r\n                            return skills.includes(skill);\r\n                        } catch { return false; }\r\n                    });\r\n                }\r\n\r\n                return jsonResponse({\r\n                    success: true,\r\n                    data: { experts }\r\n                });\r\n            }\r\n\r\n            // =====================================================\r\n            // EXPERT PORTAL APIs\r\n            // =====================================================\r\n\r\n            // GET /api/expert/dashboard - Expert dashboard stats\r\n            if (url.pathname === \"/api/expert/dashboard\" && request.method === \"GET\") {\r\n                const authHeader = request.headers.get(\"Authorization\") || \"\";\r\n                const token = authHeader.replace(\"Bearer \", \"\");\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\") as { userId: string; role?: string } | null;\r\n                if (!payload) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                // Check if user is an expert\r\n                const user = await env.proveloce_db.prepare(\r\n                    \"SELECT role FROM users WHERE id = ?\"\r\n                ).bind(payload.userId).first() as any;\r\n\r\n                if (!user || user.role?.toLowerCase() !== 'expert') {\r\n                    return jsonResponse({ success: false, error: \"Expert access required\" }, 403);\r\n                }\r\n\r\n                // Get task stats\r\n                const activeTasks = await env.proveloce_db.prepare(\r\n                    \"SELECT COUNT(*) as count FROM tasks WHERE assigned_to_id = ? AND status = 'active'\"\r\n                ).bind(payload.userId).first() as any;\r\n\r\n                const completedTasks = await env.proveloce_db.prepare(\r\n                    \"SELECT COUNT(*) as count FROM tasks WHERE assigned_to_id = ? AND status = 'completed'\"\r\n                ).bind(payload.userId).first() as any;\r\n\r\n                const pendingTasks = await env.proveloce_db.prepare(\r\n                    \"SELECT COUNT(*) as count FROM tasks WHERE assigned_to_id = ? AND status = 'pending'\"\r\n                ).bind(payload.userId).first() as any;\r\n\r\n                // Get earnings\r\n                const earnings = await env.proveloce_db.prepare(\r\n                    \"SELECT COALESCE(SUM(net_amount), 0) as total FROM expert_earnings WHERE expert_id = ? AND payment_status = 'paid'\"\r\n                ).bind(payload.userId).first() as any;\r\n\r\n                return jsonResponse({\r\n                    success: true,\r\n                    data: {\r\n                        stats: {\r\n                            activeTasks: activeTasks?.count || 0,\r\n                            completedTasks: completedTasks?.count || 0,\r\n                            pendingTasks: pendingTasks?.count || 0,\r\n                            totalEarnings: earnings?.total || 0,\r\n                        },\r\n                        recentActivity: [],\r\n                    }\r\n                });\r\n            }\r\n\r\n            // GET /api/expert/certifications - Get expert's certifications\r\n            if (url.pathname === \"/api/expert/certifications\" && request.method === \"GET\") {\r\n                const authHeader = request.headers.get(\"Authorization\") || \"\";\r\n                const token = authHeader.replace(\"Bearer \", \"\");\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\") as { userId: string } | null;\r\n                if (!payload) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const result = await env.proveloce_db.prepare(`\r\n                    SELECT id, title, issuer, credential_id, credential_url, \r\n                           issue_date, expiry_date, file_name, file_url, created_at\r\n                    FROM expert_certifications \r\n                    WHERE expert_id = ?\r\n                    ORDER BY created_at DESC\r\n                `).bind(payload.userId).all();\r\n\r\n                return jsonResponse({\r\n                    success: true,\r\n                    data: { certifications: result.results || [] }\r\n                });\r\n            }\r\n\r\n            // GET /api/expert/portfolio - Get expert's portfolio items\r\n            if (url.pathname === \"/api/expert/portfolio\" && request.method === \"GET\") {\r\n                const authHeader = request.headers.get(\"Authorization\") || \"\";\r\n                const token = authHeader.replace(\"Bearer \", \"\");\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\") as { userId: string } | null;\r\n                if (!payload) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const result = await env.proveloce_db.prepare(`\r\n                    SELECT id, title, description, skills, project_url, created_at\r\n                    FROM expert_portfolio \r\n                    WHERE expert_id = ?\r\n                    ORDER BY created_at DESC\r\n                `).bind(payload.userId).all();\r\n\r\n                // Get files for each portfolio item\r\n                const portfolioItems: any[] = [];\r\n                for (const item of (result.results || []) as any[]) {\r\n                    const files = await env.proveloce_db.prepare(`\r\n                        SELECT id, file_name, file_type, file_url\r\n                        FROM expert_portfolio_files \r\n                        WHERE portfolio_id = ?\r\n                    `).bind(item.id).all();\r\n                    portfolioItems.push({\r\n                        ...item,\r\n                        skills: item.skills ? JSON.parse(item.skills) : [],\r\n                        files: files.results || [],\r\n                    });\r\n                }\r\n\r\n                return jsonResponse({\r\n                    success: true,\r\n                    data: { portfolio: portfolioItems }\r\n                });\r\n            }\r\n\r\n            // GET /api/expert/tasks - Get expert's assigned tasks\r\n            if (url.pathname === \"/api/expert/tasks\" && request.method === \"GET\") {\r\n                const authHeader = request.headers.get(\"Authorization\") || \"\";\r\n                const token = authHeader.replace(\"Bearer \", \"\");\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\") as { userId: string } | null;\r\n                if (!payload) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const result = await env.proveloce_db.prepare(`\r\n                    SELECT t.id, t.title, t.description, t.deadline, t.status, t.priority, t.created_at,\r\n                           u.name as customer_name\r\n                    FROM tasks t\r\n                    LEFT JOIN users u ON t.created_by_id = u.id\r\n                    WHERE t.assigned_to_id = ?\r\n                    ORDER BY t.created_at DESC\r\n                `).bind(payload.userId).all();\r\n\r\n                return jsonResponse({\r\n                    success: true,\r\n                    data: { tasks: result.results || [] }\r\n                });\r\n            }\r\n\r\n            // GET /api/expert/earnings - Get expert's earnings history\r\n            if (url.pathname === \"/api/expert/earnings\" && request.method === \"GET\") {\r\n                const authHeader = request.headers.get(\"Authorization\") || \"\";\r\n                const token = authHeader.replace(\"Bearer \", \"\");\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\") as { userId: string } | null;\r\n                if (!payload) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const result = await env.proveloce_db.prepare(`\r\n                    SELECT e.id, e.amount, e.platform_fee, e.net_amount, e.payment_status, \r\n                           e.payout_reference, e.payout_date, e.created_at,\r\n                           t.title as task_title\r\n                    FROM expert_earnings e\r\n                    LEFT JOIN tasks t ON e.task_id = t.id\r\n                    WHERE e.expert_id = ?\r\n                    ORDER BY e.created_at DESC\r\n                `).bind(payload.userId).all();\r\n\r\n                // Calculate totals\r\n                const totals = await env.proveloce_db.prepare(`\r\n                    SELECT \r\n                        COALESCE(SUM(CASE WHEN payment_status = 'paid' THEN net_amount ELSE 0 END), 0) as total_paid,\r\n                        COALESCE(SUM(CASE WHEN payment_status = 'pending' THEN net_amount ELSE 0 END), 0) as pending\r\n                    FROM expert_earnings WHERE expert_id = ?\r\n                `).bind(payload.userId).first() as any;\r\n\r\n                return jsonResponse({\r\n                    success: true,\r\n                    data: {\r\n                        earnings: result.results || [],\r\n                        summary: {\r\n                            totalPaid: totals?.total_paid || 0,\r\n                            pending: totals?.pending || 0,\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n\r\n            // GET /api/expert/helpdesk - Get expert's support tickets\r\n            if (url.pathname === \"/api/expert/helpdesk\" && request.method === \"GET\") {\r\n                const authHeader = request.headers.get(\"Authorization\") || \"\";\r\n                const token = authHeader.replace(\"Bearer \", \"\");\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\") as { userId: string } | null;\r\n                if (!payload) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const result = await env.proveloce_db.prepare(`\r\n                    SELECT id, subject, description, status, category, priority, created_at, resolved_at\r\n                    FROM tickets \r\n                    WHERE user_id = ?\r\n                    ORDER BY created_at DESC\r\n                `).bind(payload.userId).all();\r\n\r\n                return jsonResponse({\r\n                    success: true,\r\n                    data: { tickets: result.results || [] }\r\n                });\r\n            }\r\n\r\n            // GET /api/expert/notifications - Get expert's notifications\r\n            if (url.pathname === \"/api/expert/notifications\" && request.method === \"GET\") {\r\n                const authHeader = request.headers.get(\"Authorization\") || \"\";\r\n                const token = authHeader.replace(\"Bearer \", \"\");\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\") as { userId: string } | null;\r\n                if (!payload) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const result = await env.proveloce_db.prepare(`\r\n                    SELECT id, title, message, type, is_read, link, created_at\r\n                    FROM notifications \r\n                    WHERE user_id = ?\r\n                    ORDER BY created_at DESC\r\n                    LIMIT 50\r\n                `).bind(payload.userId).all();\r\n\r\n                return jsonResponse({\r\n                    success: true,\r\n                    data: { notifications: result.results || [] }\r\n                });\r\n            }\r\n\r\n            // =====================================================\r\n            // HELPDESK APIs (Role-based ticket routing)\r\n            // =====================================================\r\n\r\n            // POST /api/helpdesk/tickets - Create a new helpdesk ticket (Enterprise v2.0)\r\n            if (url.pathname === \"/api/helpdesk/tickets\" && request.method === \"POST\") {\r\n                const authHeader = request.headers.get(\"Authorization\") || \"\";\r\n                const token = authHeader.replace(\"Bearer \", \"\");\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\") as { userId: string } | null;\r\n                if (!payload) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                // Get sender info including phone\r\n                const sender = await env.proveloce_db.prepare(\r\n                    \"SELECT id, role, name, email, phone FROM users WHERE id = ?\"\r\n                ).bind(payload.userId).first() as any;\r\n\r\n                const senderRole = sender?.role?.toUpperCase() || 'CUSTOMER';\r\n\r\n                try {\r\n                    // Parse request - support both JSON and FormData\r\n                    let category: string = '';\r\n                    let subject: string = '';\r\n                    let description: string = '';\r\n                    let attachmentFiles: File[] = [];\r\n\r\n                    const contentType = request.headers.get('Content-Type') || '';\r\n                    if (contentType.includes('multipart/form-data')) {\r\n                        const formData = await request.formData();\r\n                        category = formData.get('category') as string || '';\r\n                        subject = formData.get('subject') as string || '';\r\n                        description = formData.get('description') as string || '';\r\n\r\n                        // Support multiple files with names 'attachments' or 'attachment'\r\n                        const files = formData.getAll('attachments');\r\n                        const singleFile = formData.get('attachment');\r\n\r\n                        if (files.length > 0) {\r\n                            attachmentFiles = files.filter(f => f instanceof File && f.size > 0) as File[];\r\n                        } else if (singleFile && singleFile instanceof File && singleFile.size > 0) {\r\n                            attachmentFiles = [singleFile];\r\n                        }\r\n                    } else {\r\n                        const body = await request.json() as any;\r\n                        category = body.category || '';\r\n                        subject = body.subject || '';\r\n                        description = body.description || '';\r\n                    }\r\n\r\n                    // Strict Validation - Mandatory fields (no priority)\r\n                    const missingFields: string[] = [];\r\n                    if (!subject?.trim()) missingFields.push('subject');\r\n                    else if (subject.length > 150) {\r\n                        return jsonResponse({ success: false, error: \"VALIDATION_ERROR\", message: \"Subject must be 150 characters or less\" }, 400);\r\n                    }\r\n\r\n                    if (!category?.trim()) missingFields.push('category');\r\n                    else if (category.length > 100) {\r\n                        return jsonResponse({ success: false, error: \"VALIDATION_ERROR\", message: \"Category must be 100 characters or less\" }, 400);\r\n                    }\r\n\r\n                    if (!description?.trim()) missingFields.push('description');\r\n                    if (description?.length > 5000) {\r\n                        return jsonResponse({ success: false, error: \"VALIDATION_ERROR\", message: \"Description must be 5000 characters or less\" }, 400);\r\n                    }\r\n\r\n                    if (missingFields.length > 0) {\r\n                        return jsonResponse({\r\n                            success: false,\r\n                            error: \"VALIDATION_ERROR\",\r\n                            message: `Missing required fields: ${missingFields.join(', ')}`,\r\n                            fields: missingFields\r\n                        }, 400);\r\n                    }\r\n\r\n                    // Generate unique ticket ID: PV-TK-YYYYMMDD-HHMM\r\n                    const now = new Date();\r\n                    const yyyymmdd = now.getUTCFullYear() +\r\n                        String(now.getUTCMonth() + 1).padStart(2, '0') +\r\n                        String(now.getUTCDate()).padStart(2, '0');\r\n                    const hhmm = String(now.getUTCHours()).padStart(2, '0') +\r\n                        String(now.getUTCMinutes()).padStart(2, '0');\r\n                    const ticketNumber = `PV-TK-${yyyymmdd}-${hhmm}`;\r\n\r\n                    // Insert into tickets table using Unified Spec v3.0\r\n                    const initialMessage = {\r\n                        sender_id: payload.userId,\r\n                        sender_name: sender?.name || 'User',\r\n                        sender_role: senderRole,\r\n                        text: description.trim(),\r\n                        timestamp: new Date().toISOString()\r\n                    };\r\n\r\n                    const result = await env.proveloce_db.prepare(`\r\n                        INSERT INTO tickets (\r\n                            ticket_number, category, subject, description, \r\n                            raised_by_user_id, org_id, messages, status, created_at, updated_at\r\n                        )\r\n                        VALUES (?, ?, ?, ?, ?, ?, ?, 'Open', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP)\r\n                    `).bind(\r\n                        ticketNumber,\r\n                        category.trim(),\r\n                        subject.trim(),\r\n                        description.trim(),\r\n                        payload.userId,\r\n                        sender.org_id || 'ORG-DEFAULT',\r\n                        JSON.stringify([initialMessage])\r\n                    ).run();\r\n\r\n                    const ticketDbId = result.meta.last_row_id;\r\n                    const fileAttachments: any[] = [];\r\n\r\n                    // Handle multiple file attachments to R2\r\n                    if (attachmentFiles.length > 0 && env.others) {\r\n                        for (const file of attachmentFiles) {\r\n                            const fileId = crypto.randomUUID();\r\n                            const fileExt = file.name.split('.').pop() || 'bin';\r\n                            const filePath = `helpdesk/${ticketNumber}/${fileId}.${fileExt}`;\r\n\r\n                            await env.others.put(filePath, file.stream(), {\r\n                                httpMetadata: { contentType: file.type || 'application/octet-stream' }\r\n                            });\r\n\r\n                            const attachmentUrl = `/api/helpdesk/attachments/${filePath}`;\r\n\r\n                            // Create FileReference in ticket_files\r\n                            await env.proveloce_db.prepare(`\r\n                                INSERT INTO ticket_files (id, ticket_id, filename, filetype, bucket, uploaded_at)\r\n                                VALUES (?, ?, ?, ?, 'others', CURRENT_TIMESTAMP)\r\n                            `).bind(fileId, ticketDbId, file.name, file.type).run();\r\n\r\n                            fileAttachments.push({\r\n                                id: fileId,\r\n                                filename: file.name,\r\n                                url: attachmentUrl\r\n                            });\r\n                        }\r\n                    }\r\n\r\n                    return jsonResponse({\r\n                        success: true,\r\n                        message: `Your ticket ${ticketNumber} has been created successfully`,\r\n                        data: {\r\n                            ticketId: ticketNumber,\r\n                            attachments: fileAttachments\r\n                        }\r\n                    });\r\n                } catch (error: any) {\r\n                    console.error(\"Ticket creation error:\", error);\r\n                    return jsonResponse({ success: false, error: error.message || \"SERVER_ERROR\" }, 500);\r\n                }\r\n            }\r\n\r\n            // GET /api/helpdesk/tickets - Unified Ticket Visibility (Enterprise v2.0)\r\n            if (url.pathname === \"/api/helpdesk/tickets\" && request.method === \"GET\") {\r\n                const authHeader = request.headers.get(\"Authorization\") || \"\";\r\n                const token = authHeader.replace(\"Bearer \", \"\");\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\") as { userId: string } | null;\r\n                if (!payload) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const requester = await env.proveloce_db.prepare(\r\n                    \"SELECT role, org_id FROM users WHERE id = ?\"\r\n                ).bind(payload.userId).first() as any;\r\n\r\n                const role = requester?.role?.toUpperCase() || 'CUSTOMER';\r\n                const requesterOrgId = requester?.org_id || 'ORG-DEFAULT';\r\n\r\n                // Unified Visibility Logic (POML Spec v1.0):\r\n                // Superadmin: view_all(tickets)\r\n                // Admin: view_ticket(assigned_only) WHERE org_id = requesterOrgId\r\n                // Expert: view_ticket(assigned_only) WHERE org_id = requesterOrgId\r\n                // Customer: view_ticket(raised_only) WHERE org_id = requesterOrgId\r\n\r\n                let whereClause = '';\r\n                let params: any[] = [];\r\n\r\n                if (role === 'SUPERADMIN') {\r\n                    whereClause = '';\r\n                } else if (role === 'ADMIN') {\r\n                    // Admins only see tickets assigned to them\r\n                    whereClause = 't.org_id = ? AND t.assigned_user_id = ?';\r\n                    params = [requesterOrgId, payload.userId];\r\n                } else if (role === 'EXPERT') {\r\n                    // Experts only see tickets assigned to them (cannot respond per POML)\r\n                    whereClause = 't.org_id = ? AND t.assigned_user_id = ?';\r\n                    params = [requesterOrgId, payload.userId];\r\n                } else {\r\n                    // Customers see only tickets they raised\r\n                    whereClause = 't.org_id = ? AND t.raised_by_user_id = ?';\r\n                    params = [requesterOrgId, payload.userId];\r\n                }\r\n\r\n                const query = `\r\n                    SELECT \r\n                        t.*,\r\n                        t.ticket_number as ticket_id,\r\n                        u_raised.name as user_full_name,\r\n                        u_raised.email as user_email,\r\n                        u_assign.name as assigned_user_name,\r\n                        u_assign.role as assigned_user_role\r\n                    FROM tickets t\r\n                    LEFT JOIN users u_raised ON t.raised_by_user_id = u_raised.id\r\n                    LEFT JOIN users u_assign ON t.assigned_user_id = u_assign.id\r\n                    ${whereClause ? 'WHERE ' + whereClause : ''}\r\n                    ORDER BY t.created_at DESC\r\n                `;\r\n\r\n                const result = await env.proveloce_db.prepare(query).bind(...params).all();\r\n                const rawTickets = result.results || [];\r\n\r\n                // Fetch attachments for each ticket\r\n                const ticketsWithFiles = await Promise.all(rawTickets.map(async (t: any) => {\r\n                    const files = await env.proveloce_db.prepare(`\r\n                        SELECT id, filename, filetype, bucket, uploaded_at\r\n                        FROM ticket_files WHERE ticket_id = ?\r\n                    `).bind(t.id).all();\r\n\r\n                    return {\r\n                        ...t,\r\n                        attachments: (files.results || []).map((f: any) => ({\r\n                            ...f,\r\n                            url: `/api/helpdesk/attachments/helpdesk/${t.ticket_number}/${f.id}.${f.filename.split('.').pop() || 'bin'}`\r\n                        }))\r\n                    };\r\n                }));\r\n\r\n                return jsonResponse({\r\n                    success: true,\r\n                    data: { tickets: ticketsWithFiles }\r\n                });\r\n            }\r\n\r\n            // GET /api/helpdesk/tickets/:ticket_id - Enterprise Retrieval (v2.0)\r\n            if (url.pathname.match(/^\\/api\\/helpdesk\\/tickets\\/[^\\/]+$/) && !url.pathname.includes('/status') && !url.pathname.includes('/messages') && !url.pathname.includes('/assign') && request.method === \"GET\") {\r\n                const authHeader = request.headers.get(\"Authorization\") || \"\";\r\n                const token = authHeader.replace(\"Bearer \", \"\");\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\") as { userId: string } | null;\r\n                if (!payload) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const ticketId = url.pathname.split('/')[4];\r\n\r\n                // Get user role\r\n                const user = await env.proveloce_db.prepare(\r\n                    \"SELECT role FROM users WHERE id = ?\"\r\n                ).bind(payload.userId).first() as any;\r\n                const role = user?.role?.toUpperCase() || 'CUSTOMER';\r\n\r\n                // Fetch and verify visibility\r\n                const ticket = await env.proveloce_db.prepare(`\r\n                    SELECT \r\n                        t.*,\r\n                        t.ticket_number as ticket_id,\r\n                        u_raised.name as user_full_name,\r\n                        u_raised.email as user_email,\r\n                        u_raised.phone as user_phone_number,\r\n                        u_raised.org_id as user_org_id,\r\n                        u_assign.name as assigned_user_name,\r\n                        u_assign.role as assigned_user_role,\r\n                        u_assign.org_id as assigned_user_org_id\r\n                    FROM tickets t\r\n                    LEFT JOIN users u_raised ON t.raised_by_user_id = u_raised.id\r\n                    LEFT JOIN users u_assign ON t.assigned_user_id = u_assign.id\r\n                    WHERE t.id = ? OR t.ticket_number = ?\r\n                `).bind(ticketId, ticketId).first() as any;\r\n\r\n                if (!ticket) {\r\n                    return jsonResponse({ success: false, error: \"Ticket not found\" }, 404);\r\n                }\r\n\r\n                // Tenant Isolation Check (Spec v1.0)\r\n                const requester = await env.proveloce_db.prepare(\r\n                    \"SELECT role, org_id FROM users WHERE id = ?\"\r\n                ).bind(payload.userId).first() as any;\r\n\r\n                const requesterOrgId = requester?.org_id || 'ORG-DEFAULT';\r\n                const requesterRole = requester?.role?.toUpperCase() || '';\r\n\r\n                if (ticket.org_id !== requesterOrgId && requesterRole !== 'SUPERADMIN') {\r\n                    return jsonResponse({ success: false, error: \"TENANT_MISMATCH\", message: \"Unauthorized tenant access.\" }, 403);\r\n                }\r\n\r\n                // Check visibility permissions: Superadmin OR Raised User OR Assigned User\r\n                const isRaisedByMe = ticket.raised_by_user_id === payload.userId;\r\n                const isAssignedToMe = ticket.assigned_user_id === payload.userId;\r\n                const isSuperAdmin = requesterRole === 'SUPERADMIN';\r\n                const isAdmin = requesterRole === 'ADMIN';\r\n\r\n                // Admins can see all tickets in their Org? Spec implies assignment RBAC but visibility usually follows.\r\n                // Spec says \"All operations scoped to org_id\".\r\n                if (!isSuperAdmin && !isAdmin && !isRaisedByMe && !isAssignedToMe) {\r\n                    return jsonResponse({ success: false, error: \"Not authorized to view this ticket\" }, 403);\r\n                }\r\n\r\n                // Fetch attachments\r\n                const files = await env.proveloce_db.prepare(`\r\n                    SELECT id, filename, filetype, bucket, uploaded_at\r\n                    FROM ticket_files WHERE ticket_id = ?\r\n                `).bind(ticket.id).all();\r\n\r\n                const attachments = (files.results || []).map((f: any) => ({\r\n                    ...f,\r\n                    url: `/api/helpdesk/attachments/helpdesk/${ticket.ticket_number}/${f.id}.${f.filename.split('.').pop() || 'bin'}`\r\n                }));\r\n\r\n                // Parse messages from JSON\r\n                let messages = [];\r\n                try {\r\n                    messages = typeof ticket.messages === 'string' ? JSON.parse(ticket.messages) : (ticket.messages || []);\r\n                } catch (e) {\r\n                    console.error(\"Failed to parse ticket messages JSON\", e);\r\n                }\r\n\r\n                return jsonResponse({\r\n                    success: true,\r\n                    data: {\r\n                        ticket: {\r\n                            ...ticket,\r\n                            attachments\r\n                        },\r\n                        messages\r\n                    }\r\n                });\r\n            }\r\n\r\n            // PATCH /api/helpdesk/tickets/:ticket_id/status - Update ticket status and reply (Enterprise v2.0)\r\n            if (url.pathname.match(/^\\/api\\/helpdesk\\/tickets\\/[^\\/]+\\/status$/) && request.method === \"PATCH\") {\r\n                const authHeader = request.headers.get(\"Authorization\") || \"\";\r\n                const token = authHeader.replace(\"Bearer \", \"\");\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\") as { userId: string } | null;\r\n                if (!payload) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const ticketId = url.pathname.split('/')[4];\r\n                const body = await request.json() as any;\r\n                const { status, reply } = body;\r\n\r\n                // Status mapping to Spec v3.0: Open, In Progress, Resolved, Closed\r\n                let finalStatus = status;\r\n                if (status === 'APPROVED' || status === 'OPEN') finalStatus = 'Open';\r\n                else if (status === 'IN_PROGRESS') finalStatus = 'In Progress';\r\n                else if (status === 'RESOLVED') finalStatus = 'Resolved';\r\n                else if (status === 'REJECTED' || status === 'CLOSED') finalStatus = 'Closed';\r\n\r\n                const validStatuses = ['Open', 'In Progress', 'Resolved', 'Closed'];\r\n                if (!finalStatus || !validStatuses.includes(finalStatus)) {\r\n                    return jsonResponse({\r\n                        success: false,\r\n                        error: `Invalid status. Must be one of: ${validStatuses.join(', ')}`\r\n                    }, 400);\r\n                }\r\n\r\n                // Get requester info\r\n                const user = await env.proveloce_db.prepare(\r\n                    \"SELECT name, role FROM users WHERE id = ?\"\r\n                ).bind(payload.userId).first() as any;\r\n\r\n                const role = user?.role?.toUpperCase() || '';\r\n\r\n                // Get ticket to check permission\r\n                const ticket = await env.proveloce_db.prepare(\r\n                    \"SELECT * FROM tickets WHERE id = ? OR ticket_number = ?\"\r\n                ).bind(ticketId, ticketId).first() as any;\r\n\r\n                if (!ticket) {\r\n                    return jsonResponse({ success: false, error: \"Ticket not found\" }, 404);\r\n                }\r\n\r\n                // Permission check (Spec v3.0):\r\n                // Superadmin: full_access\r\n                // Assigned Admin: respond_ticket\r\n                const isSuperAdmin = role === 'SUPERADMIN';\r\n                const isAssigned = ticket.assigned_user_id === payload.userId;\r\n\r\n                if (!isSuperAdmin && !isAssigned) {\r\n                    return jsonResponse({ success: false, error: \"Only SuperAdmin or the Assigned Responder can update the status of this ticket\" }, 403);\r\n                }\r\n\r\n                // Response Workflow (Spec v4.0): Single Response Enforcement\r\n                let updateQuery = \"UPDATE tickets SET status = ?, updated_at = CURRENT_TIMESTAMP\";\r\n                let updateParams: any[] = [finalStatus];\r\n\r\n                if (reply && reply.trim()) {\r\n                    if (ticket.responder_id && ticket.responder_id !== payload.userId) {\r\n                        return jsonResponse({ success: false, error: \"TICKET_LOCKED\", message: \"This ticket already has a response from another responder.\" }, 403);\r\n                    }\r\n                    if (ticket.responder_id && ticket.edit_count >= 1) {\r\n                        return jsonResponse({ success: false, error: \"EDIT_LIMIT_REACHED\", message: \"One-time edit limit already reached for this response.\" }, 400);\r\n                    }\r\n\r\n                    updateQuery += \", response_text = ?, responder_id = ?, updated_at = CURRENT_TIMESTAMP\";\r\n                    if (ticket.responder_id) {\r\n                        updateQuery += \", is_edited = 1, edit_count = edit_count + 1\";\r\n                    } else {\r\n                        updateQuery += \", is_edited = 0, edit_count = 0\";\r\n                    }\r\n                    updateParams.push(reply.trim(), payload.userId);\r\n                }\r\n\r\n                updateQuery += \" WHERE id = ? OR ticket_number = ?\";\r\n                updateParams.push(ticketId, ticketId);\r\n\r\n                await env.proveloce_db.prepare(updateQuery).bind(...updateParams).run();\r\n\r\n                // AUDIT TRAIL\r\n                const logId = crypto.randomUUID();\r\n                const logMessage = `Ticket ${ticketId} status updated to ${finalStatus} by ${role.toLowerCase()}.`;\r\n                await env.proveloce_db.prepare(`\r\n                    INSERT INTO activity_logs (id, user_id, action, entity_type, entity_id, metadata)\r\n                    VALUES (?, ?, ?, ?, ?, ?)\r\n                `).bind(logId, payload.userId, 'RESPOND_TICKET', 'TICKET', ticketId, JSON.stringify({ message: logMessage, status: finalStatus })).run();\r\n\r\n                return jsonResponse({\r\n                    success: true,\r\n                    message: \"Ticket status updated successfully\",\r\n                    data: { ticketId, status: finalStatus }\r\n                });\r\n            }\r\n\r\n            // PATCH /api/helpdesk/tickets/:ticket_id/assign - Assign ticket to user (Enterprise v2.1)\r\n            if (url.pathname.match(/^\\/api\\/helpdesk\\/tickets\\/[^\\/]+\\/assign$/) && request.method === \"PATCH\") {\r\n                const authHeader = request.headers.get(\"Authorization\") || \"\";\r\n                const token = authHeader.replace(\"Bearer \", \"\");\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\") as { userId: string } | null;\r\n                if (!payload) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const ticketId = url.pathname.split('/')[4];\r\n                const { assignedToId } = await request.json() as { assignedToId: string };\r\n\r\n                if (!assignedToId) {\r\n                    return jsonResponse({ success: false, error: \"assignedToId is required\" }, 400);\r\n                }\r\n\r\n                // Verify requester is SuperAdmin (Spec v3.0: superadmin_only)\r\n                const requester = await env.proveloce_db.prepare(\r\n                    \"SELECT role, org_id, suspended FROM users WHERE id = ?\"\r\n                ).bind(payload.userId).first() as any;\r\n                const requesterRole = requester?.role?.toUpperCase() || '';\r\n                const requesterOrgId = requester?.org_id || 'ORG-DEFAULT';\r\n\r\n                if (requester.suspended === 1) {\r\n                    return jsonResponse({ success: false, error: \"ACCOUNT_SUSPENDED\", message: \"Account is suspended.\" }, 403);\r\n                }\r\n\r\n                if (requesterRole !== 'SUPERADMIN' && requesterRole !== 'ADMIN') {\r\n                    return jsonResponse({ success: false, error: \"Only Admins can assign tickets\" }, 403);\r\n                }\r\n\r\n                // Verify assigned user exists, has correct role, and same tenant\r\n                const assignedUser = await env.proveloce_db.prepare(\r\n                    \"SELECT name, role, org_id, suspended FROM users WHERE id = ?\"\r\n                ).bind(assignedToId).first() as any;\r\n\r\n                if (!assignedUser) {\r\n                    return jsonResponse({ success: false, error: \"Assigned user not found\" }, 404);\r\n                }\r\n\r\n                if (assignedUser.role?.toUpperCase() !== 'ADMIN' && assignedUser.role?.toUpperCase() !== 'SUPERADMIN' && assignedUser.role?.toUpperCase() !== 'EXPERT') {\r\n                    return jsonResponse({ success: false, error: \"Tickets can only be assigned to ADMIN, SUPERADMIN, or EXPERT\" }, 400);\r\n                }\r\n\r\n                if (assignedUser.org_id !== requesterOrgId && requesterRole !== 'SUPERADMIN') {\r\n                    // SuperAdmin can cross-assign? Spec says \"cross-tenant assignment is forbidden\"\r\n                    return jsonResponse({ success: false, error: \"TENANT_MISMATCH\", message: \"Cannot assign across tenants.\" }, 403);\r\n                }\r\n\r\n                if (assignedUser.suspended === 1) {\r\n                    return jsonResponse({ success: false, error: \"TARGET_SUSPENDED\", message: \"Cannot assign to a suspended user.\" }, 400);\r\n                }\r\n\r\n                // Fetch ticket to check tenancy and status\r\n                const ticket = await env.proveloce_db.prepare(\r\n                    \"SELECT org_id, status, locked_by FROM tickets WHERE id = ? OR ticket_number = ?\"\r\n                ).bind(ticketId, ticketId).first() as any;\r\n\r\n                if (!ticket) {\r\n                    return jsonResponse({ success: false, error: \"Ticket not found\" }, 404);\r\n                }\r\n\r\n                if (ticket.org_id !== requesterOrgId && requesterRole !== 'SUPERADMIN') {\r\n                    return jsonResponse({ success: false, error: \"TENANT_MISMATCH\", message: \"Unauthorized tenant access.\" }, 403);\r\n                }\r\n\r\n                if (['CLOSED', 'RESOLVED'].includes(ticket.status.toUpperCase())) {\r\n                    return jsonResponse({ success: false, error: \"TICKET_CLOSED\", message: \"Cannot assign closed or resolved tickets.\" }, 400);\r\n                }\r\n\r\n                if (ticket.locked_by && ticket.locked_by !== payload.userId && requesterRole !== 'SUPERADMIN') {\r\n                    return jsonResponse({ success: false, error: \"TICKET_LOCKED\", message: \"Ticket is locked by another user.\" }, 403);\r\n                }\r\n\r\n                // Update ticket\r\n                await env.proveloce_db.prepare(`\r\n                    UPDATE tickets SET \r\n                        assigned_user_id = ?,\r\n                        assignee_role = ?,\r\n                        assigned_at = CURRENT_TIMESTAMP,\r\n                        updated_at = CURRENT_TIMESTAMP\r\n                    WHERE id = ? OR ticket_number = ?\r\n                `).bind(assignedToId, assignedUser.role, ticketId, ticketId).run();\r\n\r\n                // AUDIT TRAIL\r\n                const logId = crypto.randomUUID();\r\n                const logMessage = `Ticket ${ticketId} assigned to ${assignedUser.username || assignedUser.name} by superadmin`;\r\n                await env.proveloce_db.prepare(`\r\n                    INSERT INTO activity_logs (id, user_id, action, entity_type, entity_id, metadata)\r\n                    VALUES (?, ?, ?, ?, ?, ?)\r\n                `).bind(logId, payload.userId, 'ASSIGN_TICKET', 'TICKET', ticketId, JSON.stringify({ message: logMessage, assignedTo: assignedToId })).run();\r\n\r\n                return jsonResponse({\r\n                    success: true,\r\n                    message: \"Ticket assigned successfully\"\r\n                });\r\n            }\r\n\r\n            // POST /api/helpdesk/tickets/:ticket_id/reassign - Reassign ticket (Spec v1.0)\r\n            if (url.pathname.match(/^\\/api\\/helpdesk\\/tickets\\/[^\\/]+\\/reassign$/) && request.method === \"POST\") {\r\n                const authHeader = request.headers.get(\"Authorization\") || \"\";\r\n                const token = authHeader.replace(\"Bearer \", \"\");\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\") as { userId: string } | null;\r\n                if (!payload) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const ticketId = url.pathname.split('/')[4];\r\n                const { assignedToId } = await request.json() as { assignedToId: string };\r\n\r\n                const requester = await env.proveloce_db.prepare(\"SELECT role, org_id FROM users WHERE id = ?\").bind(payload.userId).first() as any;\r\n                const requesterOrgId = requester?.org_id || 'ORG-DEFAULT';\r\n                const requesterRole = requester?.role?.toUpperCase() || '';\r\n\r\n                if (requesterRole !== 'SUPERADMIN' && requesterRole !== 'ADMIN') {\r\n                    return jsonResponse({ success: false, error: \"FORBIDDEN\", message: \"Role not permitted to reassign.\" }, 403);\r\n                }\r\n\r\n                const assignedUser = await env.proveloce_db.prepare(\"SELECT name, role, org_id FROM users WHERE id = ?\").bind(assignedToId).first() as any;\r\n                if (!assignedUser || assignedUser.org_id !== requesterOrgId && requesterRole !== 'SUPERADMIN') {\r\n                    return jsonResponse({ success: false, error: \"INVALID_ASSIGNEE\", message: \"Assignee must be in same tenant.\" }, 403);\r\n                }\r\n\r\n                const ticket = await env.proveloce_db.prepare(\"SELECT org_id, assigned_user_id FROM tickets WHERE id = ? OR ticket_number = ?\").bind(ticketId, ticketId).first() as any;\r\n                if (!ticket || ticket.org_id !== requesterOrgId && requesterRole !== 'SUPERADMIN') {\r\n                    return jsonResponse({ success: false, error: \"TICKET_NOT_FOUND\" }, 404);\r\n                }\r\n\r\n                const prevAssigneeId = ticket.assigned_user_id;\r\n\r\n                await env.proveloce_db.prepare(`\r\n                    UPDATE tickets SET assigned_user_id = ?, assignee_role = ?, updated_at = CURRENT_TIMESTAMP WHERE id = ? OR ticket_number = ?\r\n                `).bind(assignedToId, assignedUser.role, ticketId, ticketId).run();\r\n\r\n                // Audit\r\n                await env.proveloce_db.prepare(`\r\n                    INSERT INTO activity_logs (id, user_id, action, entity_type, entity_id, metadata)\r\n                    VALUES (?, ?, ?, ?, ?, ?)\r\n                `).bind(crypto.randomUUID(), payload.userId, 'REASSIGN_TICKET', 'TICKET', ticketId, JSON.stringify({ assignedTo: assignedToId, previousAssignee: prevAssigneeId })).run();\r\n\r\n                return jsonResponse({ success: true, message: \"Ticket reassigned\" });\r\n            }\r\n\r\n            // POST /api/helpdesk/tickets/:ticket_id/unassign - Unassign ticket (Spec v1.0)\r\n            if (url.pathname.match(/^\\/api\\/helpdesk\\/tickets\\/[^\\/]+\\/unassign$/) && request.method === \"POST\") {\r\n                const authHeader = request.headers.get(\"Authorization\") || \"\";\r\n                const token = authHeader.replace(\"Bearer \", \"\");\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\") as { userId: string } | null;\r\n                if (!payload) return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n\r\n                const ticketId = url.pathname.split('/')[4];\r\n                const requester = await env.proveloce_db.prepare(\"SELECT role, org_id FROM users WHERE id = ?\").bind(payload.userId).first() as any;\r\n                const requesterOrgId = requester?.org_id || 'ORG-DEFAULT';\r\n\r\n                const ticket = await env.proveloce_db.prepare(\"SELECT org_id FROM tickets WHERE id = ? OR ticket_number = ?\").bind(ticketId, ticketId).first() as any;\r\n                if (!ticket || ticket.org_id !== requesterOrgId && requester.role?.toUpperCase() !== 'SUPERADMIN') {\r\n                    return jsonResponse({ success: false, error: \"UNAUTHORIZED\" }, 403);\r\n                }\r\n\r\n                await env.proveloce_db.prepare(`\r\n                    UPDATE tickets SET assigned_user_id = NULL, assignee_role = NULL, updated_at = CURRENT_TIMESTAMP WHERE id = ? OR ticket_number = ?\r\n                `).bind(ticketId, ticketId).run();\r\n\r\n                return jsonResponse({ success: true, message: \"Ticket unassigned\" });\r\n            }\r\n\r\n            // POST /api/helpdesk/tickets/:ticket_id/messages - Add message to thread (Revised Spec v3.0)\r\n            if (url.pathname.match(/^\\/api\\/helpdesk\\/tickets\\/[^\\/]+\\/messages$/) && request.method === \"POST\") {\r\n                const authHeader = request.headers.get(\"Authorization\") || \"\";\r\n                const token = authHeader.replace(\"Bearer \", \"\");\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\") as { userId: string } | null;\r\n                if (!payload) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const ticketId = url.pathname.split('/')[4];\r\n                const { message, edit_requested } = await request.json() as { message: string, edit_requested?: boolean };\r\n\r\n                if (!message || !message.trim()) {\r\n                    return jsonResponse({ success: false, error: \"Message is required\" }, 400);\r\n                }\r\n\r\n                // Get requester info\r\n                const user = await env.proveloce_db.prepare(\r\n                    \"SELECT name, role FROM users WHERE id = ?\"\r\n                ).bind(payload.userId).first() as any;\r\n                const role = user?.role?.toUpperCase() || 'CUSTOMER';\r\n\r\n                // Get ticket to check permissions\r\n                const ticket = await env.proveloce_db.prepare(\r\n                    \"SELECT * FROM tickets WHERE id = ? OR ticket_number = ?\"\r\n                ).bind(ticketId, ticketId).first() as any;\r\n\r\n                if (!ticket) {\r\n                    return jsonResponse({ success: false, error: \"Ticket not found\" }, 404);\r\n                }\r\n\r\n                // Permission check (Spec v4.0):\r\n                const isSuperAdmin = role === 'SUPERADMIN';\r\n                const isAssigned = ticket.assigned_user_id === payload.userId;\r\n                const isRaiser = ticket.raised_by_user_id === payload.userId;\r\n\r\n                // Raising user cannot respond to their own ticket anymore in the simplified view (Spec v4.0 is one-way)\r\n                // However, we allow them to view. Responses are only from Admins/Responders.\r\n                if (isRaiser && !isSuperAdmin && !isAssigned) {\r\n                    return jsonResponse({ success: false, error: \"Customers cannot add further messages to this ticket. Please wait for a responder.\" }, 403);\r\n                }\r\n\r\n                if (!isSuperAdmin && !isAssigned) {\r\n                    return jsonResponse({ success: false, error: \"Not authorized to respond to this ticket\" }, 403);\r\n                }\r\n\r\n                // Single Response Enforcement\r\n                if (ticket.responder_id && !edit_requested) {\r\n                    return jsonResponse({ success: false, error: \"ALREADY_RESPONDED\", message: \"This ticket already has a response. Ongoing conversations are disabled.\" }, 400);\r\n                }\r\n\r\n                // One-time Edit Enforcement\r\n                if (edit_requested) {\r\n                    const canEdit = isSuperAdmin || (ticket.responder_id === payload.userId) || (ticket.assigned_user_id === payload.userId);\r\n                    if (!canEdit) {\r\n                        return jsonResponse({ success: false, error: \"UNAUTHORIZED_EDIT\", message: \"Only the original responder or an assigned admin can edit this response.\" }, 403);\r\n                    }\r\n                    if (ticket.edit_count >= 1 && !isSuperAdmin) {\r\n                        return jsonResponse({ success: false, error: \"EDIT_LIMIT_REACHED\", message: \"One-time edit limit already reached.\" }, 400);\r\n                    }\r\n                }\r\n\r\n                // Update Response\r\n                const updateQuery = `\r\n                    UPDATE tickets SET \r\n                        response_text = ?, \r\n                        responder_id = ?, \r\n                        is_edited = ?, \r\n                        edit_count = edit_count + ?,\r\n                        updated_at = CURRENT_TIMESTAMP\r\n                    WHERE id = ? OR ticket_number = ?\r\n                `;\r\n\r\n                const isEdit = ticket.responder_id ? 1 : 0;\r\n                await env.proveloce_db.prepare(updateQuery).bind(\r\n                    message.trim(),\r\n                    payload.userId,\r\n                    isEdit,\r\n                    isEdit,\r\n                    ticketId,\r\n                    ticketId\r\n                ).run();\r\n\r\n                // AUDIT TRAIL\r\n                const logId = crypto.randomUUID();\r\n                const logAction = isEdit ? 'EDIT_TICKET_RESPONSE' : 'RESPOND_TICKET';\r\n                const logMessage = `${isEdit ? 'Response edited' : 'New response added'} for ticket ${ticketId} by ${role.toLowerCase()}.`;\r\n\r\n                await env.proveloce_db.prepare(`\r\n                    INSERT INTO activity_logs (id, user_id, action, entity_type, entity_id, metadata)\r\n                    VALUES (?, ?, ?, ?, ?, ?)\r\n                `).bind(logId, payload.userId, logAction, 'TICKET', ticketId, JSON.stringify({ message: logMessage, is_override: isEdit && ticket.responder_id !== payload.userId })).run();\r\n\r\n                return jsonResponse({\r\n                    success: true,\r\n                    message: isEdit ? \"Response updated successfully\" : \"Response added successfully\"\r\n                });\r\n            }\r\n\r\n            // GET /api/helpdesk/attachments/* - Serve attachments from R2 (POML compliant)\r\n            if (url.pathname.startsWith(\"/api/helpdesk/attachments/\") && request.method === \"GET\") {\r\n                const authHeader = request.headers.get(\"Authorization\") || \"\";\r\n                const token = authHeader.replace(\"Bearer \", \"\");\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\") as { userId: string } | null;\r\n                if (!payload) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                // Extract the file path from URL\r\n                const filePath = url.pathname.replace(\"/api/helpdesk/attachments/\", \"\");\r\n\r\n                if (!filePath || !env.others) {\r\n                    return jsonResponse({ success: false, error: \"Attachment not found\" }, 404);\r\n                }\r\n\r\n                try {\r\n                    const object = await env.others.get(filePath);\r\n                    if (!object) {\r\n                        return jsonResponse({ success: false, error: \"Attachment not found in storage\" }, 404);\r\n                    }\r\n\r\n                    const headers = new Headers();\r\n                    headers.set(\"Content-Type\", object.httpMetadata?.contentType || \"application/octet-stream\");\r\n                    headers.set(\"Cache-Control\", \"private, max-age=3600\");\r\n                    // CORS headers for frontend access\r\n                    headers.set(\"Access-Control-Allow-Origin\", \"*\");\r\n                    headers.set(\"Access-Control-Allow-Methods\", \"GET, OPTIONS\");\r\n\r\n                    return new Response(object.body, { headers });\r\n                } catch (err: any) {\r\n                    console.error(\"Attachment fetch error:\", err);\r\n                    return jsonResponse({ success: false, error: \"Failed to retrieve attachment\" }, 500);\r\n                }\r\n            }\r\n\r\n            // =====================================================\r\n            // POML Task Assignment - CRUD Endpoints\r\n            // =====================================================\r\n\r\n            // GET /api/tasks - List tasks\r\n            if (url.pathname === \"/api/tasks\" && request.method === \"GET\") {\r\n                const authHeader = request.headers.get(\"Authorization\");\r\n                if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const token = authHeader.substring(7);\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\");\r\n                if (!payload) return jsonResponse({ success: false, error: \"Invalid token\" }, 401);\r\n\r\n                const role = (payload.role || \"\").toUpperCase();\r\n                const requesterOrgId = payload.org_id || 'ORG-DEFAULT';\r\n\r\n                if (!env.proveloce_db) return jsonResponse({ success: false, error: \"Database not configured\" }, 500);\r\n\r\n                let whereClause = \"\";\r\n                let params: any[] = [];\r\n\r\n                if (role === \"SUPERADMIN\") {\r\n                    whereClause = \"1=1\";\r\n                } else if (role === \"ADMIN\") {\r\n                    whereClause = \"t.org_id = ?\";\r\n                    params = [requesterOrgId];\r\n                } else {\r\n                    // Experts and others see only tasks assigned to them\r\n                    whereClause = \"t.assigned_to = ?\";\r\n                    params = [payload.userId];\r\n                }\r\n\r\n                try {\r\n                    const result = await env.proveloce_db.prepare(`\r\n                        SELECT t.*, u.name as assigned_user_name\r\n                        FROM tasks t\r\n                        LEFT JOIN users u ON t.assigned_to = u.id\r\n                        WHERE ${whereClause}\r\n                        ORDER BY t.created_at DESC\r\n                    `).bind(...params).all();\r\n\r\n                    return jsonResponse({\r\n                        success: true,\r\n                        data: { tasks: result.results || [] }\r\n                    });\r\n                } catch (error: any) {\r\n                    console.error(\"Error fetching tasks:\", error);\r\n                    return jsonResponse({ success: false, error: \"Failed to fetch tasks\" }, 500);\r\n                }\r\n            }\r\n\r\n            // POST /api/tasks - Create task\r\n            if (url.pathname === \"/api/tasks\" && request.method === \"POST\") {\r\n                const authHeader = request.headers.get(\"Authorization\");\r\n                if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const token = authHeader.substring(7);\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\");\r\n                if (!payload) return jsonResponse({ success: false, error: \"Invalid token\" }, 401);\r\n\r\n                const role = (payload.role || \"\").toUpperCase();\r\n                if (role !== \"ADMIN\" && role !== \"SUPERADMIN\") {\r\n                    return jsonResponse({ success: false, error: \"Only admins can create tasks\" }, 403);\r\n                }\r\n\r\n                if (!env.proveloce_db) return jsonResponse({ success: false, error: \"Database not configured\" }, 500);\r\n\r\n                try {\r\n                    const body = await request.json() as {\r\n                        title: string;\r\n                        description: string;\r\n                        assignedTo?: string;\r\n                        dueDate?: string;\r\n                    };\r\n\r\n                    if (!body.title || !body.description) {\r\n                        return jsonResponse({ success: false, error: \"Title and description are required\" }, 400);\r\n                    }\r\n\r\n                    const taskId = crypto.randomUUID();\r\n                    const orgId = payload.org_id || 'ORG-DEFAULT';\r\n\r\n                    await env.proveloce_db.prepare(`\r\n                        INSERT INTO tasks (id, title, description, assigned_to, due_date, status, org_id, created_by, created_at, updated_at)\r\n                        VALUES (?, ?, ?, ?, ?, 'Pending', ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP)\r\n                    `).bind(\r\n                        taskId,\r\n                        body.title,\r\n                        body.description,\r\n                        body.assignedTo || null,\r\n                        body.dueDate || null,\r\n                        orgId,\r\n                        payload.userId\r\n                    ).run();\r\n\r\n                    // Notify assigned user if any\r\n                    if (body.assignedTo) {\r\n                        await createNotification(\r\n                            env, body.assignedTo, 'INFO',\r\n                            'New Task Assigned',\r\n                            `You have been assigned a new task: ${body.title}`,\r\n                            '/expert/tasks'\r\n                        );\r\n                    }\r\n\r\n                    return jsonResponse({ success: true, message: \"Task created\", id: taskId });\r\n                } catch (error: any) {\r\n                    console.error(\"Error creating task:\", error);\r\n                    return jsonResponse({ success: false, error: \"Failed to create task\" }, 500);\r\n                }\r\n            }\r\n\r\n            // GET /api/tasks/:id - Get single task\r\n            const taskIdMatch = url.pathname.match(/^\\/api\\/tasks\\/([^\\/]+)$/);\r\n            if (taskIdMatch && request.method === \"GET\") {\r\n                const authHeader = request.headers.get(\"Authorization\");\r\n                if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const token = authHeader.substring(7);\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\");\r\n                if (!payload) return jsonResponse({ success: false, error: \"Invalid token\" }, 401);\r\n\r\n                const taskId = taskIdMatch[1];\r\n\r\n                if (!env.proveloce_db) return jsonResponse({ success: false, error: \"Database not configured\" }, 500);\r\n\r\n                try {\r\n                    const task = await env.proveloce_db.prepare(`\r\n                        SELECT t.*, u.name as assigned_user_name\r\n                        FROM tasks t\r\n                        LEFT JOIN users u ON t.assigned_to = u.id\r\n                        WHERE t.id = ?\r\n                    `).bind(taskId).first();\r\n\r\n                    if (!task) {\r\n                        return jsonResponse({ success: false, error: \"Task not found\" }, 404);\r\n                    }\r\n\r\n                    return jsonResponse({ success: true, data: { task } });\r\n                } catch (error: any) {\r\n                    console.error(\"Error fetching task:\", error);\r\n                    return jsonResponse({ success: false, error: \"Failed to fetch task\" }, 500);\r\n                }\r\n            }\r\n\r\n            // PATCH /api/tasks/:id - Update task\r\n            if (taskIdMatch && request.method === \"PATCH\") {\r\n                const authHeader = request.headers.get(\"Authorization\");\r\n                if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const token = authHeader.substring(7);\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\");\r\n                if (!payload) return jsonResponse({ success: false, error: \"Invalid token\" }, 401);\r\n\r\n                const taskId = taskIdMatch[1];\r\n\r\n                if (!env.proveloce_db) return jsonResponse({ success: false, error: \"Database not configured\" }, 500);\r\n\r\n                try {\r\n                    const body = await request.json() as { status?: string; assignedTo?: string };\r\n\r\n                    const updates: string[] = [];\r\n                    const params: any[] = [];\r\n\r\n                    if (body.status) {\r\n                        updates.push(\"status = ?\");\r\n                        params.push(body.status);\r\n                    }\r\n                    if (body.assignedTo !== undefined) {\r\n                        updates.push(\"assigned_to = ?\");\r\n                        params.push(body.assignedTo || null);\r\n                    }\r\n                    updates.push(\"updated_at = CURRENT_TIMESTAMP\");\r\n\r\n                    params.push(taskId);\r\n\r\n                    await env.proveloce_db.prepare(`\r\n                        UPDATE tasks SET ${updates.join(\", \")} WHERE id = ?\r\n                    `).bind(...params).run();\r\n\r\n                    return jsonResponse({ success: true, message: \"Task updated\" });\r\n                } catch (error: any) {\r\n                    console.error(\"Error updating task:\", error);\r\n                    return jsonResponse({ success: false, error: \"Failed to update task\" }, 500);\r\n                }\r\n            }\r\n\r\n            // =====================================================\r\n            // Expert Connect - Search & Discovery\r\n            // =====================================================\r\n\r\n            // GET /api/experts/search - Search experts with filters\r\n            if (url.pathname === \"/api/experts/search\" && request.method === \"GET\") {\r\n                const authHeader = request.headers.get(\"Authorization\");\r\n                if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const token = authHeader.substring(7);\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\");\r\n                if (!payload) return jsonResponse({ success: false, error: \"Invalid token\" }, 401);\r\n\r\n                if (!env.proveloce_db) return jsonResponse({ success: false, error: \"Database not configured\" }, 500);\r\n\r\n                const domain = url.searchParams.get(\"domain\");\r\n                const slotLabel = url.searchParams.get(\"slot_label\");\r\n                const dayType = url.searchParams.get(\"day_type\");\r\n\r\n                try {\r\n                    let query = `\r\n                        SELECT DISTINCT u.id, u.name, u.email, u.role, u.status\r\n                        FROM users u\r\n                        LEFT JOIN expert_time_slots s ON s.expert_id = u.id\r\n                        WHERE UPPER(u.role) = 'EXPERT' AND UPPER(u.status) = 'ACTIVE'\r\n                    `;\r\n                    const params: any[] = [];\r\n\r\n                    if (slotLabel) {\r\n                        query += ` AND s.slot_label = ?`;\r\n                        params.push(slotLabel);\r\n                    }\r\n                    if (dayType) {\r\n                        query += ` AND (s.day_type = ? OR s.day_type = 'both')`;\r\n                        params.push(dayType);\r\n                    }\r\n\r\n                    query += ` ORDER BY u.name ASC`;\r\n\r\n                    const result = await env.proveloce_db.prepare(query).bind(...params).all();\r\n\r\n                    return jsonResponse({\r\n                        success: true,\r\n                        data: { experts: result.results || [] }\r\n                    });\r\n                } catch (error: any) {\r\n                    console.error(\"Error searching experts:\", error);\r\n                    return jsonResponse({ success: false, error: \"Failed to search experts\" }, 500);\r\n                }\r\n            }\r\n\r\n            // GET /api/experts/:id/public - Get expert public profile\r\n            const expertPublicMatch = url.pathname.match(/^\\/api\\/experts\\/([^\\/]+)\\/public$/);\r\n            if (expertPublicMatch && request.method === \"GET\") {\r\n                const authHeader = request.headers.get(\"Authorization\");\r\n                if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const token = authHeader.substring(7);\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\");\r\n                if (!payload) return jsonResponse({ success: false, error: \"Invalid token\" }, 401);\r\n\r\n                const expertId = expertPublicMatch[1];\r\n\r\n                if (!env.proveloce_db) return jsonResponse({ success: false, error: \"Database not configured\" }, 500);\r\n\r\n                try {\r\n                    // Get public profile (non-confidential only)\r\n                    const expert = await env.proveloce_db.prepare(`\r\n                        SELECT id, name, role, status, created_at\r\n                        FROM users WHERE id = ? AND UPPER(role) = 'EXPERT'\r\n                    `).bind(expertId).first();\r\n\r\n                    if (!expert) {\r\n                        return jsonResponse({ success: false, error: \"Expert not found\" }, 404);\r\n                    }\r\n\r\n                    // Get expert's time slots\r\n                    const slots = await env.proveloce_db.prepare(`\r\n                        SELECT slot_label, day_type FROM expert_time_slots WHERE expert_id = ?\r\n                    `).bind(expertId).all();\r\n\r\n                    return jsonResponse({\r\n                        success: true,\r\n                        data: {\r\n                            expert,\r\n                            slots: slots.results || []\r\n                        }\r\n                    });\r\n                } catch (error: any) {\r\n                    console.error(\"Error fetching expert:\", error);\r\n                    return jsonResponse({ success: false, error: \"Failed to fetch expert\" }, 500);\r\n                }\r\n            }\r\n\r\n            // =====================================================\r\n            // Expert Connect - Connect Requests\r\n            // =====================================================\r\n\r\n            // POST /api/connect-requests - Create connect request\r\n            if (url.pathname === \"/api/connect-requests\" && request.method === \"POST\") {\r\n                const authHeader = request.headers.get(\"Authorization\");\r\n                if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const token = authHeader.substring(7);\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\");\r\n                if (!payload) return jsonResponse({ success: false, error: \"Invalid token\" }, 401);\r\n\r\n                if (!env.proveloce_db) return jsonResponse({ success: false, error: \"Database not configured\" }, 500);\r\n\r\n                try {\r\n                    const body = await request.json() as {\r\n                        expertId: string;\r\n                        requestedDate: string;\r\n                        requestedDayType: string;\r\n                        requestedSlotLabel: string;\r\n                        customerNote?: string;\r\n                    };\r\n\r\n                    if (!body.expertId || !body.requestedDate || !body.requestedDayType || !body.requestedSlotLabel) {\r\n                        return jsonResponse({ success: false, error: \"Missing required fields\" }, 400);\r\n                    }\r\n\r\n                    const requestId = crypto.randomUUID();\r\n\r\n                    await env.proveloce_db.prepare(`\r\n                        INSERT INTO connect_requests (id, customer_id, expert_id, requested_date, requested_day_type, requested_slot_label, customer_note, status)\r\n                        VALUES (?, ?, ?, ?, ?, ?, ?, 'pending')\r\n                    `).bind(\r\n                        requestId,\r\n                        payload.userId,\r\n                        body.expertId,\r\n                        body.requestedDate,\r\n                        body.requestedDayType,\r\n                        body.requestedSlotLabel,\r\n                        body.customerNote || null\r\n                    ).run();\r\n\r\n                    // Notify expert\r\n                    await createNotification(\r\n                        env,\r\n                        body.expertId,\r\n                        'INFO',\r\n                        'New Connect Request',\r\n                        'You have received a new connect request.',\r\n                        '/expert/connect-requests'\r\n                    );\r\n\r\n                    return jsonResponse({ success: true, message: \"Connect request sent\", id: requestId });\r\n                } catch (error: any) {\r\n                    console.error(\"Error creating connect request:\", error);\r\n                    return jsonResponse({ success: false, error: \"Failed to create connect request\" }, 500);\r\n                }\r\n            }\r\n\r\n            // GET /api/connect-requests - List connect requests\r\n            if (url.pathname === \"/api/connect-requests\" && request.method === \"GET\") {\r\n                const authHeader = request.headers.get(\"Authorization\");\r\n                if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const token = authHeader.substring(7);\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\");\r\n                if (!payload) return jsonResponse({ success: false, error: \"Invalid token\" }, 401);\r\n\r\n                if (!env.proveloce_db) return jsonResponse({ success: false, error: \"Database not configured\" }, 500);\r\n\r\n                const role = (payload.role || \"\").toUpperCase();\r\n                const viewType = url.searchParams.get(\"view\") || \"customer\"; // customer or expert\r\n\r\n                try {\r\n                    let query: string;\r\n                    let params: any[];\r\n\r\n                    if (viewType === \"expert\" && role === \"EXPERT\") {\r\n                        // Expert inbox\r\n                        query = `\r\n                            SELECT r.*, u.name as customer_name\r\n                            FROM connect_requests r\r\n                            JOIN users u ON u.id = r.customer_id\r\n                            WHERE r.expert_id = ?\r\n                            ORDER BY r.created_at DESC\r\n                        `;\r\n                        params = [payload.userId];\r\n                    } else {\r\n                        // Customer's own requests\r\n                        query = `\r\n                            SELECT r.*, u.name as expert_name\r\n                            FROM connect_requests r\r\n                            JOIN users u ON u.id = r.expert_id\r\n                            WHERE r.customer_id = ?\r\n                            ORDER BY r.created_at DESC\r\n                        `;\r\n                        params = [payload.userId];\r\n                    }\r\n\r\n                    const result = await env.proveloce_db.prepare(query).bind(...params).all();\r\n\r\n                    return jsonResponse({\r\n                        success: true,\r\n                        data: { requests: result.results || [] }\r\n                    });\r\n                } catch (error: any) {\r\n                    console.error(\"Error fetching connect requests:\", error);\r\n                    return jsonResponse({ success: false, error: \"Failed to fetch connect requests\" }, 500);\r\n                }\r\n            }\r\n\r\n            // PATCH /api/connect-requests/:id - Accept/Reject request (expert only)\r\n            const connectRequestMatch = url.pathname.match(/^\\/api\\/connect-requests\\/([^\\/]+)$/);\r\n            if (connectRequestMatch && request.method === \"PATCH\") {\r\n                const authHeader = request.headers.get(\"Authorization\");\r\n                if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const token = authHeader.substring(7);\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\");\r\n                if (!payload) return jsonResponse({ success: false, error: \"Invalid token\" }, 401);\r\n\r\n                const requestId = connectRequestMatch[1];\r\n\r\n                if (!env.proveloce_db) return jsonResponse({ success: false, error: \"Database not configured\" }, 500);\r\n\r\n                try {\r\n                    const body = await request.json() as { status: 'accepted' | 'rejected' };\r\n\r\n                    if (!body.status || !['accepted', 'rejected'].includes(body.status)) {\r\n                        return jsonResponse({ success: false, error: \"Invalid status\" }, 400);\r\n                    }\r\n\r\n                    // Verify expert owns the request\r\n                    const request_data = await env.proveloce_db.prepare(`\r\n                        SELECT * FROM connect_requests WHERE id = ? AND expert_id = ?\r\n                    `).bind(requestId, payload.userId).first() as any;\r\n\r\n                    if (!request_data) {\r\n                        return jsonResponse({ success: false, error: \"Request not found or unauthorized\" }, 404);\r\n                    }\r\n\r\n                    // Update status\r\n                    await env.proveloce_db.prepare(`\r\n                        UPDATE connect_requests SET status = ?, updated_at = CURRENT_TIMESTAMP WHERE id = ?\r\n                    `).bind(body.status, requestId).run();\r\n\r\n                    // If accepted, create session\r\n                    if (body.status === 'accepted') {\r\n                        const sessionId = crypto.randomUUID();\r\n                        const roomId = `room-${sessionId.substring(0, 8)}`;\r\n\r\n                        await env.proveloce_db.prepare(`\r\n                            INSERT INTO sessions (id, request_id, expert_id, customer_id, scheduled_date, scheduled_slot_label, status, room_id)\r\n                            VALUES (?, ?, ?, ?, ?, ?, 'scheduled', ?)\r\n                        `).bind(\r\n                            sessionId,\r\n                            requestId,\r\n                            request_data.expert_id,\r\n                            request_data.customer_id,\r\n                            request_data.requested_date,\r\n                            request_data.requested_slot_label,\r\n                            roomId\r\n                        ).run();\r\n\r\n                        // Notify customer\r\n                        await createNotification(\r\n                            env,\r\n                            request_data.customer_id,\r\n                            'SUCCESS',\r\n                            'Connect Request Accepted',\r\n                            'Your connect request has been accepted. A session is scheduled.',\r\n                            '/customer/my-requests'\r\n                        );\r\n                    } else {\r\n                        // Notify customer of rejection\r\n                        await createNotification(\r\n                            env,\r\n                            request_data.customer_id,\r\n                            'WARNING',\r\n                            'Connect Request Rejected',\r\n                            'Your connect request was not accepted.',\r\n                            '/customer/my-requests'\r\n                        );\r\n                    }\r\n\r\n                    return jsonResponse({ success: true, message: `Request ${body.status}` });\r\n                } catch (error: any) {\r\n                    console.error(\"Error updating connect request:\", error);\r\n                    return jsonResponse({ success: false, error: \"Failed to update connect request\" }, 500);\r\n                }\r\n            }\r\n\r\n            // =====================================================\r\n            // Expert Connect - Sessions\r\n            // =====================================================\r\n\r\n            // GET /api/sessions - List sessions\r\n            if (url.pathname === \"/api/sessions\" && request.method === \"GET\") {\r\n                const authHeader = request.headers.get(\"Authorization\");\r\n                if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const token = authHeader.substring(7);\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\");\r\n                if (!payload) return jsonResponse({ success: false, error: \"Invalid token\" }, 401);\r\n\r\n                if (!env.proveloce_db) return jsonResponse({ success: false, error: \"Database not configured\" }, 500);\r\n\r\n                try {\r\n                    const result = await env.proveloce_db.prepare(`\r\n                        SELECT s.*, \r\n                               e.name as expert_name,\r\n                               c.name as customer_name\r\n                        FROM sessions s\r\n                        JOIN users e ON e.id = s.expert_id\r\n                        JOIN users c ON c.id = s.customer_id\r\n                        WHERE s.expert_id = ? OR s.customer_id = ?\r\n                        ORDER BY s.scheduled_date DESC\r\n                    `).bind(payload.userId, payload.userId).all();\r\n\r\n                    return jsonResponse({\r\n                        success: true,\r\n                        data: { sessions: result.results || [] }\r\n                    });\r\n                } catch (error: any) {\r\n                    console.error(\"Error fetching sessions:\", error);\r\n                    return jsonResponse({ success: false, error: \"Failed to fetch sessions\" }, 500);\r\n                }\r\n            }\r\n\r\n            // POST /api/sessions/:id/start - Start session\r\n            const sessionStartMatch = url.pathname.match(/^\\/api\\/sessions\\/([^\\/]+)\\/start$/);\r\n            if (sessionStartMatch && request.method === \"POST\") {\r\n                const authHeader = request.headers.get(\"Authorization\");\r\n                if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const token = authHeader.substring(7);\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\");\r\n                if (!payload) return jsonResponse({ success: false, error: \"Invalid token\" }, 401);\r\n\r\n                const sessionId = sessionStartMatch[1];\r\n\r\n                if (!env.proveloce_db) return jsonResponse({ success: false, error: \"Database not configured\" }, 500);\r\n\r\n                try {\r\n                    await env.proveloce_db.prepare(`\r\n                        UPDATE sessions SET status = 'live', started_at = CURRENT_TIMESTAMP WHERE id = ?\r\n                    `).bind(sessionId).run();\r\n\r\n                    return jsonResponse({ success: true, message: \"Session started\" });\r\n                } catch (error: any) {\r\n                    console.error(\"Error starting session:\", error);\r\n                    return jsonResponse({ success: false, error: \"Failed to start session\" }, 500);\r\n                }\r\n            }\r\n\r\n            // POST /api/sessions/:id/end - End session\r\n            const sessionEndMatch = url.pathname.match(/^\\/api\\/sessions\\/([^\\/]+)\\/end$/);\r\n            if (sessionEndMatch && request.method === \"POST\") {\r\n                const authHeader = request.headers.get(\"Authorization\");\r\n                if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const token = authHeader.substring(7);\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\");\r\n                if (!payload) return jsonResponse({ success: false, error: \"Invalid token\" }, 401);\r\n\r\n                const sessionId = sessionEndMatch[1];\r\n\r\n                if (!env.proveloce_db) return jsonResponse({ success: false, error: \"Database not configured\" }, 500);\r\n\r\n                try {\r\n                    await env.proveloce_db.prepare(`\r\n                        UPDATE sessions \r\n                        SET status = 'ended', ended_at = CURRENT_TIMESTAMP,\r\n                            duration_seconds = CAST((julianday(CURRENT_TIMESTAMP) - julianday(started_at)) * 86400 AS INTEGER)\r\n                        WHERE id = ?\r\n                    `).bind(sessionId).run();\r\n\r\n                    return jsonResponse({ success: true, message: \"Session ended\" });\r\n                } catch (error: any) {\r\n                    console.error(\"Error ending session:\", error);\r\n                    return jsonResponse({ success: false, error: \"Failed to end session\" }, 500);\r\n                }\r\n            }\r\n\r\n            // GET /api/sessions/:id/messages - Get session messages\r\n            const sessionMessagesMatch = url.pathname.match(/^\\/api\\/sessions\\/([^\\/]+)\\/messages$/);\r\n            if (sessionMessagesMatch && request.method === \"GET\") {\r\n                const authHeader = request.headers.get(\"Authorization\");\r\n                if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const token = authHeader.substring(7);\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\");\r\n                if (!payload) return jsonResponse({ success: false, error: \"Invalid token\" }, 401);\r\n\r\n                const sessionId = sessionMessagesMatch[1];\r\n\r\n                if (!env.proveloce_db) return jsonResponse({ success: false, error: \"Database not configured\" }, 500);\r\n\r\n                try {\r\n                    const result = await env.proveloce_db.prepare(`\r\n                        SELECT m.*, u.name as sender_name\r\n                        FROM session_messages m\r\n                        JOIN users u ON u.id = m.sender_id\r\n                        WHERE m.session_id = ?\r\n                        ORDER BY m.created_at ASC\r\n                    `).bind(sessionId).all();\r\n\r\n                    return jsonResponse({\r\n                        success: true,\r\n                        data: { messages: result.results || [] }\r\n                    });\r\n                } catch (error: any) {\r\n                    console.error(\"Error fetching messages:\", error);\r\n                    return jsonResponse({ success: false, error: \"Failed to fetch messages\" }, 500);\r\n                }\r\n            }\r\n\r\n            // POST /api/sessions/:id/messages - Send message\r\n            if (sessionMessagesMatch && request.method === \"POST\") {\r\n                const authHeader = request.headers.get(\"Authorization\");\r\n                if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const token = authHeader.substring(7);\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\");\r\n                if (!payload) return jsonResponse({ success: false, error: \"Invalid token\" }, 401);\r\n\r\n                const sessionId = sessionMessagesMatch[1];\r\n\r\n                if (!env.proveloce_db) return jsonResponse({ success: false, error: \"Database not configured\" }, 500);\r\n\r\n                try {\r\n                    const body = await request.json() as { content: string; attachmentUrl?: string };\r\n\r\n                    if (!body.content && !body.attachmentUrl) {\r\n                        return jsonResponse({ success: false, error: \"Message content required\" }, 400);\r\n                    }\r\n\r\n                    const messageId = crypto.randomUUID();\r\n\r\n                    await env.proveloce_db.prepare(`\r\n                        INSERT INTO session_messages (id, session_id, sender_id, content_text, attachment_url)\r\n                        VALUES (?, ?, ?, ?, ?)\r\n                    `).bind(\r\n                        messageId,\r\n                        sessionId,\r\n                        payload.userId,\r\n                        body.content || null,\r\n                        body.attachmentUrl || null\r\n                    ).run();\r\n\r\n                    return jsonResponse({ success: true, message: \"Message sent\", id: messageId });\r\n                } catch (error: any) {\r\n                    console.error(\"Error sending message:\", error);\r\n                    return jsonResponse({ success: false, error: \"Failed to send message\" }, 500);\r\n                }\r\n            }\r\n\r\n            // =====================================================\r\n            // Direct Messaging System\r\n            // =====================================================\r\n\r\n            // GET /api/messages/conversations - List all conversations\r\n            if (url.pathname === \"/api/messages/conversations\" && request.method === \"GET\") {\r\n                const authHeader = request.headers.get(\"Authorization\");\r\n                if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const token = authHeader.substring(7);\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\");\r\n                if (!payload) return jsonResponse({ success: false, error: \"Invalid token\" }, 401);\r\n\r\n                if (!env.proveloce_db) return jsonResponse({ success: false, error: \"Database not configured\" }, 500);\r\n\r\n                try {\r\n                    // Get unique conversations with last message\r\n                    const conversations = await env.proveloce_db.prepare(`\r\n                        SELECT \r\n                            CASE WHEN m.sender_id = ? THEN m.receiver_id ELSE m.sender_id END as other_user_id,\r\n                            u.name as other_user_name,\r\n                            u.profile_photo_url as other_user_avatar,\r\n                            m.content as last_message,\r\n                            m.created_at as last_message_at,\r\n                            (SELECT COUNT(*) FROM user_messages um WHERE um.sender_id = CASE WHEN m.sender_id = ? THEN m.receiver_id ELSE m.sender_id END AND um.receiver_id = ? AND um.read_at IS NULL) as unread_count\r\n                        FROM user_messages m\r\n                        JOIN users u ON u.id = CASE WHEN m.sender_id = ? THEN m.receiver_id ELSE m.sender_id END\r\n                        WHERE m.sender_id = ? OR m.receiver_id = ?\r\n                        GROUP BY other_user_id\r\n                        ORDER BY m.created_at DESC\r\n                    `).bind(payload.userId, payload.userId, payload.userId, payload.userId, payload.userId, payload.userId).all();\r\n\r\n                    return jsonResponse({\r\n                        success: true,\r\n                        data: { conversations: conversations.results || [] }\r\n                    });\r\n                } catch (error: any) {\r\n                    console.error(\"Error fetching conversations:\", error);\r\n                    return jsonResponse({ success: false, error: \"Failed to fetch conversations\" }, 500);\r\n                }\r\n            }\r\n\r\n            // GET /api/messages/:userId - Get messages with a specific user\r\n            const messagesMatch = url.pathname.match(/^\\/api\\/messages\\/([^\\/]+)$/);\r\n            if (messagesMatch && request.method === \"GET\") {\r\n                const authHeader = request.headers.get(\"Authorization\");\r\n                if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const token = authHeader.substring(7);\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\");\r\n                if (!payload) return jsonResponse({ success: false, error: \"Invalid token\" }, 401);\r\n\r\n                const otherUserId = messagesMatch[1];\r\n\r\n                if (!env.proveloce_db) return jsonResponse({ success: false, error: \"Database not configured\" }, 500);\r\n\r\n                try {\r\n                    // Get messages between the two users\r\n                    const messages = await env.proveloce_db.prepare(`\r\n                        SELECT m.*, u.name as sender_name\r\n                        FROM user_messages m\r\n                        JOIN users u ON u.id = m.sender_id\r\n                        WHERE (m.sender_id = ? AND m.receiver_id = ?) OR (m.sender_id = ? AND m.receiver_id = ?)\r\n                        ORDER BY m.created_at ASC\r\n                    `).bind(payload.userId, otherUserId, otherUserId, payload.userId).all();\r\n\r\n                    // Mark messages as read\r\n                    await env.proveloce_db.prepare(`\r\n                        UPDATE user_messages SET read_at = CURRENT_TIMESTAMP\r\n                        WHERE sender_id = ? AND receiver_id = ? AND read_at IS NULL\r\n                    `).bind(otherUserId, payload.userId).run();\r\n\r\n                    // Get other user info\r\n                    const otherUser = await env.proveloce_db.prepare(\r\n                        \"SELECT id, name, profile_photo_url FROM users WHERE id = ?\"\r\n                    ).bind(otherUserId).first();\r\n\r\n                    return jsonResponse({\r\n                        success: true,\r\n                        data: {\r\n                            messages: messages.results || [],\r\n                            otherUser: otherUser || null\r\n                        }\r\n                    });\r\n                } catch (error: any) {\r\n                    console.error(\"Error fetching messages:\", error);\r\n                    return jsonResponse({ success: false, error: \"Failed to fetch messages\" }, 500);\r\n                }\r\n            }\r\n\r\n            // POST /api/messages/:userId - Send a message to a user\r\n            if (messagesMatch && request.method === \"POST\") {\r\n                const authHeader = request.headers.get(\"Authorization\");\r\n                if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const token = authHeader.substring(7);\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\");\r\n                if (!payload) return jsonResponse({ success: false, error: \"Invalid token\" }, 401);\r\n\r\n                const receiverId = messagesMatch[1];\r\n\r\n                if (!env.proveloce_db) return jsonResponse({ success: false, error: \"Database not configured\" }, 500);\r\n\r\n                try {\r\n                    const body = await request.json() as { content: string };\r\n\r\n                    if (!body.content || body.content.trim() === \"\") {\r\n                        return jsonResponse({ success: false, error: \"Message content is required\" }, 400);\r\n                    }\r\n\r\n                    const messageId = crypto.randomUUID();\r\n\r\n                    await env.proveloce_db.prepare(`\r\n                        INSERT INTO user_messages (id, sender_id, receiver_id, content)\r\n                        VALUES (?, ?, ?, ?)\r\n                    `).bind(messageId, payload.userId, receiverId, body.content.trim()).run();\r\n\r\n                    // Notify receiver\r\n                    await createNotification(\r\n                        env,\r\n                        receiverId,\r\n                        'INFO',\r\n                        'New Message',\r\n                        'You have received a new message',\r\n                        '/messages'\r\n                    );\r\n\r\n                    return jsonResponse({\r\n                        success: true,\r\n                        message: \"Message sent\",\r\n                        data: { id: messageId }\r\n                    });\r\n                } catch (error: any) {\r\n                    console.error(\"Error sending message:\", error);\r\n                    return jsonResponse({ success: false, error: \"Failed to send message\" }, 500);\r\n                }\r\n            }\r\n\r\n            // GET /api/messages/users/search - Search users to message\r\n            if (url.pathname === \"/api/messages/users/search\" && request.method === \"GET\") {\r\n                const authHeader = request.headers.get(\"Authorization\");\r\n                if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const token = authHeader.substring(7);\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\");\r\n                if (!payload) return jsonResponse({ success: false, error: \"Invalid token\" }, 401);\r\n\r\n                if (!env.proveloce_db) return jsonResponse({ success: false, error: \"Database not configured\" }, 500);\r\n\r\n                const query = url.searchParams.get(\"q\") || \"\";\r\n\r\n                try {\r\n                    const users = await env.proveloce_db.prepare(`\r\n                        SELECT id, name, email, role, profile_photo_url\r\n                        FROM users\r\n                        WHERE id != ? AND (name LIKE ? OR email LIKE ?)\r\n                        LIMIT 20\r\n                    `).bind(payload.userId, `%${query}%`, `%${query}%`).all();\r\n\r\n                    return jsonResponse({\r\n                        success: true,\r\n                        data: { users: users.results || [] }\r\n                    });\r\n                } catch (error: any) {\r\n                    console.error(\"Error searching users:\", error);\r\n                    return jsonResponse({ success: false, error: \"Failed to search users\" }, 500);\r\n                }\r\n            }\r\n\r\n            // =====================================================\r\n            // Admin - User Detail View with History\r\n            // =====================================================\r\n\r\n            // GET /api/admin/users/:id - Get user detail with history (admin/superadmin only)\r\n            const adminUserDetailMatch = url.pathname.match(/^\\/api\\/admin\\/users\\/([^\\/]+)$/);\r\n            if (adminUserDetailMatch && request.method === \"GET\") {\r\n                const authHeader = request.headers.get(\"Authorization\");\r\n                if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\r\n                    return jsonResponse({ success: false, error: \"Unauthorized\" }, 401);\r\n                }\r\n\r\n                const token = authHeader.substring(7);\r\n                const payload = await verifyJWT(token, env.JWT_ACCESS_SECRET || \"default-secret\");\r\n                if (!payload) return jsonResponse({ success: false, error: \"Invalid token\" }, 401);\r\n\r\n                const role = (payload.role || \"\").toUpperCase();\r\n                if (![\"ADMIN\", \"SUPERADMIN\"].includes(role)) {\r\n                    return jsonResponse({ success: false, error: \"Access denied\" }, 403);\r\n                }\r\n\r\n                const userId = adminUserDetailMatch[1];\r\n\r\n                if (!env.proveloce_db) return jsonResponse({ success: false, error: \"Database not configured\" }, 500);\r\n\r\n                try {\r\n                    // Get user profile (public data only, no private messages)\r\n                    const user = await env.proveloce_db.prepare(`\r\n                        SELECT id, name, email, phone, role, status, profile_photo_url, created_at, updated_at\r\n                        FROM users WHERE id = ?\r\n                    `).bind(userId).first();\r\n\r\n                    if (!user) {\r\n                        return jsonResponse({ success: false, error: \"User not found\" }, 404);\r\n                    }\r\n\r\n                    // Get user profile details\r\n                    const profile = await env.proveloce_db.prepare(\r\n                        \"SELECT * FROM user_profiles WHERE user_id = ?\"\r\n                    ).bind(userId).first();\r\n\r\n                    // Get connect requests (bookings)\r\n                    const connectRequests = await env.proveloce_db.prepare(`\r\n                        SELECT cr.*, \r\n                               e.name as expert_name,\r\n                               c.name as customer_name\r\n                        FROM connect_requests cr\r\n                        LEFT JOIN users e ON e.id = cr.expert_id\r\n                        LEFT JOIN users c ON c.id = cr.customer_id\r\n                        WHERE cr.customer_id = ? OR cr.expert_id = ?\r\n                        ORDER BY cr.created_at DESC\r\n                        LIMIT 50\r\n                    `).bind(userId, userId).all();\r\n\r\n                    // Get session history (meetings)\r\n                    const sessions = await env.proveloce_db.prepare(`\r\n                        SELECT s.*,\r\n                               e.name as expert_name,\r\n                               c.name as customer_name\r\n                        FROM sessions s\r\n                        LEFT JOIN users e ON e.id = s.expert_id\r\n                        LEFT JOIN users c ON c.id = s.customer_id\r\n                        WHERE s.expert_id = ? OR s.customer_id = ?\r\n                        ORDER BY s.scheduled_date DESC\r\n                        LIMIT 50\r\n                    `).bind(userId, userId).all();\r\n\r\n                    // Get expert application (if exists)\r\n                    const expertApplication = await env.proveloce_db.prepare(\r\n                        \"SELECT * FROM expert_applications WHERE user_id = ?\"\r\n                    ).bind(userId).first();\r\n\r\n                    // NOTE: Private messages are intentionally excluded for privacy\r\n\r\n                    return jsonResponse({\r\n                        success: true,\r\n                        data: {\r\n                            user,\r\n                            profile: profile || null,\r\n                            bookings: connectRequests.results || [],\r\n                            sessions: sessions.results || [],\r\n                            expertApplication: expertApplication || null\r\n                        }\r\n                    });\r\n                } catch (error: any) {\r\n                    console.error(\"Error fetching user detail:\", error);\r\n                    return jsonResponse({ success: false, error: \"Failed to fetch user detail\" }, 500);\r\n                }\r\n            }\r\n\r\n            // =====================================================\r\n            // Default Route\r\n            // =====================================================\r\n\r\n            return new Response(\"ProVeloce Cloudflare Backend Running \u2714\", {\r\n                headers: { \"Content-Type\": \"text/plain\", ...corsHeaders }\r\n            });\r\n\r\n        } catch (error: any) {\r\n            console.error(\"Worker error:\", error);\r\n            return jsonResponse({ success: false, error: error.message || \"Internal Server Error\" }, 500);\r\n        }\r\n    }\r\n}\r\n"],
  "mappings": "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",
  "names": ["PerformanceMark", "hrtime", "env", "cwd", "hrtime", "env", "title", "encoder", "data", "hashBuffer", "hashArray", "domain"]
}
